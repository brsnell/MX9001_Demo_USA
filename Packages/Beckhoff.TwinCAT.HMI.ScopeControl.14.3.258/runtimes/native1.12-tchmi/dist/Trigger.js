import{triggerImages}from"./TcHmiScopeControl.esm.js";import{Orientation}from"./Types.js";export class Trigger{__fontFamily=null;__fontSize=null;__fontSizeUnit=null;__fontWeight=null;__canvas;__context;__triggerData=null;constructor(canvas,triggerData){this.__canvas=canvas,this.__context=this.__canvas.getContext("2d"),this.__triggerData=triggerData}draw(){let fontFamily;const inheritedFontfamily=TcHmi.StyleProvider.getComputedElementStyle(this.__canvas,"font-family")["font-family"];if(fontFamily=inheritedFontfamily||"sans-serif",this.__context&&this.__triggerData&&(this.__context.lineCap="butt",this.__context.globalAlpha=1,Orientation[this.__triggerData.orientation]===Orientation.Vertical)){if(this.__context.setLineDash([]),this.__context.lineWidth=this.__triggerData.lineWidth,this.__context.strokeStyle=this.__triggerData.color,this.__context.beginPath(),this.__context.moveTo(this.__triggerData.position.x,this.__triggerData.position.y),this.__context.lineTo(this.__triggerData.position.x,this.__triggerData.position.y+this.__triggerData.dimensions.height),this.__triggerData.text&&(this.__context.fillStyle=this.__triggerData.text.backgroundColor,this.__context.fillRect(this.__triggerData.text.position.x,this.__triggerData.text.position.y,this.__triggerData.text.dimensions.width,this.__triggerData.text.dimensions.height),this.__context.font=this.__triggerData.text.fontSize+"pt "+fontFamily,this.__context.fillStyle=this.__triggerData.text.color,this.__context.textAlign="center",this.__context.textBaseline="middle",this.__context.fillText(this.__triggerData.text.text,this.__triggerData.text.position.x+this.__triggerData.text.dimensions.width/2,this.__triggerData.text.position.y+this.__triggerData.text.dimensions.height/2,this.__triggerData.text.dimensions.width)),this.__triggerData.label){this.__context.font=this.__triggerData.label.fontSize+"pt "+fontFamily,this.__context.fillStyle=this.__triggerData.label.color;let cuttedString=this.getCuttedString(this.__triggerData.label.label,this.__triggerData.dimensions.height);"Right"===this.__triggerData.label.position?(this.__context.textAlign="end",this.__context.textBaseline="top",this.__context.translate(this.__triggerData.position.x,this.__triggerData.position.y),this.__context.rotate(-.5*Math.PI),this.__context.translate(-this.__triggerData.position.x,-this.__triggerData.position.y),this.__context.fillText(cuttedString,this.__triggerData.position.x,this.__triggerData.position.y)):cuttedString===this.__triggerData.label.label?(this.__context.textAlign="start",this.__context.textBaseline="bottom",this.__context.translate(this.__triggerData.position.x,this.__triggerData.position.y+this.__triggerData.dimensions.height),this.__context.rotate(-.5*Math.PI),this.__context.translate(-this.__triggerData.position.x,-(this.__triggerData.position.y+this.__triggerData.dimensions.height)),this.__context.fillText(cuttedString,this.__triggerData.position.x,this.__triggerData.position.y+this.__triggerData.dimensions.height)):(this.__context.textAlign="end",this.__context.textBaseline="bottom",this.__context.translate(this.__triggerData.position.x,this.__triggerData.position.y),this.__context.rotate(-.5*Math.PI),this.__context.translate(-this.__triggerData.position.x,-this.__triggerData.position.y),this.__context.fillText(cuttedString,this.__triggerData.position.x,this.__triggerData.position.y)),this.__context.setTransform(1,0,0,1,0,0);let deviceDPI=window.devicePixelRatio;this.__context.scale(deviceDPI,deviceDPI)}if(this.__triggerData.icon){let triggerIcon=triggerImages.get(this.__triggerData.icon.icon);if(triggerIcon)this.__context.drawImage(triggerIcon,this.__triggerData.icon.position.x,this.__triggerData.icon.position.y,this.__triggerData.icon.dimensions.width,this.__triggerData.icon.dimensions.height);else{let image=new Image;image.src=tchmi_path(this.__triggerData.icon.icon),image.onload=()=>{this.__context&&this.__triggerData&&this.__triggerData.icon&&(triggerImages.set(this.__triggerData.icon.icon,image),this.__context.drawImage(image,this.__triggerData.icon.position.x,this.__triggerData.icon.position.y,this.__triggerData.icon.dimensions.width,this.__triggerData.icon.dimensions.height))}}}this.__context.stroke()}}getCuttedString(str,maxWidth){if(this.__context){let allWidth=this.__context.measureText(str).width;if(allWidth<=maxWidth)return str;{let len=str.length;for(;allWidth>maxWidth;)str=str.substring(1,len),allWidth=this.__context.measureText(str).width;return str}}return str}getTriggerData(){return this.__triggerData}setTriggerData(triggerData){this.__triggerData=triggerData}}
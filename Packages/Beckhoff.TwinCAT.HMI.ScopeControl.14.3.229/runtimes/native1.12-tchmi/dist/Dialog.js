var __runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};import{ReplacePrompt}from"./ReplacePrompt.js";let Dialog=(()=>{var _a,_b,_c;let ___onTabChanged_decorators,___onDataChanged_decorators,___onToggleStateChanged_decorators,_instanceExtraInitializers=[];return class{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;___onTabChanged_decorators=[(_a=TcHmi).CallbackMethod.bind(_a)],___onDataChanged_decorators=[(_b=TcHmi).CallbackMethod.bind(_b)],___onToggleStateChanged_decorators=[(_c=TcHmi).CallbackMethod.bind(_c)],__esDecorate(this,null,___onTabChanged_decorators,{kind:"method",name:"__onTabChanged",static:!1,private:!1,access:{has:obj=>"__onTabChanged"in obj,get:obj=>obj.__onTabChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onDataChanged_decorators,{kind:"method",name:"__onDataChanged",static:!1,private:!1,access:{has:obj=>"__onDataChanged"in obj,get:obj=>obj.__onDataChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onToggleStateChanged_decorators,{kind:"method",name:"__onToggleStateChanged",static:!1,private:!1,access:{has:obj=>"__onToggleStateChanged"in obj,get:obj=>obj.__onToggleStateChanged},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}constructor(element,control){this.__parentControl=control,this.__element=element;let contentTabs=element.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-dialog")[0];contentTabs.useMaxContent();let elementTabContentUpload=element.querySelector('tchmi-tab-content[name="upload"]');if(this.__elementChunkSizeRow=element.getElementsByClassName("chunksizeRow")[0],this.__elementProgressbar=element.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-dialog-progress-bar")[0],!(this.__element&&contentTabs&&elementTabContentUpload&&this.__elementChunkSizeRow&&this.__elementProgressbar))throw new Error("Invalid Template.html");const saveButton=TcHmi.Controls.get(this.__parentControl.getId()+".saveButton"),fileButton=TcHmi.Controls.get(this.__parentControl.getId()+".fileButton"),persistCheckbox=TcHmi.Controls.get(this.__parentControl.getId()+".persistCheckbox"),toggleSwitch=TcHmi.Controls.get(this.__parentControl.getId()+".advancedToggleSwitch"),chunksizeTextbox=TcHmi.Controls.get(this.__parentControl.getId()+".chunksizeTextbox"),uploadButton=TcHmi.Controls.get(this.__parentControl.getId()+".uploadButton");let noFile=elementTabContentUpload.getElementsByClassName("no_file")[0];const selectAllButton=TcHmi.Controls.get(this.__parentControl.getId()+".selectAllButton"),deselectAllButton=TcHmi.Controls.get(this.__parentControl.getId()+".deselectAllButton"),deleteSelectedButton=TcHmi.Controls.get(this.__parentControl.getId()+".deleteSelectedButton"),datagridRecordsPerUser=TcHmi.Controls.get(this.__parentControl.getId()+".datagridRecordsPerUser"),detachButton=TcHmi.Controls.get(this.__parentControl.getId()+".detachButton"),resetButton=TcHmi.Controls.get(this.__parentControl.getId()+".resetButton"),cancelButton=TcHmi.Controls.get(this.__parentControl.getId()+".cancelButton");if(!(saveButton&&fileButton&&persistCheckbox&&chunksizeTextbox&&uploadButton&&selectAllButton&&deselectAllButton&&deleteSelectedButton&&datagridRecordsPerUser&&detachButton&&toggleSwitch&&resetButton&&cancelButton&&noFile))throw new Error("Invalid Template.html");this.__saveButton=saveButton,this.__noFile=noFile,this.__persistCheckbox=persistCheckbox,this.__chunksizeTextbox=chunksizeTextbox,this.__fileButton=fileButton,this.__uploadButton=uploadButton,this.__uploadedRecordsDatagrid=datagridRecordsPerUser,this.__deleteSelectedButton=deleteSelectedButton,this.__detachButton=detachButton;let elementCharts=$('<div class="TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-dialog-charts TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-popup tchmi-box"></div>'),chartsCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",`${this.__parentControl.getId()}.chartsCombobox`,{"data-tchmi-width":150,"data-tchmi-height":26},this.__parentControl),chartsOkButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.chartsOkButton`,{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Dialog_Button_Text_Charts_Ok%/l%"},this.__parentControl);if(this.__toggleSwitch=toggleSwitch,!chartsCombobox||!elementCharts||!chartsOkButton)throw new Error("Could not create controls for dialog.");this.__chartsCombobox=chartsCombobox,elementCharts.append(this.__chartsCombobox.getElement()[0]),elementCharts.append(chartsOkButton.getElement()[0]),this.__elementCharts=elementCharts,contentTabs.addTabChangeCallback(this.__onTabChanged),this.__eventDestroyers.push(TcHmi.EventProvider.register(saveButton.getId()+".onPressed",()=>{this.__onButtonPressed(!1,saveButton?.getId())})),this.__eventDestroyers.push(TcHmi.EventProvider.register(fileButton.getId()+".onPressed",()=>{this.__onButtonPressed(!1,fileButton?.getId())})),this.__eventDestroyers.push(TcHmi.EventProvider.register(uploadButton.getId()+".onPressed",()=>{this.__onButtonPressed(!1,uploadButton?.getId())})),this.__eventDestroyers.push(TcHmi.EventProvider.register(chartsOkButton.getId()+".onPressed",()=>{this.__onButtonPressed(!1,chartsOkButton?.getId())})),this.__eventDestroyers.push(TcHmi.EventProvider.register(deleteSelectedButton.getId()+".onPressed",()=>{this.__onButtonPressed(!1,deleteSelectedButton?.getId())})),this.__eventDestroyers.push(TcHmi.EventProvider.register(selectAllButton.getId()+".onPressed",()=>{this.__onButtonPressed(!1,selectAllButton?.getId())})),this.__eventDestroyers.push(TcHmi.EventProvider.register(deselectAllButton.getId()+".onPressed",()=>{this.__onButtonPressed(!1,deselectAllButton?.getId())})),this.__eventDestroyers.push(TcHmi.EventProvider.register(datagridRecordsPerUser.getId()+".onDataChanged",this.__onDataChanged)),this.__eventDestroyers.push(TcHmi.EventProvider.register(detachButton.getId()+".onPressed",()=>{this.__onButtonPressed(!1,detachButton?.getId())})),this.__eventDestroyers.push(TcHmi.EventProvider.register(toggleSwitch.getId()+".onToggleStateChanged",this.__onToggleStateChanged)),this.__eventDestroyers.push(TcHmi.EventProvider.register(resetButton.getId()+".onPressed",()=>{this.__onButtonPressed(!1,resetButton?.getId())})),this.__eventDestroyers.push(TcHmi.EventProvider.register(cancelButton.getId()+".onPressed",()=>{this.__onButtonPressed(!0,cancelButton?.getId())}))}__parentControl=__runInitializers(this,_instanceExtraInitializers);__element;__elementChunkSizeRow;__noFile;__elementCharts;__elementProgressbar;__toggleSwitch;__persistCheckbox;__chunksizeTextbox;__file=null;__uploadedRecordsDatagrid;__chartsCombobox;__deleteSelectedButton;__saveButton;__fileButton;__uploadButton;__detachButton;__eventDestroyers=[];__isShowing=!1;__isWaitingForServer=!1;__confirmationPrompt=null;__replacePrompt=null;attachedGuid=null;show(){this.__isShowing||(TcHmi.TopMostLayer.add(this.__parentControl,this.__element,{removeCb:()=>{this.__isShowing=!1},centerHorizontal:!0,centerVertical:!0}),this.__isShowing=!0)}hide(){this.__isShowing&&(TcHmi.TopMostLayer.remove(this.__parentControl,this.__element),this.__isShowing=!1)}addChartsToCombobox(chartArray){this.__chartsCombobox.setSrcData(chartArray),this.__chartsCombobox.setSelectedIndex(0)}showChartsDialog(){TcHmi.TopMostLayer.add(this.__parentControl,this.__elementCharts,{centerHorizontal:!0,centerVertical:!0,removeCb:data=>{data.canceled&&this.setAttachedGuid(null)}})}closeChartsDialog(){TcHmi.TopMostLayer.remove(this.__parentControl,this.__elementCharts)}destroy(){for(let i=0,ii=this.__eventDestroyers.length;i<ii;i++)this.__eventDestroyers[i]();this.__eventDestroyers=[],this.__confirmationPrompt?.destroy(),this.__confirmationPrompt=null,this.__replacePrompt?.destroy(),this.__replacePrompt=null}disableAllButtons(){this.__saveButton.setIsEnabled(!1),this.__uploadButton.setIsEnabled(!1),this.__detachButton.setIsEnabled(!1),this.__uploadedRecordsDatagrid.setIsEnabled(!1),this.__deleteSelectedButton.setIsEnabled(!1),this.__parentControl.enableOrDisableMenuControls()}enableAllButtons(){this.__saveButton.setIsEnabled(!0),this.__uploadButton.setIsEnabled(!0),this.__detachButton.setIsEnabled(!0),this.__uploadedRecordsDatagrid.setIsEnabled(!0);let srcData=this.__uploadedRecordsDatagrid.getSrcData();srcData&&(srcData.some(x=>x.select)?this.__deleteSelectedButton.setIsEnabled(!0):this.__deleteSelectedButton.setIsEnabled(!1)),this.__parentControl.enableOrDisableMenuControls()}resetToDefault(){this.__noFile.textContent="",this.__file=null,this.__parentControl.__localizationReader&&(this.__noFile.textContent=this.__parentControl.__localizationReader.get("Dialog_Tab_Upload_No_File")),this.__persistCheckbox.setToggleState("Active"),this.__elementChunkSizeRow.style.display="none",this.__chunksizeTextbox.setText("1048576"),this.__elementProgressbar.value=0,this.__elementProgressbar.max=0,this.__toggleSwitch.setToggleState("Normal")}__onTabChanged(tabIndex){"currentRecord"===tabIndex?this.__toggleSwitch.setVisibility("Hidden"):"upload"===tabIndex?this.__toggleSwitch.setVisibility("Visible"):"record"===tabIndex&&this.__toggleSwitch.setVisibility("Hidden")}setAttachedGuid(guid){if(this.attachedGuid=guid,this.attachedGuid){let srcDataFromDatagrid=this.__uploadedRecordsDatagrid.getSrcData(),srcData=tchmi_clone_object(srcDataFromDatagrid);if(srcData)for(let element of srcData)if(element.guid===this.attachedGuid){element.attach=!0,this.__uploadedRecordsDatagrid.setSrcData(srcData);break}}else{let srcDataFromDatagrid=this.__uploadedRecordsDatagrid.getSrcData(),srcData=tchmi_clone_object(srcDataFromDatagrid);srcData&&(srcData.forEach(x=>{x.attach=!1}),this.__uploadedRecordsDatagrid.setSrcData(srcData))}}setSrcDataOfRecordsDatagrid(srcData){let clone=tchmi_clone_object(srcData);if(clone)for(let element of clone){if(element.select=!1,this.attachedGuid&&element.guid===this.attachedGuid){element.attach=!0;break}"__AutoSave"===element.extensionName&&(element.autoSave=!0)}this.__uploadedRecordsDatagrid.setSrcData(clone),this.__deleteSelectedButton.setIsEnabled(!1)}async __onButtonPressed(hide,id){if(id===this.__parentControl.getId()+".saveButton")this.__parentControl.__serverSymbolsHelper.saveCurrentRecord();else if(id===this.__parentControl.getId()+".uploadButton")if(null===this.__file);else{let persist="Active"===this.__persistCheckbox.getToggleState();this.__parentControl.__serverSymbolsHelper.uploadRecord(this.__file,persist,Number(this.__chunksizeTextbox.getText())/2)}else if(id===this.__parentControl.getId()+".detachButton")this.__parentControl.__serverSymbolsHelper.detachFromScopeRecord();else if(id===this.__parentControl.getId()+".fileButton"){const files=await TcHmi.FileUploader.openFileDialog({acceptedFileTypes:[".svdx"]});if(files&&files.length>0){let file=files[0];this.__noFile.textContent=file.name,this.__file=file}else this.__noFile.textContent="",this.__file=null}else if(id===this.__parentControl.getId()+".chartsOkButton"){let srcDataFromDatagrid=this.__uploadedRecordsDatagrid.getSrcData(),srcData=tchmi_clone_object(srcDataFromDatagrid),selectedRowIndex=this.__uploadedRecordsDatagrid.getSelectedRowIndex();if(srcData&&null!==selectedRowIndex){let element=tchmi_clone_object(srcData[selectedRowIndex]);element.chartName=this.__chartsCombobox.getSelectedText(),delete element.attach,this.attachedGuid=element.guid,this.__parentControl.__serverSymbolsHelper.openConnectionToFile(element)}}else if(id===this.__parentControl.getId()+".selectAllButton"){let datagridSrcData=this.__uploadedRecordsDatagrid.getSrcData();if(datagridSrcData){let srcData=tchmi_clone_object(datagridSrcData);srcData.forEach(x=>{x.select=!0}),this.__uploadedRecordsDatagrid.setSrcData(srcData),this.__isWaitingForServer||this.__deleteSelectedButton.setIsEnabled(!0)}}else if(id===this.__parentControl.getId()+".deselectAllButton"){let datagridSrcData=this.__uploadedRecordsDatagrid.getSrcData();if(datagridSrcData){let srcData=tchmi_clone_object(datagridSrcData);srcData.forEach(x=>{x.select=!1}),this.__uploadedRecordsDatagrid.setSrcData(srcData)}this.__deleteSelectedButton.setIsEnabled(!1)}else id===this.__parentControl.getId()+".deleteSelectedButton"?this.__delete():id===this.__parentControl.getId()+".resetButton"&&this.resetToDefault();hide&&this.hide()}__onDataChanged(_event,value){if("select"===value.property){let srcData=this.__uploadedRecordsDatagrid.getSrcData();if(srcData){let clone=tchmi_clone_object(srcData);clone[value.index].select=value.value,this.__uploadedRecordsDatagrid.setSrcData(clone),srcData.some(x=>x.select)?this.__deleteSelectedButton.setIsEnabled(!0):this.__deleteSelectedButton.setIsEnabled(!1)}}else if("persist"===value.property){let srcData=this.__uploadedRecordsDatagrid.getSrcData();if(srcData){let element=srcData[value.index];this.__parentControl.__serverSymbolsHelper.changePersist(element)}}else if("download"!==value.property||value.value){if("attach"===value.property)if(value.value){let srcData=this.__uploadedRecordsDatagrid.getSrcData();if(srcData){let element=srcData[value.index];this.__parentControl.__serverSymbolsHelper.getChartList(element)}}else this.__parentControl.__serverSymbolsHelper.detachFromScopeRecord()}else{let srcData=this.__uploadedRecordsDatagrid.getSrcData();if(srcData){let element=srcData[value.index];this.__parentControl.__serverSymbolsHelper.download(element)}}}__onToggleStateChanged(){"Active"===this.__toggleSwitch.getToggleState()?this.__elementChunkSizeRow.style.display="":this.__elementChunkSizeRow.style.display="none"}async __delete(){this.__confirmationPrompt||(this.__confirmationPrompt=new TcHmi.Controls.Helpers.TextAndButtonsPrompt({yes:{value:!0,attributes:{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Popup_Button_Text_Yes%/l%"}},no:{value:!1,attributes:{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Popup_Button_Text_No%/l%"}}},this.__parentControl),this.__confirmationPrompt.setBackgroundAction({close:!0,action:"no"}),this.__confirmationPrompt.setLocalizations({headerText:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Popup_Header_ConfirmDelete%/l%",contentText:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Popup_Text_ConfirmDelete%/l%"}));if(await this.__confirmationPrompt.prompt()){let datagridSrcData=this.__uploadedRecordsDatagrid.getSrcData();if(datagridSrcData){let filteredElements=tchmi_clone_object(datagridSrcData).filter(x=>x.select);if(0===filteredElements.length)return;filteredElements.forEach(x=>{delete x.attach,delete x.select}),this.__parentControl.__serverSymbolsHelper.deleteScopeUpload(filteredElements)}}}async replaceOrIncrementCurrentRecord(){return this.__replacePrompt||(this.__replacePrompt=new ReplacePrompt(this.__parentControl),this.__replacePrompt.setLocalizations({headerText:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Popup_Header_ConfirmSave%/l%",contentText:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Popup_Text_ConfirmSave%/l%",buttonTextCancel:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Popup_Button_Text_Cancel%/l%",buttonTextReplace:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Popup_Button_Text_Replace%/l%",buttonTextIncrement:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Popup_Button_Text_Increment%/l%",toggleSwitchTextSave:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Popup_ToggleSwitch_Text_Save%/l%"})),await this.__replacePrompt.prompt()}isShowing(){return this.__isShowing}getIsWaitingForServer(){return this.__isWaitingForServer}setIsWaitingForServer(isWaitingForServer){this.__isWaitingForServer=isWaitingForServer}setProgressbarValue(newValue){this.__elementProgressbar.value=newValue}setProgressbarMaxValue(maxValue){this.__elementProgressbar.max=maxValue}getProgressbarValue(){return this.__elementProgressbar.value}}})();export{Dialog};
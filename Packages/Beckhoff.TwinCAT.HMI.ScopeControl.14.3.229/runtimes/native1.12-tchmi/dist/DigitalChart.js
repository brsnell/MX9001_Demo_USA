import{Digit}from"./Digit.js";import{IChart}from"./IChart.js";export class DigitalChart extends IChart{constructor(elementRoot,canvasWidth,canvasHeight,reuseElements){super(elementRoot,canvasWidth,canvasHeight,reuseElements)}draw(layout,data){if(!this.__canvasFrame||!this.__contextFrame)return;let fontFamily,canvasWidth=this.__canvasFrame.width/window.devicePixelRatio,canvasHeight=this.__canvasFrame.height/window.devicePixelRatio;this.__contextFrame.clearRect(0,0,canvasWidth,canvasHeight);const inheritedFontfamily=TcHmi.StyleProvider.getComputedElementStyle(this.__canvasFrame,"font-family")["font-family"];fontFamily=inheritedFontfamily||"sans-serif";for(let i=0,ii=layout.tiles.length;i<ii;i++)if(this.__contextFrame.strokeStyle=layout.foregroundColor,this.__contextFrame.beginPath(),this.__contextFrame.rect(layout.tiles[i].position.x,layout.tiles[i].position.y,layout.tiles[i].dimensions.width,layout.tiles[i].dimensions.height),data){let labelNameElem=data.tiles[i].labels.find(x=>"LabelName"===x.name),labelMaxElem=data.tiles[i].labels.find(x=>"LabelMax"===x.name);labelNameElem&&(this.__contextFrame.moveTo(layout.tiles[i].position.x,layout.tiles[i].position.y+labelNameElem.dimensions.height),this.__contextFrame.lineTo(layout.tiles[i].position.x+layout.tiles[i].dimensions.width,layout.tiles[i].position.y+labelNameElem.dimensions.height)),labelMaxElem&&(this.__contextFrame.moveTo(layout.tiles[i].position.x,layout.tiles[i].position.y+layout.tiles[i].dimensions.height-labelMaxElem.dimensions.height),this.__contextFrame.lineTo(layout.tiles[i].position.x+layout.tiles[i].dimensions.width,layout.tiles[i].position.y+layout.tiles[i].dimensions.height-labelMaxElem.dimensions.height),this.__contextFrame.moveTo(layout.tiles[i].position.x+layout.tiles[i].dimensions.width/2,layout.tiles[i].position.y+layout.tiles[i].dimensions.height-labelMaxElem.dimensions.height),this.__contextFrame.lineTo(layout.tiles[i].position.x+layout.tiles[i].dimensions.width/2,layout.tiles[i].position.y+layout.tiles[i].dimensions.height)),this.__contextFrame.stroke();for(let label of data.tiles[i].labels){this.__contextFrame.fillStyle=label.color,this.__contextFrame.font=label.fontSize+"pt "+fontFamily,this.__contextFrame.textBaseline="middle",this.__contextFrame.textAlign="left";let text=data&&data.tiles[i].labels?data.tiles[i].labels.filter(x=>x.name===label.name):null;if(text&&text[0]){let x=label.position.x;label.name.toLowerCase().includes("name")||(x=label.position.x+label.dimensions.width/2,this.__contextFrame.textAlign="center"),this.__contextFrame.fillText(text[0].value,x,label.position.y+label.dimensions.height/2,label.dimensions.width)}}for(let label of data.tiles[i].digitalView.labels){this.__contextFrame.fillStyle=label.color,this.__contextFrame.font=label.fontSize+"pt "+fontFamily,this.__contextFrame.textBaseline="middle",this.__contextFrame.textAlign="left";let text=label.value;if(text&&text[0]){let x=label.position.x;label.name.toLowerCase().includes("name")||(x=label.position.x+label.dimensions.width/2,this.__contextFrame.textAlign="center"),this.__contextFrame.fillText(text,x,label.position.y+label.dimensions.height/2,label.dimensions.width)}}let tile=data.tiles[i];for(let digit of tile.digitalView.digits)digit&&new Digit(this.__canvasFrame).draw(digit);let separator=tile.digitalView.separator;if(separator)if("dot"===separator.seperatorType){this.__contextFrame.fillStyle=separator.color,this.__contextFrame.beginPath();let xArray=separator.polygon.map((value,index,array)=>value.x),minX=Math.min(...xArray),maxX=Math.max(...xArray),yArray=separator.polygon.map((value,index,array)=>value.y),minY=Math.min(...yArray),maxY=Math.max(...yArray);this.__contextFrame.arc(minX+(maxX-minX)/2,minY+(maxY-minY)/2,(maxY-minY)/2,0,2*Math.PI),this.__contextFrame.fill()}else{this.__contextFrame.fillStyle=separator.color,this.__contextFrame.beginPath();for(let j=0,jj=separator.polygon.length;j<jj;j++)0===j?this.__contextFrame.moveTo(separator.polygon[j].x,separator.polygon[j].y):this.__contextFrame.lineTo(separator.polygon[j].x,separator.polygon[j].y);this.__contextFrame.fill()}let minus=tile.digitalView.minus;if(minus){this.__contextFrame.beginPath(),this.__contextFrame.fillStyle=minus.color;for(let j=0,jj=minus.polygon.length;j<jj;j++)0===j?this.__contextFrame.moveTo(minus.polygon[j].x,minus.polygon[j].y):this.__contextFrame.lineTo(minus.polygon[j].x,minus.polygon[j].y);this.__contextFrame.fill()}}}}
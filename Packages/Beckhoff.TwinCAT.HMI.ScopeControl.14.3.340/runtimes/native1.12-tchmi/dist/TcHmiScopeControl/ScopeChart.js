import{LineGraph}from"./Graph.js";import{Grid}from"./Grid.js";import{IChart}from"./IChart.js";import{Subgrid}from"./Subgrid.js";import{Trigger}from"./Trigger.js";import{backgroundImages}from"./TcHmiScopeControl.esm.js";import{XAxis}from"./XAxis.js";import{XYTrigger}from"./XYTrigger.js";import{YAxis}from"./YAxis.js";export class ScopeChart extends IChart{__yAxis=[];__xAxis=[];__grid=[];__subgrid=[];__trigger=[];__xyTrigger=[];__axisGroupForegroundColor="";__lineGraph=new Map;__hasChanged;__lineChanged;constructor(elementRoot,canvasWidth,canvasHeight,reuseElements){super(elementRoot,canvasWidth,canvasHeight,reuseElements),this.__hasChanged=!1,this.__lineChanged=!1}addXAxis(xAxisLayout,themeResourcesHeadlineColor,themeResourcesAxisColor){if(this.__canvasFrame){let xAxis=new XAxis(this.__xAxis.length+1,this.__canvasFrame,xAxisLayout,themeResourcesHeadlineColor,themeResourcesAxisColor);return this.__xAxis.push(xAxis),this.__hasChanged=!0,xAxis}return null}addXAxisAtPosition(index,xAxisLayout,themeResourcesHeadlineColor,themeResourcesAxisColor){if(this.__canvasFrame){let xAxis=new XAxis(this.__xAxis.length+1,this.__canvasFrame,xAxisLayout,themeResourcesHeadlineColor,themeResourcesAxisColor);this.__xAxis.splice(index,0,xAxis),this.__hasChanged=!0}}deleteXAxis(index){this.__xAxis.splice(index,1),this.setHasChanged(!0)}deleteAllXAxis(){this.__xAxis=[],this.setHasChanged(!0)}addYAxis(yAxisLayout,themeResourcesHeadlineColor,themeResourcesAxisColor){if(this.__canvasFrame){let yAxis=new YAxis(this.__yAxis.length+1,this.__canvasFrame,yAxisLayout,themeResourcesHeadlineColor,themeResourcesAxisColor);this.__yAxis.push(yAxis),this.__hasChanged=!0}}addYAxisAtPosition(index,yAxisLayout,themeResourcesHeadlineColor,themeResourcesAxisColor){if(this.__canvasFrame){let yAxis=new YAxis(this.__yAxis.length+1,this.__canvasFrame,yAxisLayout,themeResourcesHeadlineColor,themeResourcesAxisColor);this.__yAxis.splice(index,0,yAxis),this.__hasChanged=!0}}deleteYAxis(index){this.__yAxis.splice(index,1),this.setHasChanged(!0)}deleteAllYAxis(){this.__yAxis=[],this.setHasChanged(!0)}addGrid(xAxisLayout,yAxisLayout,gridSize,themeResourcesGridColor){if(this.__canvasFrame){let grid=new Grid(this.__canvasFrame,xAxisLayout,yAxisLayout,gridSize,themeResourcesGridColor);this.__grid.push(grid),this.__hasChanged=!0}}addGridAtPosition(index,xAxisLayout,yAxisLayout,gridSize,themeResourcesGridColor){if(this.__canvasFrame){let grid=new Grid(this.__canvasFrame,xAxisLayout,yAxisLayout,gridSize,themeResourcesGridColor);this.__grid.splice(index,0,grid),this.__hasChanged=!0}}deleteGrid(index){this.__grid.splice(index,1),this.setHasChanged(!0)}deleteAllGrids(){this.__grid=[],this.setHasChanged(!0)}addSubgrid(xAxisLayout,yAxisLayout,gridSize,themeResourcesSubgridColor){if(this.__canvasFrame){let subgrid=new Subgrid(this.__canvasFrame,xAxisLayout,yAxisLayout,gridSize,themeResourcesSubgridColor);this.__subgrid.push(subgrid),this.__hasChanged=!0}}addSubgridAtPosition(index,xAxisLayout,yAxisLayout,gridSize,themeResourcesSubgridColor){if(this.__canvasFrame){let subgrid=new Subgrid(this.__canvasFrame,xAxisLayout,yAxisLayout,gridSize,themeResourcesSubgridColor);this.__subgrid.splice(index,0,subgrid),this.__hasChanged=!0}}deleteSubgrid(index){this.__subgrid.splice(index,1),this.setHasChanged(!0)}deleteAllSubgrids(){this.__subgrid=[],this.setHasChanged(!0)}addTrigger(triggerData){if(this.__canvasMarker){let __trigger=new Trigger(this.__canvasMarker,triggerData);this.__trigger.push(__trigger),this.__hasChanged=!0}}addTriggerAtPosition(index,triggerData){if(this.__canvasMarker){let __trigger=new Trigger(this.__canvasMarker,triggerData);this.__trigger.splice(index,0,__trigger),this.__hasChanged=!0}}deleteTrigger(index){this.__trigger.splice(index,1),this.setHasChanged(!0)}deleteAllTriggers(){this.__trigger=[],this.setHasChanged(!0)}addXYTrigger(xyTriggerData){if(this.__canvasMarker){let xyTrigger=new XYTrigger(this.__canvasMarker,xyTriggerData);this.__xyTrigger.push(xyTrigger),this.__hasChanged=!0}}addXYTriggerAtPosition(index,xyTriggerData){if(this.__canvasMarker){let xyTrigger=new XYTrigger(this.__canvasMarker,xyTriggerData);this.__xyTrigger.splice(index,0,xyTrigger),this.__hasChanged=!0}}deleteXYTrigger(index){this.__xyTrigger.splice(index,1),this.setHasChanged(!0)}deleteAllXYTriggers(){this.__xyTrigger=[],this.setHasChanged(!0)}addLineGraph(graphLayout,gridSize){if(this.__canvasDrawing&&this.__lineGraph&&graphLayout){let graph=new LineGraph(this.__canvasDrawing,graphLayout,gridSize);this.__lineGraph.set(graphLayout.graphName,graph),this.__lineChanged=!0}}deleteAllLineGraphs(){this.__lineGraph&&this.__lineGraph.clear(),this.__lineChanged=!0}remove(){super.remove(),this.deleteAllGrids(),this.deleteAllSubgrids(),this.deleteAllYAxis(),this.deleteAllXAxis(),this.deleteAllLineGraphs(),this.deleteAllTriggers(),this.deleteAllXYTriggers()}clear(width,height){super.clear(width,height),this.deleteAllGrids(),this.deleteAllSubgrids(),this.deleteAllYAxis(),this.deleteAllXAxis(),this.deleteAllLineGraphs(),this.deleteAllTriggers(),this.deleteAllXYTriggers()}getYAxis(){return this.__yAxis}getYAxisAtPosition(index){return this.__yAxis[index]}getXAxis(){return this.__xAxis}getXAxisAtPosition(index){return this.__xAxis[index]}getGrid(){return this.__grid}getGridAtPosition(index){return this.__grid[index]}getSubgrid(){return this.__subgrid}getSubgridAtPosition(index){return this.__subgrid[index]}getTriggerAtPosition(index){return this.__trigger[index]}getTrigger(){return this.__trigger}getXYTriggerAtPosition(index){return this.__xyTrigger[index]}getXYTrigger(){return this.__xyTrigger}getLineGraph(){return this.__lineGraph}getLineGraphWithName(name){return this.__lineGraph.get(name)}getHasChanged(){return this.__hasChanged}setHasChanged(hasChanged){this.__hasChanged=hasChanged}setLineChanged(lineChanged){this.__lineChanged=lineChanged}setAxisGroupForegroundColor(axisGroupForegroundColor){this.__axisGroupForegroundColor=axisGroupForegroundColor}draw(layout,themeResourcesCanvasColor){if(this.__canvasFrame&&this.__contextFrame){let canvasWidth=this.__canvasFrame.width/window.devicePixelRatio,canvasHeight=this.__canvasFrame.height/window.devicePixelRatio;if(this.__hasChanged){if(this.__contextFrame&&this.__contextFrame.clearRect(0,0,canvasWidth,canvasHeight),layout.headline){let fontFamily;const inheritedFontfamily=TcHmi.StyleProvider.getComputedElementStyle(this.__canvasFrame,"font-family")["font-family"];fontFamily=inheritedFontfamily||"sans-serif",this.__contextFrame.font=layout.headline.fontSize+"pt "+fontFamily,this.__contextFrame.fillStyle=this.__axisGroupForegroundColor,this.__contextFrame.textAlign="center",this.__contextFrame.textBaseline="top",this.__contextFrame.beginPath(),this.__contextFrame.fillText(layout.headline.label,layout.headline.position.x+layout.headline.dimensions.width/2,layout.headline.position.y)}for(let i=0,ii=this.__xAxis.length;i<ii;i++)this.__xAxis[i].drawAxis();for(let i=0,ii=this.__yAxis.length;i<ii;i++)this.__yAxis[i].drawAxis();if(this.__contextFrame.fillStyle=themeResourcesCanvasColor||layout.canvas.backgroundColor,this.__contextFrame.fillRect(layout.canvas.position.x,layout.canvas.position.y,layout.canvas.dimensions.width,layout.canvas.dimensions.height),layout.backgroundImage){let triggerIcon=backgroundImages.get(layout.backgroundImage.image);if(triggerIcon)this.__contextFrame.drawImage(triggerIcon,layout.backgroundImage.position.x,layout.backgroundImage.position.y,layout.backgroundImage.dimensions.width,layout.backgroundImage.dimensions.height);else{let image=new Image;image.src=tchmi_path(layout.backgroundImage.image),image.onload=()=>{layout.backgroundImage?.image&&backgroundImages.set(layout.backgroundImage.image,image),this.__lineChanged=!0,this.__hasChanged=!0,this.draw(layout,themeResourcesCanvasColor)}}}for(let i=0,ii=this.__grid.length;i<ii;i++)this.__grid[i].draw();for(let i=0,ii=this.__subgrid.length;i<ii;i++)this.__subgrid[i].draw();this.__hasChanged=!1}if(this.__lineChanged){if(this.__contextDrawing&&this.__contextDrawing.clearRect(0,0,canvasWidth,canvasHeight),this.__lineGraph.forEach((graph,key)=>{graph.draw()}),this.__contextDrawing){let transform=this.__contextDrawing.getTransform(),horizontalMove=transform.e/window.devicePixelRatio,verticalMove=transform.f/window.devicePixelRatio;verticalMove>=0?horizontalMove>=0?(this.__contextDrawing.clearRect(-horizontalMove,-verticalMove,canvasWidth+horizontalMove,layout.canvas.position.y+verticalMove),this.__contextDrawing.clearRect(-horizontalMove,canvasHeight-verticalMove,canvasWidth+horizontalMove,-(canvasHeight-layout.canvas.dimensions.height-layout.canvas.position.y)),this.__contextDrawing.clearRect(-horizontalMove,-verticalMove,layout.canvas.position.x+horizontalMove,canvasHeight+verticalMove),this.__contextDrawing.clearRect(canvasWidth-horizontalMove,-verticalMove,-(canvasWidth-layout.canvas.position.x-layout.canvas.dimensions.width),canvasHeight+verticalMove)):(this.__contextDrawing.clearRect(-horizontalMove,-verticalMove,canvasWidth+horizontalMove,layout.canvas.position.y+verticalMove),this.__contextDrawing.clearRect(-horizontalMove,canvasHeight-verticalMove,canvasWidth+horizontalMove,-(canvasHeight-layout.canvas.dimensions.height-layout.canvas.position.y)),this.__contextDrawing.clearRect(-horizontalMove,-verticalMove,layout.canvas.position.x,canvasHeight+verticalMove),this.__contextDrawing.clearRect(canvasWidth-horizontalMove,-verticalMove,-(canvasWidth-layout.canvas.position.x-layout.canvas.dimensions.width-horizontalMove),canvasHeight+verticalMove)):horizontalMove>=0?(this.__contextDrawing.clearRect(-horizontalMove,-verticalMove,canvasWidth+horizontalMove,layout.canvas.position.y),this.__contextDrawing.clearRect(-horizontalMove,canvasHeight-verticalMove,canvasWidth+horizontalMove,-(canvasHeight-layout.canvas.dimensions.height-layout.canvas.position.y-verticalMove)),this.__contextDrawing.clearRect(-horizontalMove,-verticalMove,layout.canvas.position.x+horizontalMove,canvasHeight+verticalMove),this.__contextDrawing.clearRect(canvasWidth-horizontalMove,-verticalMove,-(canvasWidth-layout.canvas.position.x-layout.canvas.dimensions.width),canvasHeight+verticalMove)):(this.__contextDrawing.clearRect(-horizontalMove,-verticalMove,canvasWidth+horizontalMove,layout.canvas.position.y),this.__contextDrawing.clearRect(-horizontalMove,canvasHeight-verticalMove,canvasWidth+horizontalMove,-(canvasHeight-layout.canvas.dimensions.height-layout.canvas.position.y-verticalMove)),this.__contextDrawing.clearRect(-horizontalMove,-verticalMove,layout.canvas.position.x,canvasHeight+verticalMove),this.__contextDrawing.clearRect(canvasWidth-horizontalMove,-verticalMove,-(canvasWidth-layout.canvas.position.x-layout.canvas.dimensions.width-horizontalMove),canvasHeight+verticalMove))}this.__contextMarker&&this.__contextMarker.clearRect(0,0,canvasWidth,canvasHeight);for(const xyTrigger of this.__xyTrigger)xyTrigger.draw();if(this.__contextMarker){let transform=this.__contextMarker.getTransform(),horizontalMove=transform.e/window.devicePixelRatio,verticalMove=transform.f/window.devicePixelRatio;this.__contextMarker.clearRect(-horizontalMove,-verticalMove,canvasWidth+horizontalMove,layout.canvas.position.y),this.__contextMarker.clearRect(-horizontalMove,canvasHeight-verticalMove,canvasWidth+horizontalMove,-(canvasHeight-layout.canvas.position.y-layout.canvas.dimensions.height)),this.__contextMarker.clearRect(-horizontalMove,-verticalMove,layout.canvas.position.x,canvasHeight),this.__contextMarker.clearRect(canvasWidth-horizontalMove,-verticalMove,-(canvasWidth-layout.canvas.position.x-layout.canvas.dimensions.width),canvasHeight)}for(const trigger of this.__trigger)trigger.draw();this.__lineChanged=!1}}}drawTrigger(){for(const trigger of this.__trigger)trigger.draw()}}export var LineStyle;!function(LineStyle){LineStyle[LineStyle.Dotted=0]="Dotted",LineStyle[LineStyle.Dashed=1]="Dashed",LineStyle[LineStyle.Solid=2]="Solid"}(LineStyle||(LineStyle={}));
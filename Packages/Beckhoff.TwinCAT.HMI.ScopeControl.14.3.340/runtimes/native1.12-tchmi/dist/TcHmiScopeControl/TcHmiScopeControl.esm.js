var __runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};import{TcHmiControl}from"Beckhoff.TwinCAT.HMI.Framework/index.esm.js";import{ServerSymbols}from"./ServerSymbols.js";import{Dialog}from"./Dialog.js";import{TimeRangeDialog}from"./TimeRangeDialog.js";import{ButtonsEnabled,ChartColorSource,ChartType,Direction,MouseMode,ConfigType,Orientation,TimesEnabled,TriggerWindowPosition}from"./Types.js";import{ScopeChart}from"./ScopeChart.js";import{DigitalChart as DigitalChartClass}from"./DigitalChart.js";import{isDigitalChartData,isDigitalChartLayout,__isoToScopeString,__isoToMilliSec}from"./ScopeHelper.js";export let triggerImages=new Map;export let backgroundImages=new Map;let TcHmiScopeControl=(()=>{var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r,_s,_t,_u;let ___initCallback_decorators,___getUploadedRecordsCallback_decorators,___eventRegisterDoneCallback_decorators,___initChanged_decorators,___onThemeDataChanged_decorators,___onUserDataChanged_decorators,___onExtensionStateChanged_decorators,___scopeEventCallback_decorators,___configEventCallback_decorators,___rebuild_decorators,___connectionCallback_decorators,___setChartSizeCallback_decorators,___resubscribeMenubarCallback_decorators,___resubscribeTriggerWindowCallback_decorators,___getMenubarCallback_decorators,___resubscribeGetDataCallback_decorators,___resubscribeActualWindowCallback_decorators,___getDataCallback_decorators,___onPressed_decorators,___onTriggerDatagrid_DataChanged_decorators,___onUserInteractionFinished_decorators,___onCheckboxMouseDown_decorators,___onCheckboxTouchStart_decorators,___onMouseDown_decorators,___onMouseDownGlobal_decorators,___onMouseMove_decorators,___onMouseMoveChangeCursor_decorators,___onMouseMoveOverview_decorators,___onMouseUpOverview_decorators,___onMouseUp_decorators,___onMouseWheel_decorators,___onTouchStart_decorators,___onTouchMove_decorators,___onTouchEnd_decorators,___onResolverForScopeConfigWatchCallback_decorators,_classSuper=TcHmiControl.Control,_instanceExtraInitializers=[];return class TcHmiScopeControl extends _classSuper{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(_classSuper[Symbol.metadata]??null):void 0;___initCallback_decorators=[(_a=TcHmi).CallbackMethod.bind(_a)],___getUploadedRecordsCallback_decorators=[(_b=TcHmi).CallbackMethod.bind(_b)],___eventRegisterDoneCallback_decorators=[(_c=TcHmi).CallbackMethod.bind(_c)],___initChanged_decorators=[(_d=TcHmi).CallbackMethod.bind(_d)],___onThemeDataChanged_decorators=[(_e=TcHmi).CallbackMethod.bind(_e)],___onUserDataChanged_decorators=[(_f=TcHmi).CallbackMethod.bind(_f)],___onExtensionStateChanged_decorators=[(_g=TcHmi).CallbackMethod.bind(_g)],___scopeEventCallback_decorators=[(_h=TcHmi).CallbackMethod.bind(_h)],___configEventCallback_decorators=[(_j=TcHmi).CallbackMethod.bind(_j)],___rebuild_decorators=[(_k=TcHmi).CallbackMethod.bind(_k)],___connectionCallback_decorators=[(_l=TcHmi).CallbackMethod.bind(_l)],___setChartSizeCallback_decorators=[(_m=TcHmi).CallbackMethod.bind(_m)],___resubscribeMenubarCallback_decorators=[(_o=TcHmi).CallbackMethod.bind(_o)],___resubscribeTriggerWindowCallback_decorators=[(_p=TcHmi).CallbackMethod.bind(_p)],___getMenubarCallback_decorators=[(_q=TcHmi).CallbackMethod.bind(_q)],___resubscribeGetDataCallback_decorators=[(_r=TcHmi).CallbackMethod.bind(_r)],___resubscribeActualWindowCallback_decorators=[(_s=TcHmi).CallbackMethod.bind(_s)],___getDataCallback_decorators=[(_t=TcHmi).CallbackMethod.bind(_t)],___onPressed_decorators=[TcHmi.EventHandler()],___onTriggerDatagrid_DataChanged_decorators=[TcHmi.EventHandler()],___onUserInteractionFinished_decorators=[TcHmi.EventHandler()],___onCheckboxMouseDown_decorators=[TcHmi.EventHandler({checkIsEnabled:!0})],___onCheckboxTouchStart_decorators=[TcHmi.EventHandler({checkIsEnabled:!0})],___onMouseDown_decorators=[TcHmi.EventHandler({checkIsEnabled:!0,checkAccess:"operate"})],___onMouseDownGlobal_decorators=[TcHmi.EventHandler({checkIsEnabled:!0,checkAccess:"operate"})],___onMouseMove_decorators=[TcHmi.EventHandler({checkIsEnabled:!0})],___onMouseMoveChangeCursor_decorators=[TcHmi.EventHandler({checkIsEnabled:!0})],___onMouseMoveOverview_decorators=[TcHmi.EventHandler({checkIsEnabled:!0})],___onMouseUpOverview_decorators=[TcHmi.EventHandler({checkIsEnabled:!0,checkAccess:"operate"})],___onMouseUp_decorators=[TcHmi.EventHandler({checkIsEnabled:!0})],___onMouseWheel_decorators=[TcHmi.EventHandler({checkIsEnabled:!0,checkAccess:"operate"})],___onTouchStart_decorators=[TcHmi.EventHandler({checkIsEnabled:!0,checkAccess:"operate"})],___onTouchMove_decorators=[TcHmi.EventHandler({checkIsEnabled:!0})],___onTouchEnd_decorators=[TcHmi.EventHandler({checkIsEnabled:!0})],___onResolverForScopeConfigWatchCallback_decorators=[(_u=TcHmi).CallbackMethod.bind(_u)],__esDecorate(this,null,___initCallback_decorators,{kind:"method",name:"__initCallback",static:!1,private:!1,access:{has:obj=>"__initCallback"in obj,get:obj=>obj.__initCallback},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___getUploadedRecordsCallback_decorators,{kind:"method",name:"__getUploadedRecordsCallback",static:!1,private:!1,access:{has:obj=>"__getUploadedRecordsCallback"in obj,get:obj=>obj.__getUploadedRecordsCallback},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___eventRegisterDoneCallback_decorators,{kind:"method",name:"__eventRegisterDoneCallback",static:!1,private:!1,access:{has:obj=>"__eventRegisterDoneCallback"in obj,get:obj=>obj.__eventRegisterDoneCallback},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___initChanged_decorators,{kind:"method",name:"__initChanged",static:!1,private:!1,access:{has:obj=>"__initChanged"in obj,get:obj=>obj.__initChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onThemeDataChanged_decorators,{kind:"method",name:"__onThemeDataChanged",static:!1,private:!1,access:{has:obj=>"__onThemeDataChanged"in obj,get:obj=>obj.__onThemeDataChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onUserDataChanged_decorators,{kind:"method",name:"__onUserDataChanged",static:!1,private:!1,access:{has:obj=>"__onUserDataChanged"in obj,get:obj=>obj.__onUserDataChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onExtensionStateChanged_decorators,{kind:"method",name:"__onExtensionStateChanged",static:!1,private:!1,access:{has:obj=>"__onExtensionStateChanged"in obj,get:obj=>obj.__onExtensionStateChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___scopeEventCallback_decorators,{kind:"method",name:"__scopeEventCallback",static:!1,private:!1,access:{has:obj=>"__scopeEventCallback"in obj,get:obj=>obj.__scopeEventCallback},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___configEventCallback_decorators,{kind:"method",name:"__configEventCallback",static:!1,private:!1,access:{has:obj=>"__configEventCallback"in obj,get:obj=>obj.__configEventCallback},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___rebuild_decorators,{kind:"method",name:"__rebuild",static:!1,private:!1,access:{has:obj=>"__rebuild"in obj,get:obj=>obj.__rebuild},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___connectionCallback_decorators,{kind:"method",name:"__connectionCallback",static:!1,private:!1,access:{has:obj=>"__connectionCallback"in obj,get:obj=>obj.__connectionCallback},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___setChartSizeCallback_decorators,{kind:"method",name:"__setChartSizeCallback",static:!1,private:!1,access:{has:obj=>"__setChartSizeCallback"in obj,get:obj=>obj.__setChartSizeCallback},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___resubscribeMenubarCallback_decorators,{kind:"method",name:"__resubscribeMenubarCallback",static:!1,private:!1,access:{has:obj=>"__resubscribeMenubarCallback"in obj,get:obj=>obj.__resubscribeMenubarCallback},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___resubscribeTriggerWindowCallback_decorators,{kind:"method",name:"__resubscribeTriggerWindowCallback",static:!1,private:!1,access:{has:obj=>"__resubscribeTriggerWindowCallback"in obj,get:obj=>obj.__resubscribeTriggerWindowCallback},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___getMenubarCallback_decorators,{kind:"method",name:"__getMenubarCallback",static:!1,private:!1,access:{has:obj=>"__getMenubarCallback"in obj,get:obj=>obj.__getMenubarCallback},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___resubscribeGetDataCallback_decorators,{kind:"method",name:"__resubscribeGetDataCallback",static:!1,private:!1,access:{has:obj=>"__resubscribeGetDataCallback"in obj,get:obj=>obj.__resubscribeGetDataCallback},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___resubscribeActualWindowCallback_decorators,{kind:"method",name:"__resubscribeActualWindowCallback",static:!1,private:!1,access:{has:obj=>"__resubscribeActualWindowCallback"in obj,get:obj=>obj.__resubscribeActualWindowCallback},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___getDataCallback_decorators,{kind:"method",name:"__getDataCallback",static:!1,private:!1,access:{has:obj=>"__getDataCallback"in obj,get:obj=>obj.__getDataCallback},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onPressed_decorators,{kind:"method",name:"__onPressed",static:!1,private:!1,access:{has:obj=>"__onPressed"in obj,get:obj=>obj.__onPressed},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onTriggerDatagrid_DataChanged_decorators,{kind:"method",name:"__onTriggerDatagrid_DataChanged",static:!1,private:!1,access:{has:obj=>"__onTriggerDatagrid_DataChanged"in obj,get:obj=>obj.__onTriggerDatagrid_DataChanged},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onUserInteractionFinished_decorators,{kind:"method",name:"__onUserInteractionFinished",static:!1,private:!1,access:{has:obj=>"__onUserInteractionFinished"in obj,get:obj=>obj.__onUserInteractionFinished},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onCheckboxMouseDown_decorators,{kind:"method",name:"__onCheckboxMouseDown",static:!1,private:!1,access:{has:obj=>"__onCheckboxMouseDown"in obj,get:obj=>obj.__onCheckboxMouseDown},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onCheckboxTouchStart_decorators,{kind:"method",name:"__onCheckboxTouchStart",static:!1,private:!1,access:{has:obj=>"__onCheckboxTouchStart"in obj,get:obj=>obj.__onCheckboxTouchStart},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onMouseDown_decorators,{kind:"method",name:"__onMouseDown",static:!1,private:!1,access:{has:obj=>"__onMouseDown"in obj,get:obj=>obj.__onMouseDown},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onMouseDownGlobal_decorators,{kind:"method",name:"__onMouseDownGlobal",static:!1,private:!1,access:{has:obj=>"__onMouseDownGlobal"in obj,get:obj=>obj.__onMouseDownGlobal},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onMouseMove_decorators,{kind:"method",name:"__onMouseMove",static:!1,private:!1,access:{has:obj=>"__onMouseMove"in obj,get:obj=>obj.__onMouseMove},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onMouseMoveChangeCursor_decorators,{kind:"method",name:"__onMouseMoveChangeCursor",static:!1,private:!1,access:{has:obj=>"__onMouseMoveChangeCursor"in obj,get:obj=>obj.__onMouseMoveChangeCursor},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onMouseMoveOverview_decorators,{kind:"method",name:"__onMouseMoveOverview",static:!1,private:!1,access:{has:obj=>"__onMouseMoveOverview"in obj,get:obj=>obj.__onMouseMoveOverview},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onMouseUpOverview_decorators,{kind:"method",name:"__onMouseUpOverview",static:!1,private:!1,access:{has:obj=>"__onMouseUpOverview"in obj,get:obj=>obj.__onMouseUpOverview},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onMouseUp_decorators,{kind:"method",name:"__onMouseUp",static:!1,private:!1,access:{has:obj=>"__onMouseUp"in obj,get:obj=>obj.__onMouseUp},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onMouseWheel_decorators,{kind:"method",name:"__onMouseWheel",static:!1,private:!1,access:{has:obj=>"__onMouseWheel"in obj,get:obj=>obj.__onMouseWheel},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onTouchStart_decorators,{kind:"method",name:"__onTouchStart",static:!1,private:!1,access:{has:obj=>"__onTouchStart"in obj,get:obj=>obj.__onTouchStart},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onTouchMove_decorators,{kind:"method",name:"__onTouchMove",static:!1,private:!1,access:{has:obj=>"__onTouchMove"in obj,get:obj=>obj.__onTouchMove},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onTouchEnd_decorators,{kind:"method",name:"__onTouchEnd",static:!1,private:!1,access:{has:obj=>"__onTouchEnd"in obj,get:obj=>obj.__onTouchEnd},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onResolverForScopeConfigWatchCallback_decorators,{kind:"method",name:"__onResolverForScopeConfigWatchCallback",static:!1,private:!1,access:{has:obj=>"__onResolverForScopeConfigWatchCallback"in obj,get:obj=>obj.__onResolverForScopeConfigWatchCallback},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}static#tchmiFQN="TcHmi.Controls.Beckhoff.TcHmiScopeControl."+this.name;constructor(element,pcElement,attrs){super(element,pcElement,attrs),this.__serverSymbolsHelper=new ServerSymbols(this)}__elementTemplateRoot=__runInitializers(this,_instanceExtraInitializers);__elementChartings;__elementTriggerWindow;__elementBorder;__elementOverview;__elementChartName;__elementMenuBar;__elementMenuBarDropdown;__elementToolBar;__elementTimeBar;__elementLegend;__elementLoading;__elementTooltip;__elementTooltipText;__elementTooltipArrow;__elementDialog;__elementTimeRangeDialog;__storage;__replace=void 0;__localizedElements=new Map;__localizedEngineeringElements=new Map;__localizationReader=void 0;__scopeIsInitialized=!1;__showLegend=!0;__scaling={x:1,y:1};__scopeConfig;__serverInterval;__serverDomain;__enableRecordControls;__chartChartColorSource;__triggerWindowPosition;__showTriggerWindow;__autostartRecord;__iCharts=[];__overviewChart=null;__chartingElements=[];__toolBarControls={};__toolBarControlsArray=[];__timeBarControls={};__datagrid;__initEventDestroyEvent=null;__scopeEventsDestroyEvent=null;__configEventsDestroyEvent=null;__subscriptionIds={dataLayoutAndWindow:null,onExtensionStateChanged:null,menubar:null,actualWindow:null,getRecords:null,triggerWindow:null,getAllUploadedRecords:null,getOwnUploadedRecords:null};__requestIds={init:null,openConnection:null,setChartSize:null,startRecord:null,stopRecord:null,start:null,stop:null,zoom:null,pan:null,wheel:null,unzoom:null,zoomOut:null,displayWidth:null,goto:null,scroll:null,scrollBig:null,undo:null,redo:null,setOverviewMode:null,setOverviewRect:null,getTooltip:null,changeChannelState:null,resizeCharts:null,saveCurrentRecord:null,setTriggerComment:null,uploadedRecords:null,deleteScopeRecord:null,changePersist:null,getAnalyticsData:null,getChartList:null,openConnectionToFile:null,getMenubar:null,getData:null,closeConnection:null,clickOverviewElement:null,setAnalyticsRecord:null,moveTrigger:null};__tooltipTimeout=null;__menubar;__legend;__scopeLayout;__scopeGraphData;__scopeGraphWindow=null;__triggerWindow=null;__enabledButtons=ButtonsEnabled.None;__enabledTimes=TimesEnabled.None;__sessionId=null;__socketId=null;__extensionInitCompleted=!1;__scopeConfigLoaded=!1;__mouseMode=MouseMode.None;__manipulationInfo={isManipulating:!1,start:{x:0,y:0},end:{x:0,y:0},offset:{left:0,top:0},transform:{x:0,y:0},click:!0,mousePosition:{x:0,y:0},elementIndex:-1,isOverviewSizeChanged:!1,beginOverviewRectChanging:!0,chartSizeChanged:!1,resizeLineIndex:0,touchIdentifier:0,resizeTriggerWindow:!1,trigger:{move:!1,id:0}};__multitouchInfo={multitouchMode:!1,first:{identifier:null,startPoint:{x:0,y:0}},second:{identifier:null,startPoint:{x:0,y:0}},offset:{left:0,top:0},distance:0,elementIndex:-1,middlePoint:{x:0,y:0}};__wheelInfo={isWheeling:!1,wheelSteps:0,mousePosition:{x:0,y:0},timeout:0};__resizeLines=[];__destroyEvents={};__themeChartBackgroundColor=null;__themeChartForegroundColor=null;__themeOverviewBackgroundColor=null;__themeOverviewForegroundColor=null;__themeCanvasBackgroundColor=null;__themeAxisColor=null;__themeGridColor=null;__themeAxisGroupForegroundColor=null;__displayWidthText;__gotoText;__showOverview;__overviewRectangle={position:{x:0,y:0},dimensions:{width:0,height:0}};__loadingSpinner=null;__virtualMappingForControlRecord=[{controlRight:"operate",virtualControlRight:"controlRecord"}];__virtualMappingForChangeHistoricalAquisitions=[{controlRight:"operate",virtualControlRight:"changeHistoricalAquisitions"}];__timeRangeDialog=null;__dialog=null;__uploadedRecordsForActUser=null;__scopeConfigToFile=null;__oldScopeConfig=void 0;__errorPrompt=null;__activeLegendElements;__serverSymbolsHelper;__extensionState=void 0;__previnit(){if(this.__elementTemplateRoot=this.__element.find(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template"),this.__elementChartings=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-chartings"),this.__elementTriggerWindow=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-trigger-window"),this.__elementBorder=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-border"),this.__elementOverview=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-overview"),this.__elementChartName=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-chart-name"),this.__elementMenuBar=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar"),this.__elementTimeBar=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-time-bar"),this.__elementToolBar=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-tool-bar"),this.__elementMenuBarDropdown=$('<div\n                class="TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-dropdown TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-popup tchmi-box"\n            >\n                <div\n                    class="TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-time-bar-dropdown tchmi-box"\n                ></div>\n                <div\n                    class="TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tool-bar-dropdown tchmi-box"\n                ></div>\n            </div>'),this.__elementLegend=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-legend"),this.__elementLoading=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-loading"),this.__elementTooltip=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip"),this.__elementTooltipText=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-text"),this.__elementTooltipArrow=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow"),this.__elementDialog=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-dialog"),this.__elementTimeRangeDialog=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-time-range-dialog"),0===this.__elementTemplateRoot.length||0===this.__elementChartings.length||0===this.__elementTriggerWindow.length||0===this.__elementBorder.length||0===this.__elementOverview.length||0===this.__elementChartName.length||0===this.__elementMenuBar.length||0===this.__elementTimeBar.length||0===this.__elementToolBar.length||0===this.__elementMenuBarDropdown.length||0===this.__elementLegend.length||0===this.__elementLoading.length||0===this.__elementTooltip.length||0===this.__elementTooltipText.length||0===this.__elementTooltipArrow.length||0===this.__elementDialog.length||0===this.__elementTimeRangeDialog.length)throw new Error("Invalid Template.html");let loadingSpinnerDivTempDiv=document.createElement("div");loadingSpinnerDivTempDiv.innerHTML='<div\n            class="TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-loading-spinner-container"\n        >\n            <div class="TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-loading-spinner">\n                <div></div>\n                <div></div>\n                <div></div>\n                <div></div>\n            </div>\n        </div>',this.__loadingSpinner=loadingSpinnerDivTempDiv.firstElementChild;let localizedElements=this.__element[0].querySelectorAll("[data-tchmi-localized-content-key]");for(let i=0,ii=localizedElements.length;i<ii;i++){let element=localizedElements[i],localizeKey=element.dataset.tchmiLocalizedContentKey;localizeKey&&this.__localizedElements.set(localizeKey,{element,value:""})}TCHMI_DESIGNER?this.__destroyOnDestroy.push(this.__localization.watchEx({level:TcHmi.Locale.Level.Engineering},data=>{if(data.error===TcHmi.Errors.NONE&&data.reader){this.__localizationReader=data.reader;for(const[key,info]of this.__localizedEngineeringElements){let localizedText=data.reader.get(key);info.textContent=localizedText}}})):this.__destroyOnDestroy.push(this.__localization.watch(data=>{if(data.error===TcHmi.Errors.NONE&&data.reader){this.__localizationReader=data.reader;for(const[key,info]of this.__localizedElements){let localizedText=data.reader.get(key);if(key.includes("Tooltip"))info.element.title=tchmi_decode_control_characters(localizedText);else if(null!==info.value)if(info.value.includes("Label_Text_Date_Placeholder")){let valueLocalization=this.__localizationReader.get("Label_Text_Date_Placeholder");info.element.textContent=tchmi_decode_control_characters(localizedText+": "+valueLocalization)}else key.includes("Label_Text_")?info.element.textContent=tchmi_decode_control_characters(localizedText+": "+info.value):info.element.textContent=tchmi_decode_control_characters(localizedText);else info.element.textContent=tchmi_decode_control_characters(localizedText)}}})),super.__previnit()}__init(){super.__init(),this.__storage=new TcHmi.LocalStorage(this,{replace:this.getReplace(),activeLegendElements:this.getScopeConfig()}),this.__activeLegendElements=this.__storage.get("activeLegendElements");let triggerWindowDatagrid=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiDatagrid",`${this.__id}_triggerWindowDatagrid`,{"data-tchmi-src-column":[{name:"count",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Label_Count%/l%",control:"TextBlock",width:1,widthUnit:"factor",resize:!0,sortable:!1,editable:!1,horizontalAlignment:"Center",verticalAlignment:"Center",headerHorizontalAlignment:"Center",headerVerticalAlignment:"Center"},{name:"triggerGroup",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Label_Trigger_Group%/l%",control:"TextBlock",width:30,widthUnit:"%",resize:!0,sortable:!1,editable:!1,horizontalAlignment:"Center",verticalAlignment:"Center",headerHorizontalAlignment:"Center",headerVerticalAlignment:"Center"},{name:"releaseTime",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Label_Release_Time%/l%",control:"TextBlock",width:30,widthUnit:"%",resize:!0,sortable:!1,editable:!1,horizontalAlignment:"Center",verticalAlignment:"Center",headerHorizontalAlignment:"Center",headerVerticalAlignment:"Center"},{name:"comment",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Label_Comment%/l%",control:"TextBox",width:25,widthUnit:"%",resize:!0,sortable:!1,editable:!0,horizontalAlignment:"Center",verticalAlignment:"Center",headerHorizontalAlignment:"Center",headerVerticalAlignment:"Center"}],"data-tchmi-width":100,"data-tchmi-width-unit":"%","data-tchmi-height":100,"data-tchmi-height-unit":"%","data-tchmi-show-row-numbers":!1},this);if(!triggerWindowDatagrid)throw new Error("Needed Datagrid could not be instantiated");if(triggerWindowDatagrid.getElement()[0].classList.add("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-trigger-window-datagrid"),this.__elementTriggerWindow[0].appendChild(triggerWindowDatagrid.getElement()[0]),this.__datagrid=triggerWindowDatagrid,this.__destroyOnDestroy.push(TcHmi.EventProvider.register(this.__datagrid.getId()+".onDataChanged",this.__onTriggerDatagrid_DataChanged),TcHmi.EventProvider.registerDomEvent(this.__elementLegend,"mousedown",this.__onCheckboxMouseDown),TcHmi.EventProvider.registerDomEvent(this.__elementLegend,"touchstart",this.__onCheckboxTouchStart)),this.__loadThemedResources(),TCHMI_DESIGNER)return;if(this.__serverDomain){this.__configEventsDestroyEvent=TcHmi.Server.Events.registerConsumer([{path:"domain",comparator:"==",value:this.__serverDomain},{logic:"AND"},{path:"payload::configType",comparator:">=",value:0},{logic:"OR"},{path:"payload::type",comparator:"==",value:"general"}],{subscription:this.__configEventCallback});let symbol="ListDomains";this.__subscriptionIds.onExtensionStateChanged=TcHmi.Server.subscribe([{commandOptions:["SendErrorMessage","UniqueHash"],symbol}],300,this.__onExtensionStateChanged)}let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".Init",writeValue:{controlName:this.__id}},{commandOptions:["SendErrorMessage"],symbol:"GetSymbolAccess",writeValue:this.__serverDomain+".GetAllUploadedRecords"}]};TcHmi.Server.releaseRequest(this.__requestIds.init),this.__requestIds.init=TcHmi.Server.requestEx(request,null,this.__initCallback)}getReplace(){return this.__replace}__clearInit(){for(let[key,value]of Object.entries(this.__subscriptionIds))value&&(TcHmi.Server.unsubscribe(value,null),this.__subscriptionIds[key]=null);this.__scopeEventsDestroyEvent?.(),this.__scopeEventsDestroyEvent=null,this.__dialog?.resetToDefault(),this.__sessionId=null,this.__socketId=null,this.__extensionInitCompleted=!1;let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".Init",writeValue:{controlName:this.__id}},{commandOptions:["SendErrorMessage"],symbol:"GetSymbolAccess",writeValue:this.__serverDomain+".GetAllUploadedRecords"}]};TcHmi.Server.releaseRequest(this.__requestIds.init),this.__requestIds.init=TcHmi.Server.requestEx(request,null,this.__initCallback),this.__openWebsocket()}__initCallback(result){if(!this.__isDestroyed&&null!==this.__requestIds.init)if(this.__requestIds.init=null,result&&result.error===TcHmi.Errors.NONE&&result.response){if(result.response.error)return TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Server responds with error. Details: ${TcHmi.Log.buildMessage(result.response.error)}`),void this.__loadingSpinner?.remove();if(result.response.commands)for(let i=0,ii=result.response.commands.length;i<ii;i++){if(result.response.commands[i].error&&130!==result.response.commands[i].error.code)return TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Server responds with error for command for symbol=${result.response.commands[i].symbol}. Details: ${TcHmi.Log.buildMessage(result.response.commands[i].error)}`),this.__loadingSpinner?.remove(),void this.__clearFullControl();if(result.response.commands[i].symbol===this.__serverDomain+".Init"){let sessionId=result.response.sessionId,socketId=result.response.commands[i].readValue?.socketId;this.__extensionInitCompleted=result.response.commands[i].readValue?.initCompleted??!0,sessionId&&socketId&&this.__serverDomain&&(this.__sessionId=sessionId,this.__socketId=socketId,this.__scopeEventsDestroyEvent=TcHmi.Server.Events.registerConsumer([{path:"domain",comparator:"==",value:this.__serverDomain},{logic:"AND"},{path:"payload::sessionId",comparator:"==",value:this.__sessionId},{logic:"AND"},{path:"payload::socketId",comparator:"==",value:this.__socketId}],{subscription:this.__scopeEventCallback},this.__eventRegisterDoneCallback))}else if(null!==result.response.commands[i].readValue&&"GetSymbolAccess"===result.response.commands[i].symbol)if(this.__subscriptionIds.getAllUploadedRecords&&TcHmi.Server.unsubscribe(this.__subscriptionIds.getAllUploadedRecords,null),this.__subscriptionIds.getOwnUploadedRecords&&TcHmi.Server.unsubscribe(this.__subscriptionIds.getOwnUploadedRecords,null),3===result.response.commands[i].readValue){let symbol=this.__serverDomain+".GetAllUploadedRecords";this.__subscriptionIds.getAllUploadedRecords=TcHmi.Server.subscribe([{commandOptions:["SendErrorMessage","UniqueHash"],symbol}],1e3,this.__getUploadedRecordsCallback)}else{let symbol=this.__serverDomain+".GetOwnUploadedRecords";this.__subscriptionIds.getOwnUploadedRecords=TcHmi.Server.subscribe([{commandOptions:["SendErrorMessage","UniqueHash"],symbol}],1e3,this.__getUploadedRecordsCallback)}}}else this.__loadingSpinner?.remove(),result.error&&TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Framework error= ${result.error}, name= ${TcHmi.Errors[result.error]} while fetching data from server. Details: `+TcHmi.Log.buildMessage(result.details))}__getUploadedRecordsCallback(result){if(!this.__isDestroyed&&result&&result.error===TcHmi.Errors.NONE&&result.response){if(result.response.error)return void TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Server responds with error. Details: ${TcHmi.Log.buildMessage(result.response.error)}`);if(result.response.commands)for(let i=0,ii=result.response.commands.length;i<ii;i++)result.response.commands[i].error&&TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Server responds with error for command for symbol=${result.response.commands[i].symbol}. Details: ${TcHmi.Log.buildMessage(result.response.commands[i].error)}`),result.response.commands[i].symbol!==this.__serverDomain+".GetAllUploadedRecords"&&result.response.commands[i].symbol!==this.__serverDomain+".GetOwnUploadedRecords"||(this.__uploadedRecordsForActUser=result.response.commands[i].readValue,this.__dialog?.setSrcDataOfRecordsDatagrid(this.__uploadedRecordsForActUser))}}__eventRegisterDoneCallback(data){data.error!==TcHmi.Errors.NONE&&TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Error registering the scope event consumer. Details: ${data.error} IMPORTANT: No scope events are logged now. All messages and errors are displayed on the server log page.`),this.__scopeIsInitialized=!0,TcHmi.EventProvider.raise(this.__id+".onInitChanged")}__initChanged(evt){this.__initEventDestroyEvent?.(),this.__initEventDestroyEvent=null,this.__openConnection()}__attach(){if(super.__attach(),!TCHMI_DESIGNER&&this.__serverDomain&&this.__loadingSpinner&&this.__elementLoading[0].appendChild(this.__loadingSpinner),!TCHMI_DESIGNER){const passiveEventOptions={passive:!0,capture:!1},activeEventOptions={passive:!1,capture:!1};this.__destroyOnDetach.push(TcHmi.EventProvider.registerDomEvent(document,"mousedown",this.__onMouseDownGlobal,passiveEventOptions),TcHmi.EventProvider.registerDomEvent(document,"mousemove",this.__onMouseMove,passiveEventOptions),TcHmi.EventProvider.registerDomEvent(document,"mouseup",this.__onMouseUp,passiveEventOptions),TcHmi.EventProvider.registerDomEvent(document,"touchmove",this.__onTouchMove,activeEventOptions),TcHmi.EventProvider.registerDomEvent(document,"touchend",this.__onTouchEnd,activeEventOptions),TcHmi.EventProvider.registerDomEvent(this.__element[0],"mousemove",this.__onMouseMoveChangeCursor,passiveEventOptions),TcHmi.EventProvider.register(this.__id+".onResized",this.__rebuild),TcHmi.EventProvider.register("onThemeDataChanged",this.__onThemeDataChanged),TcHmi.EventProvider.register("onUserDataChanged",this.__onUserDataChanged))}this.__replace=this.__storage?.get("replace"),this.__openWebsocket()}__detach(){super.__detach(),this.__initEventDestroyEvent?.(),this.__initEventDestroyEvent=null,null!==this.__scopeEventsDestroyEvent&&(this.__scopeEventsDestroyEvent(),this.__scopeEventsDestroyEvent=null);for(let[key,value]of Object.entries(this.__requestIds))value&&(TcHmi.Server.unsubscribe(value,null),this.__requestIds[key]=null);for(let[key,value]of Object.entries(this.__subscriptionIds))value&&"onExtensionStateChanged"!==key&&(TcHmi.Server.unsubscribe(value,null),this.__subscriptionIds[key]=null);let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".DetachControl",writeValue:{controlName:this.__id,scopeConfig:this.__scopeConfig}}]};TcHmi.Server.requestEx(request,{parallel:!0})}destroy(){if(!this.__keepAlive){if(super.destroy(),null!==this.__subscriptionIds.onExtensionStateChanged&&(TcHmi.Server.unsubscribe(this.__subscriptionIds.onExtensionStateChanged,null),this.__subscriptionIds.onExtensionStateChanged=null),this.__configEventsDestroyEvent?.(),this.__configEventsDestroyEvent=null,this.__scopeConfigToFile){let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".CloseConnection",writeValue:{controlName:this.__id,scopeConfig:this.__scopeConfigToFile}}]};TcHmi.Server.requestEx(request,{parallel:!0})}else if(this.__scopeConfig){let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".CloseConnection",writeValue:{controlName:this.__id,scopeConfig:this.__scopeConfig}}]};TcHmi.Server.requestEx(request,{parallel:!0})}for(const destroyEvent of Object.values(this.__destroyEvents))destroyEvent?.();this.__destroyEvents={},this.__dialog?.destroy(),this.__dialog=null,this.__timeRangeDialog?.destroy(),this.__timeRangeDialog=null}}__addOrUpdateLocalizedElement(element,key,value=null){if(this.__localizedElements.set(key,{element,value}),this.__localizationReader){let localizedText=this.__localizationReader.get(key);if(key.includes("Tooltip"))element.title=tchmi_decode_control_characters(localizedText);else if(null!==value)if(value.includes("Label_Text_Date_Placeholder")){let valueLocalization=this.__localizationReader.get("Label_Text_Date_Placeholder");element.textContent=tchmi_decode_control_characters(localizedText+": "+valueLocalization)}else key.includes("Label_Text_")?element.textContent=tchmi_decode_control_characters(localizedText+": "+value):element.textContent=tchmi_decode_control_characters(localizedText);else element.textContent=tchmi_decode_control_characters(localizedText)}}__removeLocalizedElement(key){this.__localizedElements.delete(key)}__loadThemedResources(){let chartBackgroundColor=TcHmi.Theme.Resources.get(this,"ChartBackgroundColor");TcHmi.isSolidColor(chartBackgroundColor.value)&&(this.__themeChartBackgroundColor=TcHmi.StyleProvider.resolveSolidColorAsCssValue(chartBackgroundColor.value));let chartForegroundColor=TcHmi.Theme.Resources.get(this,"ChartForegroundColor");TcHmi.isSolidColor(chartForegroundColor.value)&&(this.__themeChartForegroundColor=TcHmi.StyleProvider.resolveSolidColorAsCssValue(chartForegroundColor.value));let overviewBackgroundColor=TcHmi.Theme.Resources.get(this,"OverviewBackgroundColor");TcHmi.isSolidColor(overviewBackgroundColor.value)&&(this.__themeOverviewBackgroundColor=TcHmi.StyleProvider.resolveSolidColorAsCssValue(overviewBackgroundColor.value));let overviewForegroundColor=TcHmi.Theme.Resources.get(this,"OverviewForegroundColor");TcHmi.isSolidColor(overviewForegroundColor.value)&&(this.__themeOverviewForegroundColor=TcHmi.StyleProvider.resolveSolidColorAsCssValue(overviewForegroundColor.value));let canvasBackgroundColor=TcHmi.Theme.Resources.get(this,"CanvasBackgroundColor");TcHmi.isSolidColor(canvasBackgroundColor.value)&&(this.__themeCanvasBackgroundColor=TcHmi.StyleProvider.resolveSolidColorAsCssValue(canvasBackgroundColor.value));let axisColor=TcHmi.Theme.Resources.get(this,"AxisColor");TcHmi.isSolidColor(axisColor.value)&&(this.__themeAxisColor=TcHmi.StyleProvider.resolveSolidColorAsCssValue(axisColor.value));let gridColor=TcHmi.Theme.Resources.get(this,"GridColor");TcHmi.isSolidColor(gridColor.value)&&(this.__themeGridColor=TcHmi.StyleProvider.resolveSolidColorAsCssValue(gridColor.value));let axisGroupForegroundColor=TcHmi.Theme.Resources.get(this,"AxisGroupForegroundColor");TcHmi.isSolidColor(axisGroupForegroundColor.value)&&(this.__themeAxisGroupForegroundColor=TcHmi.StyleProvider.resolveSolidColorAsCssValue(axisGroupForegroundColor.value)),this.__drawLineChart()}__onThemeDataChanged(evt,ctrl){this.__loadThemedResources(),this.__rebuild(evt,ctrl)}__onUserDataChanged(event,data){TcHmi.Server.getCurrentUserConfig().session!==this.__sessionId&&this.__serverDomain&&this.__clearInit()}__onExtensionStateChanged(result){if(result&&result.error===TcHmi.Errors.NONE&&result.response){if(result.response.error)return TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Server responds with error. Details: ${TcHmi.Log.buildMessage(result.response.error)}`),void this.__loadingSpinner?.remove();if(result.response.commands&&this.__serverDomain)for(let i=0,ii=result.response.commands.length;i<ii;i++)if("ListDomains"===result.response.commands[i].symbol){let extensions=result.response.commands[i].readValue,scopeExtension=extensions&&extensions[this.__serverDomain],state=scopeExtension&&scopeExtension.state;if(state!==this.__extensionState)if(this.__extensionState=state,"Initialized"===state)null===this.__requestIds.openConnection&&this.__clearInit();else{this.__scopeConfigToFile=null;for(let[key,value]of Object.entries(this.__subscriptionIds))value&&"onExtensionStateChanged"!==key&&(TcHmi.Server.unsubscribe(value,null),this.__subscriptionIds[key]=null);this.__clearFullControl(),this.__loadingSpinner?.remove();let status=state?` (Status: ${state})`:"",details=result.response.commands[i].error&&130!==result.response.commands[i].error.code?`Details: ${TcHmi.Log.buildMessage(result.response.commands[i].error)}`:"";TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Domain: ${this.__serverDomain} is not known${status}. Please make sure the server extension is loaded and the domain name is correct. ${details}`)}}}else this.__loadingSpinner?.remove(),result.error&&TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Framework error= ${result.error}, name=${TcHmi.Errors[result.error]} while fetching data from server.Details: ${TcHmi.Log.buildMessage(result.details)}`)}__scopeEventCallback(data){if(data.error||!data.event)return void TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Server responds with error. Details: ${TcHmi.Log.buildMessage(data.details)}`);const payloadResult=data.event;if("DOWNLOAD_COMPLETE"===payloadResult.name&&this.__scopeConfig&&this.__openConnection(),!TcHmi.Server.Events.isPayload(payloadResult)||!payloadResult.payload)return void TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Server responds with error ${data.error}. Details: Event is possible null.`);const payload=payloadResult.payload;if(data.event&&"OPEN_CONNECTION_TO_FILE_SUCCESS"===data.event.name){if(this.__scopeConfigToFile){let writeValueData={controlName:this.__id,scopeConfig:this.__scopeConfigToFile},request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".GetMenubar",writeValue:writeValueData},{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".GetLegend",writeValue:writeValueData}]};TcHmi.Server.releaseRequest(this.__requestIds.getMenubar),this.__requestIds.getMenubar=TcHmi.Server.requestEx(request,{parallel:!0},this.__getMenubarCallback)}}else payload.severity===TcHmi.Server.Events.Severity.Info?TcHmi.Log.Controls.info(this,TcHmiScopeControl.#tchmiFQN,`ScopeExtension has thrown an information. Details: ${payload.message}`):payload.severity===TcHmi.Server.Events.Severity.Warning?TcHmi.Log.Controls.warn(this,TcHmiScopeControl.#tchmiFQN,`ScopeExtension has thrown a warning. Details: ${payload.message}`):payload.severity===TcHmi.Server.Events.Severity.Error&&TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`ScopeExtension has thrown an error. Details: ${payload.message}`)}__configEventCallback(data){if(data.error||!data.event)return void TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Server responds with error ${data.error}. Details: ${TcHmi.Log.buildMessage(data.details)}`);const payloadResult=data.event;if("INIT_COMPLETE"===payloadResult.name)this.__extensionInitCompleted=!0,this.__scopeConfigLoaded&&this.__openConnection();else{if(!TcHmi.Server.Events.isPayload(payloadResult)||!payloadResult.payload)return void TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Server responds with error ${data.error}. Details: Event is possible null.`);const payload=payloadResult.payload;if(payload.severity===TcHmi.Server.Events.Severity.Info)switch(null!==payload.oldConfigName?TcHmi.Log.Controls.info(this,TcHmiScopeControl.#tchmiFQN,`ScopeExtension has thrown an information. Details: ${payload.configType} from ${payload.oldConfigName} to ${payload.configName}`):TcHmi.Log.Controls.info(this,TcHmiScopeControl.#tchmiFQN,`ScopeExtension has thrown an information. Details: ${payload.configType} ${payload.configName}`),payload.configType){case ConfigType.Add:case ConfigType.Change:case ConfigType.Rename:this.__scopeConfig&&(payload.configName===this.__scopeConfig.name?(this.__scopeConfigLoaded=!0,this.__extensionInitCompleted&&this.__openConnection()):payload.oldConfigName===this.__scopeConfig.name&&(this.__scopeConfigLoaded=!1));break;case ConfigType.Delete:this.__scopeConfig&&payload.configName===this.__scopeConfig.name&&(this.__scopeConfigLoaded=!1,this.__clearFullControl())}}}__rebuild(evt,ctrl){if(this.__isAttached)if(this.__subscriptionIds.menubar)if(this.__menubar){let enableButtons=ButtonsEnabled.None;this.__menubar.visibleToolstrip&&(enableButtons=this.__menubar.enabledButtons);let enableTimes=TimesEnabled.None;this.__menubar.visibleTimestrip&&(enableTimes=this.__menubar.enabledTimeLabels),this.__createMenuButtons(enableButtons,enableTimes),this.__calcMenuButtons(),this.__menubar.visibleToolstrip?0===this.__menubar.enabledButtons?TcHmi.StyleProvider.setSimpleElementStyle(this.__elementToolBar,"display","none"):TcHmi.StyleProvider.setSimpleElementStyle(this.__elementToolBar,"display","flex"):TcHmi.StyleProvider.setSimpleElementStyle(this.__elementToolBar,"display","none"),this.__menubar.visibleTimestrip?0===this.__menubar.enabledTimeLabels?TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTimeBar,"display","none"):TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTimeBar,"display","flex"):TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTimeBar,"display","none"),this.__serverSymbolsHelper.setChartSize(!0)}else this.__createMenuButtons(ButtonsEnabled.None,TimesEnabled.None),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementToolBar,"display","none"),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTimeBar,"display","none");else this.__createMenuButtons(ButtonsEnabled.None,TimesEnabled.None),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementToolBar,"display","none"),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTimeBar,"display","none");else this.__drawLineChart()}__openWebsocket(){TCHMI_DESIGNER||null===this.__requestIds.openConnection&&(this.__scopeIsInitialized?this.__openConnection():null===this.__initEventDestroyEvent&&(this.__initEventDestroyEvent=TcHmi.EventProvider.register(this.__id+".onInitChanged",this.__initChanged)))}__openConnection(){if(!TCHMI_DESIGNER&&this.__isAttached&&this.__scopeIsInitialized&&this.__extensionInitCompleted&&null===this.__requestIds.openConnection){null!==this.__subscriptionIds.menubar&&(TcHmi.Server.unsubscribe(this.__subscriptionIds.menubar),this.__subscriptionIds.menubar=null),null!==this.__subscriptionIds.dataLayoutAndWindow&&(TcHmi.Server.unsubscribe(this.__subscriptionIds.dataLayoutAndWindow),this.__subscriptionIds.dataLayoutAndWindow=null),null!==this.__subscriptionIds.actualWindow&&(TcHmi.Server.unsubscribe(this.__subscriptionIds.actualWindow),this.__subscriptionIds.actualWindow=null),null!==this.__subscriptionIds.triggerWindow&&(TcHmi.Server.unsubscribe(this.__subscriptionIds.triggerWindow),this.__subscriptionIds.triggerWindow=null),null!==this.__subscriptionIds.getRecords&&(TcHmi.Server.unsubscribe(this.__subscriptionIds.getRecords),this.__subscriptionIds.getRecords=null);let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".OpenConnection",writeValue:{controlName:this.__id,scopeConfig:this.__scopeConfig,autostartRecord:this.__autostartRecord}}]};this.__loadingSpinner&&this.__elementLoading[0].appendChild(this.__loadingSpinner),TcHmi.Server.releaseRequest(this.__requestIds.openConnection),this.__requestIds.openConnection=TcHmi.Server.requestEx(request,null,this.__connectionCallback)}}__clearFullControl(){this.__createMenuButtons(ButtonsEnabled.None,TimesEnabled.None),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementToolBar,"display","none"),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTimeBar,"display","none"),this.__createLegend(void 0),this.__datagrid&&this.__datagrid.setSrcData(null);const passiveEventOptions={passive:!0,capture:!1},activeEventOptions={passive:!1,capture:!1};for(let i=0,ii=this.__iCharts.length;i<ii;i++){let canvas=this.__iCharts[i].getCanvasZooming();canvas&&(canvas.removeEventListener("mousedown",this.__onMouseDown,passiveEventOptions),canvas.removeEventListener("touchstart",this.__onTouchStart,activeEventOptions),canvas.removeEventListener("wheel",this.__onMouseWheel,activeEventOptions)),this.__iCharts[i].remove(),this.__chartingElements[i].remove()}if(this.__iCharts=[],this.__chartingElements=[],this.__dialog?.closeChartsDialog(),this.__dialog?.hide(),this.__timeRangeDialog&&this.__timeRangeDialog.hide(),this.__overviewChart){let canvas=this.__overviewChart.getCanvasZooming();canvas&&(canvas.removeEventListener("mousedown",this.__onMouseDown,passiveEventOptions),canvas.removeEventListener("mousemove",this.__onMouseMoveOverview,passiveEventOptions),canvas.removeEventListener("mouseup",this.__onMouseUpOverview,passiveEventOptions),canvas.removeEventListener("touchstart",this.__onTouchStart,activeEventOptions)),this.__overviewChart.remove(),this.__overviewChart=null}this.__elementOverview.css({display:"none"}),this.__elementChartName.css("display","none"),this.__elementChartings.css({"background-color":"","background-image":""}),this.__elementChartings.children(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-chart").remove();const canvasBorderElem=this.__elementBorder[0];let contextBorderElem=canvasBorderElem.getContext("2d");contextBorderElem?.clearRect(0,0,canvasBorderElem.width,canvasBorderElem.height),this.__resizeLines=[],this.__sessionId=null,this.__socketId=null,this.__scopeConfigLoaded=!1,this.__menubar=void 0,this.__legend=void 0,this.__scopeLayout=void 0,this.__scopeGraphData=void 0,this.__scopeGraphWindow=null,this.__triggerWindow=null}__connectionCallback(result){if(!this.__isDestroyed&&null!==this.__requestIds.openConnection)if(this.__requestIds.openConnection=null,result&&result.error===TcHmi.Errors.NONE&&result.response){if(result.response.error)return TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Server responds with error. Details: ${TcHmi.Log.buildMessage(result.response.error)}`),void this.__loadingSpinner?.remove();if(result.response.commands)for(let i=0,ii=result.response.commands.length;i<ii;i++){if(result.response.commands[i].error&&130!==result.response.commands[i].error.code)return TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Server responds with for command for symbol=${result.response.commands[i].symbol}. Details: ${TcHmi.Log.buildMessage(result.response.commands[i].error)}`),this.__loadingSpinner?.remove(),void this.__clearFullControl();result.response.commands[i].symbol===this.__serverDomain+".OpenConnection"&&(this.__resubscribeMenubar(),this.__showTriggerWindow&&this.__unsubscribeTriggerWindow())}}else this.__loadingSpinner?.remove(),result.error&&TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Framwork error=${result.error}, name=${TcHmi.Errors[result.error]} while fetching data from server.`)}__setChartSizeCallback(result){if(!this.__isDestroyed&&null!==this.__requestIds.setChartSize)if(this.__requestIds.setChartSize=null,result&&result.error===TcHmi.Errors.NONE&&result.response){if(result.response.error)return TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Server responds with error. Details: ${TcHmi.Log.buildMessage(result.response.error)}`),void this.__loadingSpinner?.remove();if(result.response.commands)for(let i=0,ii=result.response.commands.length;i<ii;i++)result.response.commands[i].error&&(TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Server responds with error for command for symol=${result.response.commands[i].symbol}. Details: ${TcHmi.Log.buildMessage(result.response.commands[i].error)}`),this.__loadingSpinner?.remove()),result.response.commands[i].symbol===this.__serverDomain+".SetChartSize"&&(this.__loadingSpinner?.remove(),this.__resubscribe())}else this.__loadingSpinner?.remove(),result.error&&TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Framework error=${result.error}, name=${TcHmi.Errors[result.error]} while fetching data from server. Details: ${TcHmi.Log.buildMessage(result.details)}`)}__resubscribeMenubar(){null!==this.__subscriptionIds.menubar?TcHmi.Server.unsubscribe(this.__subscriptionIds.menubar,this.__resubscribeMenubarCallback):this.__subscribeMenubar()}__resubscribeMenubarCallback(result){this.__subscriptionIds.menubar=null,this.__subscribeMenubar()}__subscribeMenubar(){if(this.__subscriptionIds.menubar=null,this.__isAttached&&this.__scopeConfig){let symbolMenubar=this.__serverDomain+".GetMenubar",symbolLegend=this.__serverDomain+".GetLegend",writeValue={controlName:this.__id,scopeConfig:this.__scopeConfig},writeValueLegend={controlName:this.__id,scopeConfig:this.__scopeConfig,activeLegendElements:this.__activeLegendElements};this.__showLegend?this.__subscriptionIds.menubar=TcHmi.Server.subscribe([{commandOptions:["SendErrorMessage","UniqueHash"],symbol:symbolMenubar,writeValue},{commandOptions:["SendErrorMessage","UniqueHash"],symbol:symbolLegend,writeValue:writeValueLegend}],300,this.__getMenubarCallback):this.__subscriptionIds.menubar=TcHmi.Server.subscribe([{commandOptions:["SendErrorMessage","UniqueHash"],symbol:symbolMenubar,writeValue}],300,this.__getMenubarCallback)}}__unsubscribeTriggerWindow(){null!==this.__subscriptionIds.triggerWindow?TcHmi.Server.unsubscribe(this.__subscriptionIds.triggerWindow,this.__resubscribeTriggerWindowCallback):this.__subscribeTriggerWindow()}__resubscribeTriggerWindowCallback(result){this.__subscriptionIds.triggerWindow=null,this.__subscribeTriggerWindow()}__subscribeTriggerWindow(){if(this.__subscriptionIds.triggerWindow=null,this.__isAttached&&this.__scopeConfig){let writeValue,symbolTriggerWindow=this.__serverDomain+".GetTriggerWindow";writeValue={controlName:this.__id,scopeConfig:this.__scopeConfig},this.__subscriptionIds.triggerWindow=TcHmi.Server.subscribe([{commandOptions:["SendErrorMessage","UniqueHash"],symbol:symbolTriggerWindow,writeValue}],300,this.__getDataCallback)}}__getMenubarCallback(result){if(!this.__isDestroyed)if(result&&result.error===TcHmi.Errors.NONE&&result.response&&(result.response.id===this.__subscriptionIds.menubar||result.response.id===this.__requestIds.getMenubar)){if(result.response.id===this.__requestIds.getMenubar&&(this.__requestIds.getMenubar=null),result.response.error)return TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Server responds with error. Details: ${TcHmi.Log.buildMessage(result.response.error)}`),this.__loadingSpinner?.remove(),this.__createMenuButtons(ButtonsEnabled.None,TimesEnabled.None),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementToolBar,"display","none"),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTimeBar,"display","none"),void this.__createLegend(void 0);if(result.response.commands&&void 0!==this.__subscriptionIds.menubar){for(let i=0,ii=result.response.commands.length;i<ii;i++){if(result.response.commands[i].error)return 130!==result.response.commands[i].error.code&&(TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Server responds with error for command for symbol=${result.response.commands[i].symbol}. Details: ${TcHmi.Log.buildMessage(result.response.commands[i].error)}`),this.__loadingSpinner?.remove()),this.__createMenuButtons(ButtonsEnabled.None,TimesEnabled.None),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementToolBar,"display","none"),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTimeBar,"display","none"),void this.__createLegend(void 0);if(result.response.commands[i].readValue)if(result.response.commands[i].symbol===this.__serverDomain+".GetMenubar"){if(this.__menubar=result.response.commands[i].readValue,this.__menubar){let enableButtons=ButtonsEnabled.None;this.__menubar.visibleToolstrip&&(enableButtons=this.__menubar.enabledButtons);let enableTimes=TimesEnabled.None;this.__menubar.visibleTimestrip&&(enableTimes=this.__menubar.enabledTimeLabels),this.__createMenuButtons(enableButtons,enableTimes),this.__calcMenuButtons(),this.__menubar.visibleToolstrip?0===this.__menubar.enabledButtons?TcHmi.StyleProvider.setSimpleElementStyle(this.__elementToolBar,"display","none"):TcHmi.StyleProvider.setSimpleElementStyle(this.__elementToolBar,"display","flex"):TcHmi.StyleProvider.setSimpleElementStyle(this.__elementToolBar,"display","none"),this.__menubar.visibleTimestrip?0===this.__menubar.enabledTimeLabels?TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTimeBar,"display","none"):TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTimeBar,"display","flex"):TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTimeBar,"display","none")}}else result.response.commands[i].symbol===this.__serverDomain+".GetLegend"&&(this.__legend=result.response.commands[i].readValue,this.__createLegend(this.__legend))}this.__serverSymbolsHelper.setChartSize(!1)}}else this.__loadingSpinner?.remove(),result.error&&TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Framework error=${result.error}, name=${TcHmi.Errors[result.error]} while fetching data from server. Details: ${TcHmi.Log.buildMessage(result.details)}`)}__resubscribe(changedServerInterval=!1){null!==this.__subscriptionIds.dataLayoutAndWindow?TcHmi.Server.unsubscribe(this.__subscriptionIds.dataLayoutAndWindow,this.__resubscribeGetDataCallback):this.__subscribeGetData(),changedServerInterval||(null!==this.__subscriptionIds.actualWindow?TcHmi.Server.unsubscribe(this.__subscriptionIds.actualWindow,this.__resubscribeActualWindowCallback):this.__subscribeActualWindow())}__resubscribeGetDataCallback(result){this.__subscriptionIds.dataLayoutAndWindow=null,this.__subscribeGetData()}__subscribeGetData(){if(this.__isAttached&&this.__scopeConfig&&this.__serverInterval){let writeValueData,symbolData=this.__serverDomain+".GetData",symbolWindow=this.__serverDomain+".GetWindow",symbolLayout=this.__serverDomain+".GetLayout";writeValueData={controlName:this.__id,scopeConfig:this.__scopeConfig},TcHmi.Server.releaseRequest(this.__subscriptionIds.dataLayoutAndWindow),this.__subscriptionIds.dataLayoutAndWindow=TcHmi.Server.subscribe([{commandOptions:["SendErrorMessage","UniqueHash"],symbol:symbolLayout,writeValue:writeValueData},{commandOptions:["SendErrorMessage","UniqueHash"],symbol:symbolData,writeValue:writeValueData},{commandOptions:["SendErrorMessage","UniqueHash"],symbol:symbolWindow,writeValue:writeValueData}],this.__serverInterval,this.__getDataCallback)}}__resubscribeActualWindowCallback(result){this.__subscriptionIds.actualWindow=null,this.__subscribeActualWindow()}__subscribeActualWindow(){if(this.__isAttached&&this.__scopeConfig){let writeValueData;writeValueData={controlName:this.__id,scopeConfig:this.__scopeConfig},this.__subscriptionIds.actualWindow=TcHmi.Server.subscribe([{commandOptions:["SendErrorMessage","UniqueHash"],symbol:this.__serverDomain+".GetActualWindow",writeValue:writeValueData}],300,this.__getDataCallback)}}__getDataCallback(result){if(!this.__isDestroyed)if(this.__loadingSpinner?.remove(),result&&result.error===TcHmi.Errors.NONE&&result.response){if(result.response.error)return void TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Server responds with error. Details: ${TcHmi.Log.buildMessage(result.response.error)}`);if(result.response.commands&&void 0!==this.__subscriptionIds.dataLayoutAndWindow)for(let i=0,ii=result.response.commands.length;i<ii;i++){if(result.response.commands[i].error){if(31===result.response.commands[i].error.code)return void this.__openWebsocket();130!==result.response.commands[i].error.code&&TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Server responds with error for command for symbol=${result.response.commands[i].symbol}. Details: ${TcHmi.Log.buildMessage(result.response.commands[i].error)}`)}if(result.response.commands[i].symbol===this.__serverDomain+".GetLayout"&&(result.response.id===this.__subscriptionIds.dataLayoutAndWindow&&!this.__scopeConfigToFile||result.response.id===this.__requestIds.getData&&this.__scopeConfigToFile)){let newLayout=result.response.commands[i].readValue;const chartType=newLayout?.chartType??null;let drawOnlyOverview=!1;if(newLayout&&this.__scopeLayout&&newLayout.charts&&this.__scopeLayout.charts&&JSON.stringify(newLayout.charts)===JSON.stringify(this.__scopeLayout.charts)&&(drawOnlyOverview=!0),this.__scopeLayout&&this.__scopeLayout.chartType!==chartType&&(this.__mouseMode=MouseMode.None),drawOnlyOverview&&this.__manipulationInfo.isManipulating&&-1===this.__manipulationInfo.elementIndex&&this.__overviewChart&&this.__scopeLayout&&this.__scopeLayout.overview&&this.__scopeGraphWindow&&this.__scopeGraphWindow.overviewRect){const canvas=this.__overviewChart.getCanvasZooming();let context=canvas.getContext("2d");if(null===context)return;let canvasWidth=canvas.width/window.devicePixelRatio,canvasHeight=canvas.height/window.devicePixelRatio,width=this.__manipulationInfo.end.x-this.__manipulationInfo.start.x;if(this.__manipulationInfo.isOverviewSizeChanged)if(this.__manipulationInfo.beginOverviewRectChanging){let newWidth=this.__scopeGraphWindow.overviewRect.dimensions.width-width;newWidth<5&&(newWidth=5),context.clearRect(0,0,canvasWidth,canvasHeight),context.fillStyle="rgba(51,153,255,0.3)",context.fillRect(this.__scopeLayout.overview.canvas.position.x+this.__scopeGraphWindow.overviewRect.position.x+width,this.__scopeLayout.overview.canvas.position.y,newWidth,this.__scopeGraphWindow.overviewRect.dimensions.height)}else{let newWidth=this.__scopeGraphWindow.overviewRect.dimensions.width+width;newWidth<5&&(newWidth=5),context.clearRect(0,0,canvasWidth,canvasHeight),context.fillStyle="rgba(51,153,255,0.3)",context.fillRect(this.__scopeLayout.overview.canvas.position.x+this.__scopeGraphWindow.overviewRect.position.x,this.__scopeLayout.overview.canvas.position.y,newWidth,this.__scopeGraphWindow.overviewRect.dimensions.height)}else context.clearRect(0,0,canvasWidth,canvasHeight),context.fillStyle="rgba(51,153,255,0.3)",context.fillRect(this.__scopeLayout.overview.canvas.position.x+this.__scopeGraphWindow.overviewRect.position.x+width,this.__scopeLayout.overview.canvas.position.y,this.__scopeGraphWindow.overviewRect.dimensions.width,this.__scopeGraphWindow.overviewRect.dimensions.height)}else this.__scopeLayout=result.response.commands[i].readValue,this.__drawLineChart(drawOnlyOverview);this.__scopeGraphWindow&&this.__scopeLayout?this.__enableOrDisableMenuControls(this.__scopeGraphWindow.scopeState,this.__scopeGraphWindow.liveState,this.__scopeGraphWindow.undo,this.__scopeGraphWindow.redo,ChartType[this.__scopeLayout.chartType]):this.__enableOrDisableMenuControls("Unknown",!1,!1,!1,ChartType.YT)}else if(result.response.commands[i].symbol===this.__serverDomain+".GetWindow"&&(result.response.id===this.__subscriptionIds.dataLayoutAndWindow&&!this.__scopeConfigToFile||result.response.id===this.__requestIds.getData&&this.__scopeConfigToFile)){if(this.__manipulationInfo.isManipulating&&-1===this.__manipulationInfo.elementIndex)return;if(this.__scopeGraphWindow=result.response.commands[i].readValue,this.__updatedMenuValues(this.__scopeGraphWindow),this.__scopeGraphWindow&&this.__scopeLayout?this.__enableOrDisableMenuControls(this.__scopeGraphWindow.scopeState,this.__scopeGraphWindow.liveState,this.__scopeGraphWindow.undo,this.__scopeGraphWindow.redo,ChartType[this.__scopeLayout.chartType]):this.__enableOrDisableMenuControls("Unknown",!1,!1,!1,ChartType.YT),this.__scopeGraphWindow&&this.__scopeGraphWindow.overviewRect&&this.__scopeLayout&&this.__scopeLayout.overview&&this.__overviewChart){if(this.__manipulationInfo.isManipulating&&-1===this.__manipulationInfo.elementIndex)break;const canvas=this.__overviewChart.getCanvasZooming();let context=canvas.getContext("2d");if(context){let canvasWidth=canvas.width/window.devicePixelRatio,canvasHeight=canvas.height/window.devicePixelRatio;context.clearRect(0,0,canvasWidth,canvasHeight),context.fillStyle="rgba(51,153,255,0.3)",context.fillRect(this.__scopeLayout.overview.canvas.position.x+this.__scopeGraphWindow.overviewRect.position.x,this.__scopeLayout.overview.canvas.position.y,this.__scopeGraphWindow.overviewRect.dimensions.width,this.__scopeGraphWindow.overviewRect.dimensions.height)}if(this.__scopeLayout&&this.__scopeLayout.overview){let offsetTop=this.__scopeLayout.overview.canvas.position.y,offsetLeft=this.__scopeLayout.overview.canvas.position.x;this.__overviewRectangle={position:{x:offsetLeft+this.__scopeGraphWindow.overviewRect.position.x,y:offsetTop},dimensions:{width:this.__scopeGraphWindow.overviewRect.dimensions.width,height:this.__scopeGraphWindow.overviewRect.dimensions.height}}}}}else if(result.response.commands[i].symbol===this.__serverDomain+".GetData"&&(result.response.id===this.__subscriptionIds.dataLayoutAndWindow&&!this.__scopeConfigToFile||result.response.id===this.__requestIds.getData&&this.__scopeConfigToFile)){if(result.response.id===this.__requestIds.getData&&(this.__requestIds.getData=null),this.__manipulationInfo.isManipulating)return;if(null===this.__requestIds.startRecord&&null===this.__requestIds.start&&null===this.__requestIds.stopRecord&&null===this.__requestIds.stop&&null===this.__requestIds.zoom&&null===this.__requestIds.pan&&null===this.__requestIds.wheel&&null===this.__requestIds.zoomOut&&null===this.__requestIds.unzoom&&null===this.__requestIds.displayWidth&&null===this.__requestIds.goto&&null===this.__requestIds.scroll&&null===this.__requestIds.scrollBig&&null===this.__requestIds.undo&&null===this.__requestIds.redo&&null===this.__requestIds.setOverviewMode&&null===this.__requestIds.setOverviewRect&&null===this.__requestIds.getTooltip&&null===this.__requestIds.resizeCharts&&null===this.__requestIds.changeChannelState&&null===this.__requestIds.setTriggerComment&&null===this.__requestIds.clickOverviewElement&&(this.__scopeGraphData=result.response.commands[i].readValue,this.__scopeGraphData&&this.__scopeLayout)){if(this.__scopeLayout.overview&&this.__overviewChart){let overviewData=this.__scopeGraphData.overview;if(overviewData){if(overviewData.graphs)for(let graphKey in overviewData.graphs){let graph=overviewData.graphs[graphKey];if(graph&&this.__overviewChart){let overviewGraph=this.__overviewChart.getLineGraphWithName(graphKey);overviewGraph&&overviewGraph.setPoints(graph.axesData)}}if(this.__overviewChart.deleteAllTriggers(),overviewData.trigger)for(let e=0,ee=overviewData.trigger.length;e<ee;e++)this.__overviewChart.addTrigger(overviewData.trigger[e]);this.__overviewChart.setLineChanged(!0),this.__chartChartColorSource===ChartColorSource.ScopeConfig?this.__overviewChart.draw(this.__scopeLayout.overview,null):this.__overviewChart.draw(this.__scopeLayout.overview,this.__themeCanvasBackgroundColor)}}if(this.__iCharts&&this.__iCharts.length>0&&this.__iCharts.length===this.__scopeLayout.charts.length&&this.__iCharts[0]instanceof ScopeChart){for(let i=0,ii=this.__scopeGraphData.charts.length;i<ii;i++){let chartData=this.__scopeGraphData.charts[i],chart=this.__iCharts[i];if(chart&&chartData&&!isDigitalChartData(chartData)&&chart instanceof ScopeChart){if(chart.deleteAllTriggers(),chartData.trigger)for(let e=0,ee=chartData.trigger.length;e<ee;e++)chart.addTrigger(chartData.trigger[e]);if(chart.deleteAllXYTriggers(),chartData.xyTrigger)for(let e=0,ee=chartData.xyTrigger.length;e<ee;e++)chart.addXYTrigger(chartData.xyTrigger[e]);if(chartData.graphs)for(let chartGraphKey in chartData.graphs){let graph=chartData.graphs[chartGraphKey];if(graph){let lineGraph=chart.getLineGraphWithName(chartGraphKey);lineGraph&&(lineGraph.setPoints(graph.axesData),lineGraph.setZeroPoint(graph.zeroPoint),lineGraph.setLineSeries(graph.lineSeries))}}}}for(let i=0,ii=this.__iCharts.length;i<ii;i++){let chart=this.__iCharts[i];chart instanceof ScopeChart&&(chart.setLineChanged(!0),this.__chartChartColorSource!==ChartColorSource.ScopeConfig||isDigitalChartLayout(this.__scopeLayout.charts[i])?isDigitalChartLayout(this.__scopeLayout.charts[i])||chart.draw(this.__scopeLayout.charts[i],this.__themeCanvasBackgroundColor):chart.draw(this.__scopeLayout.charts[i],null))}}else if(this.__iCharts.length>0&&this.__iCharts.length===this.__scopeLayout.charts.length&&this.__iCharts[0]instanceof DigitalChartClass){for(let i=0,ii=Math.min(this.__scopeLayout.charts.length,this.__scopeGraphData.charts.length,this.__iCharts.length);i<ii;i++){let layout=this.__scopeLayout.charts[i],data=this.__scopeGraphData.charts[i],chart=this.__iCharts[i];isDigitalChartLayout(layout)&&isDigitalChartData(data)&&chart instanceof DigitalChartClass&&chart.draw(layout,data)}}}}else if(result.response.commands[i].symbol===this.__serverDomain+".StartRecord")this.__requestIds.startRecord=null,this.__scopeConfigToFile||this.__resubscribe();else if(result.response.commands[i].symbol===this.__serverDomain+".StartDisplay")this.__requestIds.start=null,this.__scopeConfigToFile||this.__resubscribe();else if(result.response.commands[i].symbol===this.__serverDomain+".StopRecord")this.__requestIds.stopRecord=null,this.__scopeConfigToFile||this.__resubscribe();else if(result.response.commands[i].symbol===this.__serverDomain+".StopDisplay")this.__requestIds.stop=null,this.__scopeConfigToFile||this.__resubscribe();else if(result.response.commands[i].symbol===this.__serverDomain+".Zoom")this.__requestIds.zoom=null,this.__scopeConfigToFile?this.__serverSymbolsHelper.__getDataAsRequest():this.__resubscribe();else if(result.response.commands[i].symbol===this.__serverDomain+".Pan")this.__requestIds.pan=null,this.__scopeConfigToFile?this.__serverSymbolsHelper.__getDataAsRequest():this.__resubscribe();else if(result.response.commands[i].symbol===this.__serverDomain+".Wheel")this.__requestIds.wheel=null,this.__scopeConfigToFile?this.__serverSymbolsHelper.__getDataAsRequest():this.__resubscribe();else if(result.response.commands[i].symbol===this.__serverDomain+".ZoomOutMax")this.__requestIds.zoomOut=null,this.__scopeConfigToFile?this.__serverSymbolsHelper.__getDataAsRequest():this.__resubscribe();else if(result.response.commands[i].symbol===this.__serverDomain+".ZoomToDefault")this.__requestIds.unzoom=null,this.__scopeConfigToFile?this.__serverSymbolsHelper.__getDataAsRequest():this.__resubscribe();else if(result.response.commands[i].symbol===this.__serverDomain+".SetDisplayWidth")this.__requestIds.displayWidth=null,this.__scopeConfigToFile?this.__serverSymbolsHelper.__getDataAsRequest():this.__resubscribe();else if(result.response.commands[i].symbol===this.__serverDomain+".Goto")this.__requestIds.goto=null,this.__scopeConfigToFile?this.__serverSymbolsHelper.__getDataAsRequest():this.__resubscribe();else if(result.response.commands[i].symbol===this.__serverDomain+".Scroll")this.__requestIds.scroll=null,this.__scopeConfigToFile?this.__serverSymbolsHelper.__getDataAsRequest():this.__resubscribe();else if(result.response.commands[i].symbol===this.__serverDomain+".ScrollBig")this.__requestIds.scrollBig=null,this.__scopeConfigToFile?this.__serverSymbolsHelper.__getDataAsRequest():this.__resubscribe();else if(result.response.commands[i].symbol===this.__serverDomain+".Undo")this.__requestIds.undo=null,this.__scopeConfigToFile?this.__serverSymbolsHelper.__getDataAsRequest():this.__resubscribe();else if(result.response.commands[i].symbol===this.__serverDomain+".Redo")this.__requestIds.redo=null,this.__resubscribe();else if(result.response.commands[i].symbol===this.__serverDomain+".SetOverviewMode")this.__requestIds.setOverviewMode=null,this.__scopeConfigToFile?this.__serverSymbolsHelper.__getDataAsRequest():this.__resubscribe();else if(result.response.commands[i].symbol===this.__serverDomain+".SetOverviewRect")this.__requestIds.setOverviewRect=null,this.__scopeConfigToFile?this.__serverSymbolsHelper.__getDataAsRequest():this.__resubscribe();else if(result.response.commands[i].symbol===this.__serverDomain+".GetTooltip"){this.__requestIds.getTooltip=null;let readValue=result.response.commands[i].readValue;readValue.displayText&&readValue.timeoutMS?(this.__manipulationInfo={isManipulating:!1,start:{x:0,y:0},end:{x:0,y:0},offset:{left:0,top:0},transform:{x:0,y:0},click:!0,mousePosition:{x:0,y:0},elementIndex:-1,isOverviewSizeChanged:!1,beginOverviewRectChanging:!0,chartSizeChanged:!1,resizeLineIndex:0,touchIdentifier:0,resizeTriggerWindow:!1,trigger:{move:!1,id:0}},this.__showTooltip(readValue),this.__scopeGraphWindow&&this.__scopeLayout?this.__enableOrDisableMenuControls(this.__scopeGraphWindow.scopeState,this.__scopeGraphWindow.liveState,this.__scopeGraphWindow.undo,this.__scopeGraphWindow.redo,ChartType[this.__scopeLayout.chartType]):this.__enableOrDisableMenuControls("Unknown",!1,!1,!1,ChartType.YT)):this.__userInteractionStart(this.__manipulationInfo.mousePosition.x,this.__manipulationInfo.mousePosition.y,result.response.commands[i].writeValue.chartIndex)}else if(result.response.commands[i].symbol===this.__serverDomain+".ResizeCharts")this.__requestIds.resizeCharts=null,this.__scopeConfigToFile?this.__serverSymbolsHelper.__getDataAsRequest():this.__resubscribe();else if(result.response.commands[i].symbol===this.__serverDomain+".ChangeChannelState")this.__requestIds.changeChannelState=null,this.__scopeConfigToFile?this.__serverSymbolsHelper.__getDataAsRequest():this.__resubscribe();else if(result.response.commands[i].symbol===this.__serverDomain+".SetTriggerComment")this.__requestIds.setTriggerComment=null,this.__resubscribe();else if(result.response.commands[i].symbol===this.__serverDomain+".SaveCurrentRecord")if(this.__requestIds.saveCurrentRecord=null,result.response.commands[i].error){const errorMessage=result.response.commands[i].error?.reason??result.response.commands[i].error?.message??result.response.commands[i].error?.code?.toString()??"";this.__dialog&&(this.__createErrorDialog("%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Popup_Text_SaveCurrentRecord%/l%",errorMessage),this.__dialog.setIsWaitingForServer(!1),this.__dialog.enableAllButtons())}else this.__dialog?.setIsWaitingForServer(!1),this.__dialog?.enableAllButtons();else if(result.response.commands[i].symbol!==this.__serverDomain+".GetActualWindow"||result.response.id!==this.__subscriptionIds.actualWindow||this.__scopeConfigToFile)if(result.response.commands[i].symbol===this.__serverDomain+".GetTriggerWindow"&&(result.response.id===this.__subscriptionIds.triggerWindow&&!this.__scopeConfigToFile||result.response.id===this.__requestIds.getData&&this.__scopeConfigToFile)){if(this.__triggerWindow=result.response.commands[i].readValue,this.__datagrid){let updatedTriggerWindow=this.__triggerWindow;if(updatedTriggerWindow)for(let k=0,kk=updatedTriggerWindow.length;k<kk;k++){const dateSplitted=TcHmi.Localization.parseDate(new Date(updatedTriggerWindow[k].releaseTime));updatedTriggerWindow[k].releaseTime=("00"+dateSplitted.hour).slice(-2)+":"+("00"+dateSplitted.minute).slice(-2)+":"+("00"+dateSplitted.second).slice(-2)+","+("000"+dateSplitted.millisecond).slice(-3)}this.__datagrid.setSrcData(this.__triggerWindow)}}else if(result.response.commands[i].symbol===this.__serverDomain+".DeleteScopeRecord")if(this.__requestIds.deleteScopeRecord=null,result.response.commands[i].error){const errorMessage=result.response.commands[i].error?.reason??result.response.commands[i].error?.message??result.response.commands[i].error?.code?.toString()??"";this.__dialog&&(this.__createErrorDialog("%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Popup_Text_DeleteScopeRecord%/l%",errorMessage),this.__dialog.setIsWaitingForServer(!1),this.__dialog.enableAllButtons())}else this.__dialog?.setIsWaitingForServer(!1),this.__dialog?.enableAllButtons();else if(result.response.commands[i].symbol===this.__serverDomain+".ChangePersist"){if(this.__requestIds.changePersist=null,result.response.commands[i].error){const errorMessage=result.response.commands[i].error?.reason??result.response.commands[i].error?.message??result.response.commands[i].error?.code?.toString()??"";this.__dialog&&this.__createErrorDialog("%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Popup_Text_ChangePersist%/l%",errorMessage)}}else if(result.response.commands[i].symbol===this.__serverDomain+".GetChartList"){if(this.__requestIds.getChartList=null,result.response.commands[i].error&&this.__dialog){const errorMessage=result.response.commands[i].error?.reason??result.response.commands[i].error?.message??result.response.commands[i].error?.code.toString()??"";this.__createErrorDialog("%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Popup_Text_GetChartList%/l%",errorMessage)}else if(this.__dialog){let chartNames=result.response.commands[i].readValue;this.__dialog.addChartsToCombobox(chartNames),this.__dialog.showChartsDialog()}}else if(result.response.commands[i].symbol===this.__serverDomain+".OpenConnectionToFile")if(this.__requestIds.openConnectionToFile=null,result.response.commands[i].error&&130!==result.response.commands[i].error.code&&this.__dialog){const errorMessage=result.response.commands[i].error?.reason??result.response.commands[i].error?.message??result.response.commands[i].error?.code?.toString()??"";this.__createErrorDialog("%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Popup_Text_OpenConnectionToFile%/l%",errorMessage),this.__dialog.setAttachedGuid(null),this.__dialog.closeChartsDialog()}else this.__dialog&&(this.__clearFullControl(),this.__scopeLayout=void 0,this.__loadingSpinner&&this.__elementLoading[0].appendChild(this.__loadingSpinner),this.__scopeConfigToFile=result.response.commands[i].readValue);else result.response.commands[i].symbol===this.__serverDomain+".SetChartSize"?(this.__requestIds.setChartSize=null,this.__scopeConfigToFile&&this.__serverSymbolsHelper.__getDataAsRequest()):result.response.commands[i].symbol===this.__serverDomain+".CloseConnection"?(this.__requestIds.closeConnection=null,this.__scopeConfigToFile=null,this.__dialog?.setAttachedGuid(null),this.__scopeConfig&&this.__resubscribeMenubar()):result.response.commands[i].symbol===this.__serverDomain+".ClickOverviewElement"?(this.__requestIds.clickOverviewElement=null,this.__resubscribe()):result.response.commands[i].symbol===this.__serverDomain+".GetAnalyticsData"?(this.__requestIds.getAnalyticsData=null,result.response.commands[i].error&&130===result.response.commands[i].error.code?(null!==this.__subscriptionIds.getRecords&&(TcHmi.Server.unsubscribe(this.__subscriptionIds.getRecords,null),this.__subscriptionIds.getRecords=null),this.__subscriptionIds.getRecords=TcHmi.Server.subscribe([{commandOptions:["SendErrorMessage","UniqueHash"],symbol:this.__serverDomain+".GetRecords",writeValue:{controlName:this.__id,scopeConfig:this.__scopeConfig}}],300,this.__getDataCallback)):this.__timeRangeDialog&&this.__timeRangeDialog.addData([])):result.response.commands[i].symbol===this.__serverDomain+".GetRecords"?void 0===result.response.commands[i].error?(null!==this.__subscriptionIds.getRecords&&(TcHmi.Server.unsubscribe(this.__subscriptionIds.getRecords,null),this.__subscriptionIds.getRecords=null),this.__timeRangeDialog&&this.__timeRangeDialog.addData(result.response.commands[i].readValue)):130!==result.response.commands[i].error.code&&(null!==this.__subscriptionIds.getRecords&&(TcHmi.Server.unsubscribe(this.__subscriptionIds.getRecords,null),this.__subscriptionIds.getRecords=null),this.__timeRangeDialog&&this.__timeRangeDialog.addData([])):result.response.commands[i].symbol===this.__serverDomain+".SetAnalyticsRecord"&&(this.__requestIds.setAnalyticsRecord=null,this.__serverSymbolsHelper.startRecord(),this.__resubscribe(),this.__timeRangeDialog&&this.__timeRangeDialog.hide());else{let actualWindow=result.response.commands[i].readValue;if(this.__scopeLayout&&actualWindow?this.__enableOrDisableMenuControls(actualWindow.scopeState,actualWindow.liveState,actualWindow.undo,actualWindow.redo,ChartType[this.__scopeLayout.chartType]):this.__enableOrDisableMenuControls("Unknown",!1,!1,!1,ChartType.YT),this.__scopeGraphWindow){let windowData=this.__scopeGraphWindow;actualWindow&&(windowData.liveState=actualWindow.liveState,windowData.displayWidth=actualWindow.displayWidth,windowData.redo=actualWindow.redo,windowData.scopeState=actualWindow.scopeState,windowData.undo=actualWindow.undo,windowData.xAxisEnd=actualWindow.xAxisEnd,windowData.xAxisStart=actualWindow.xAxisStart),this.__updatedMenuValues(windowData)}else this.__updatedMenuValues(null)}}}else result.error&&TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,`Framework error=${result.error}, name=${TcHmi.Errors[result.error]} while fetching data from server. Details: ${TcHmi.Log.buildMessage(result.details)}`)}__createErrorDialog(symbol,errorMessage=null){null===this.__errorPrompt&&(this.__errorPrompt=new TcHmi.Controls.Helpers.TextAndButtonsPrompt({ok:{value:void 0,attributes:{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Popup_Button_Text_OK%/l%"}}},this),this.__errorPrompt.setBackgroundAction({close:!0,action:"ok"})),errorMessage?this.__errorPrompt.setLocalizations({headerText:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Popup_Header_Error%/l%",contentText:{symbolExpression:symbol,formatValues:[errorMessage]}}):this.__errorPrompt.setLocalizations({headerText:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Popup_Header_Error%/l%",contentText:symbol}),this.__errorPrompt.prompt()}__drawLineChart(drawOnlyOverview=!1){const canvasBorderElem=this.__elementBorder[0],passiveEventOptions={passive:!0,capture:!1},activeEventOptions={passive:!1,capture:!1};if(this.__scopeLayout&&this.__scopeLayout.charts){if(!drawOnlyOverview){this.__manipulationInfo={isManipulating:!1,start:{x:0,y:0},end:{x:0,y:0},offset:{left:0,top:0},transform:{x:0,y:0},click:!0,mousePosition:{x:0,y:0},elementIndex:-1,isOverviewSizeChanged:!1,beginOverviewRectChanging:!0,chartSizeChanged:!1,resizeLineIndex:0,touchIdentifier:0,resizeTriggerWindow:!1,trigger:{move:!1,id:0}};let isDigitalChart=!1;if(this.__mouseMode===MouseMode.None)switch(ChartType[this.__scopeLayout.chartType]){case ChartType.SingleBarChart:this.__serverSymbolsHelper.setMouseMode(MouseMode.PanY);break;case ChartType.YT:case ChartType.XY:case ChartType.ArrayBarChart:default:this.__serverSymbolsHelper.setMouseMode(MouseMode.PanXY);break;case ChartType.Digital:isDigitalChart=!0}else ChartType[this.__scopeLayout.chartType]===ChartType.Digital&&(isDigitalChart=!0);let chartLength=this.__scopeLayout.charts.length;if(chartLength>this.__iCharts.length)for(let i=this.__iCharts.length,ii=chartLength;i<ii;i++){let newChart=$('<div class="TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-chart"></div>');this.__elementBorder.before(newChart),this.__chartingElements.push(newChart),isDigitalChart?this.__iCharts.push(new DigitalChartClass(newChart,this.__scopeLayout.charts[i].dimensions.width,this.__scopeLayout.charts[i].dimensions.height,!1)):this.__iCharts.push(new ScopeChart(newChart,this.__scopeLayout.charts[i].dimensions.width,this.__scopeLayout.charts[i].dimensions.height,!1));let canvas=this.__iCharts[i].getCanvasZooming();canvas&&(canvas.addEventListener("mousedown",this.__onMouseDown,passiveEventOptions),canvas.addEventListener("touchstart",this.__onTouchStart,activeEventOptions),canvas.addEventListener("wheel",this.__onMouseWheel,activeEventOptions))}else if(chartLength<this.__iCharts.length)for(let i=this.__iCharts.length-1,ii=chartLength-1;i>=ii;i--)if(i>=chartLength){let canvas=this.__iCharts[i].getCanvasZooming();canvas&&(canvas.removeEventListener("mousedown",this.__onMouseDown,passiveEventOptions),canvas.removeEventListener("touchstart",this.__onTouchStart,activeEventOptions),canvas.removeEventListener("wheel",this.__onMouseWheel,activeEventOptions)),this.__iCharts[i].remove(),this.__iCharts.splice(i,1),this.__chartingElements[i].remove(),this.__chartingElements.splice(i,1)}for(let i=0,ii=this.__iCharts.length;i<ii;i++)isDigitalChart?this.__iCharts[i]instanceof ScopeChart&&this.__iCharts.splice(i,i+1,new DigitalChartClass(this.__iCharts[i].getRootElement(),this.__scopeLayout.charts[i].dimensions.width,this.__scopeLayout.charts[i].dimensions.height,!0)):this.__iCharts[i]instanceof DigitalChartClass&&this.__iCharts.splice(i,i+1,new ScopeChart(this.__iCharts[i].getRootElement(),this.__scopeLayout.charts[i].dimensions.width,this.__scopeLayout.charts[i].dimensions.height,!0));this.__resizeLines=[];let heightObjectsBeforeCharts=0;this.__scopeLayout.overview&&(heightObjectsBeforeCharts+=this.__scopeLayout.overview.dimensions.height+5);let width=this.__elementChartings.innerWidth(),height=this.__elementChartings.innerHeight();this.__elementBorder.attr("width",width).attr("height",height);let contextBorderElem=canvasBorderElem.getContext("2d");contextBorderElem&&(contextBorderElem.clearRect(0,0,canvasBorderElem.width,canvasBorderElem.height),this.__themeChartForegroundColor&&this.__chartChartColorSource===ChartColorSource.Theme?contextBorderElem.strokeStyle=this.__themeChartForegroundColor:contextBorderElem.strokeStyle=this.__scopeLayout.foregroundColor,contextBorderElem.lineWidth=1,contextBorderElem.beginPath());let headlineHeight=0;this.__scopeLayout.headline?(this.__chartChartColorSource===ChartColorSource.ScopeConfig?this.__elementChartName.css({display:"block","font-size":this.__scopeLayout.headline.fontSize+"pt",color:this.__scopeLayout.headline.color,width:this.__scopeLayout.headline.dimensions.width,height:this.__scopeLayout.headline.dimensions.height,top:heightObjectsBeforeCharts+"px","border-bottom":"1px solid "+this.__scopeLayout.foregroundColor}):this.__elementChartName.css({display:"block","font-size":this.__scopeLayout.headline.fontSize+"pt",color:null!==this.__themeChartForegroundColor?this.__themeChartForegroundColor:this.__scopeLayout.headline.color,width:this.__scopeLayout.headline.dimensions.width,height:this.__scopeLayout.headline.dimensions.height,top:heightObjectsBeforeCharts+"px","border-bottom":"1px solid "+this.__themeChartForegroundColor}),this.__elementChartName[0].textContent=this.__scopeLayout.headline.label,headlineHeight=this.__scopeLayout.headline.dimensions.height):this.__elementChartName.css("display","none"),this.__themeChartBackgroundColor&&this.__chartChartColorSource===ChartColorSource.Theme?this.__elementChartings.css({"background-color":this.__themeChartBackgroundColor,"background-image":""}):this.__scopeLayout.gradientBackground?this.__elementChartings.css({"background-image":"linear-gradient("+this.__scopeLayout.backgroundColor+", "+this.__scopeLayout.gradientBackgroundColor+")","background-color":""}):this.__elementChartings.css({"background-color":this.__scopeLayout.backgroundColor,"background-image":""});let beginHorizontalLineY=0;this.__scopeLayout.headline&&(beginHorizontalLineY=this.__scopeLayout.headline.dimensions.height);for(let i=0,ii=this.__scopeLayout.charts.length;i<ii;i++){let chart=this.__scopeLayout.charts[i],iChart=this.__iCharts[i];if(chart.visible&&!isDigitalChartLayout(chart)&&iChart instanceof ScopeChart){if(contextBorderElem){let startPointHorizontal={x:0,y:(heightObjectsBeforeCharts+chart.position.y|0)-.5},endPointHorizontal={x:0|canvasBorderElem.width,y:(heightObjectsBeforeCharts+chart.position.y|0)-.5},lineWasDrawHorizontal=this.__resizeLines.some(elem=>elem.startPoint.y===startPointHorizontal.y);chart.position.y===beginHorizontalLineY||lineWasDrawHorizontal||(contextBorderElem.moveTo(startPointHorizontal.x,startPointHorizontal.y),contextBorderElem.lineTo(endPointHorizontal.x,endPointHorizontal.y),this.__resizeLines.push({orientation:Orientation.Horizontal,startPoint:startPointHorizontal,endPoint:endPointHorizontal,chartIndex:i}));let startPointVertical={x:(chart.position.x+chart.dimensions.width|0)-.5,y:heightObjectsBeforeCharts+headlineHeight|0},endPointVertical={x:(chart.position.x+chart.dimensions.width|0)-.5,y:0|canvasBorderElem.height},lineWasDrawVertical=this.__resizeLines.some(elem=>elem.startPoint.x===startPointVertical.x);ChartType[this.__scopeLayout.chartType]!==ChartType.SingleBarChart||lineWasDrawVertical||(contextBorderElem.moveTo(startPointVertical.x,startPointVertical.y),contextBorderElem.lineTo(endPointVertical.x,endPointVertical.y),this.__resizeLines.push({orientation:Orientation.Vertical,startPoint:startPointVertical,endPoint:endPointVertical,chartIndex:i}))}this.__iCharts[i].clear(chart.dimensions.width,chart.dimensions.height);let axisGroupForegroundColor="";this.__themeAxisGroupForegroundColor&&this.__chartChartColorSource===ChartColorSource.Theme?axisGroupForegroundColor=this.__themeAxisGroupForegroundColor:chart.headline&&chart.headline.color&&(axisGroupForegroundColor=chart.headline.color),iChart.setAxisGroupForegroundColor(axisGroupForegroundColor),this.__chartingElements[i].css({width:chart.dimensions.width+"px",height:chart.dimensions.height+"px",left:chart.position.x,top:heightObjectsBeforeCharts+chart.position.y});for(let j=0,jj=chart.verticalAxis.length;j<jj;j++)chart.verticalAxis[j].visible&&(this.__chartChartColorSource===ChartColorSource.ScopeConfig?iChart.addYAxis(chart.verticalAxis[j],null,null):iChart.addYAxis(chart.verticalAxis[j],this.__themeAxisColor,this.__themeAxisColor)),this.__chartChartColorSource===ChartColorSource.ScopeConfig?iChart.addGrid(null,chart.verticalAxis[j],chart.gridSize,null):iChart.addGrid(null,chart.verticalAxis[j],chart.gridSize,this.__themeGridColor),this.__chartChartColorSource===ChartColorSource.ScopeConfig?iChart.addSubgrid(null,chart.verticalAxis[j],chart.gridSize,null):iChart.addSubgrid(null,chart.verticalAxis[j],chart.gridSize,this.__themeGridColor);for(let j=0,jj=chart.horizontalAxis.length;j<jj;j++)chart.horizontalAxis[j].visible&&(this.__chartChartColorSource===ChartColorSource.ScopeConfig?iChart.addXAxis(chart.horizontalAxis[j],null,null):iChart.addXAxis(chart.horizontalAxis[j],this.__themeAxisColor,this.__themeAxisColor)),this.__chartChartColorSource===ChartColorSource.ScopeConfig?iChart.addGrid(chart.horizontalAxis[j],null,chart.gridSize,null):iChart.addGrid(chart.horizontalAxis[j],null,chart.gridSize,this.__themeGridColor),this.__chartChartColorSource===ChartColorSource.ScopeConfig?iChart.addSubgrid(chart.horizontalAxis[j],null,chart.gridSize,null):iChart.addSubgrid(chart.horizontalAxis[j],null,chart.gridSize,this.__themeGridColor);if(chart.graphs)for(let j=0,jj=chart.graphs.length;j<jj;j++)iChart.addLineGraph(chart.graphs[j],{dimensions:chart.gridSize.dimensions,position:chart.gridSize.position});if(this.__scopeGraphData){let chartData=this.__scopeGraphData.charts[i];if(!isDigitalChartData(chartData)){if(chartData&&chartData.graphs)for(let key in chartData.graphs){let graph=chartData.graphs[key];if(graph&&chart){let lineGraph=iChart.getLineGraphWithName(key);lineGraph&&(lineGraph.setPoints(graph.axesData),lineGraph.setZeroPoint(graph.zeroPoint),lineGraph.setLineSeries(graph.lineSeries))}}if(chartData&&chartData.trigger)for(let k=0,kk=chartData.trigger.length;k<kk;k++)iChart.addTrigger(chartData.trigger[k]);if(chartData&&chartData.xyTrigger)for(let k=0,kk=chartData.xyTrigger.length;k<kk;k++)iChart.addXYTrigger(chartData.xyTrigger[k])}}this.__chartChartColorSource===ChartColorSource.ScopeConfig?iChart.draw(chart,null):iChart.draw(chart,this.__themeCanvasBackgroundColor)}else chart.visible&&isDigitalChartLayout(chart)&&iChart instanceof DigitalChartClass?(iChart.clear(chart.dimensions.width,chart.dimensions.height),this.__chartingElements[i].css({width:chart.dimensions.width+"px",height:chart.dimensions.height+"px",left:chart.position.x,top:heightObjectsBeforeCharts+chart.position.y}),this.__scopeGraphData&&isDigitalChartData(this.__scopeGraphData.charts[i])?iChart.draw(chart,this.__scopeGraphData.charts[i]):iChart.draw(chart,null)):isDigitalChartLayout(chart)?iChart.clear(0,0):this.__iCharts[i].clear(0,0)}contextBorderElem?.stroke()}if(this.__scopeLayout.overview){if(this.__resizeLines.push({orientation:Orientation.Horizontal,startPoint:{x:0,y:1+(0|this.__scopeLayout.overview.dimensions.height)},endPoint:{x:0|canvasBorderElem.width,y:1+(0|this.__scopeLayout.overview.dimensions.height)},chartIndex:-1}),this.__showOverview=!0,this.__overviewChart)this.__overviewChart.clear(this.__scopeLayout.overview.dimensions.width,this.__scopeLayout.overview.dimensions.height);else{this.__overviewChart=new ScopeChart(this.__elementOverview,this.__scopeLayout.overview.dimensions.width,this.__scopeLayout.overview.dimensions.height,!1);let canvas=this.__overviewChart.getCanvasZooming();canvas&&(canvas.addEventListener("mousedown",this.__onMouseDown,passiveEventOptions),canvas.addEventListener("mouseup",this.__onMouseUpOverview,passiveEventOptions),canvas.addEventListener("mousemove",this.__onMouseMoveOverview,passiveEventOptions),canvas.addEventListener("touchstart",this.__onTouchStart,activeEventOptions))}this.__elementOverview.css({display:"block",width:this.__scopeLayout.overview.dimensions.width+"px",height:this.__scopeLayout.overview.dimensions.height+"px"});for(let j=0,jj=this.__scopeLayout.overview.verticalAxis.length;j<jj;j++)this.__scopeLayout.overview.verticalAxis[j].visible&&(this.__chartChartColorSource===ChartColorSource.ScopeConfig?this.__overviewChart.addYAxis(this.__scopeLayout.overview.verticalAxis[j],null,null):this.__overviewChart.addYAxis(this.__scopeLayout.overview.verticalAxis[j],this.__themeOverviewForegroundColor,this.__themeOverviewForegroundColor)),this.__chartChartColorSource===ChartColorSource.ScopeConfig?this.__overviewChart.addGrid(null,this.__scopeLayout.overview.verticalAxis[j],this.__scopeLayout.overview.gridSize,null):this.__overviewChart.addGrid(null,this.__scopeLayout.overview.verticalAxis[j],this.__scopeLayout.overview.gridSize,this.__themeOverviewForegroundColor),this.__chartChartColorSource===ChartColorSource.ScopeConfig?this.__overviewChart.addSubgrid(null,this.__scopeLayout.overview.verticalAxis[j],this.__scopeLayout.overview.gridSize,null):this.__overviewChart.addSubgrid(null,this.__scopeLayout.overview.verticalAxis[j],this.__scopeLayout.overview.gridSize,this.__themeOverviewForegroundColor);for(let j=0,jj=this.__scopeLayout.overview.horizontalAxis.length;j<jj;j++)this.__scopeLayout.overview.horizontalAxis[j].visible&&(this.__chartChartColorSource===ChartColorSource.ScopeConfig?this.__overviewChart.addXAxis(this.__scopeLayout.overview.horizontalAxis[j],null,null):this.__overviewChart.addXAxis(this.__scopeLayout.overview.horizontalAxis[j],this.__themeOverviewForegroundColor,this.__themeOverviewForegroundColor)),this.__chartChartColorSource===ChartColorSource.ScopeConfig?this.__overviewChart.addGrid(this.__scopeLayout.overview.horizontalAxis[j],null,this.__scopeLayout.overview.gridSize,null):this.__overviewChart.addGrid(this.__scopeLayout.overview.horizontalAxis[j],null,this.__scopeLayout.overview.gridSize,this.__themeOverviewForegroundColor),this.__chartChartColorSource===ChartColorSource.ScopeConfig?this.__overviewChart.addSubgrid(this.__scopeLayout.overview.horizontalAxis[j],null,this.__scopeLayout.overview.gridSize,null):this.__overviewChart.addSubgrid(this.__scopeLayout.overview.horizontalAxis[j],null,this.__scopeLayout.overview.gridSize,this.__themeOverviewForegroundColor);if(this.__scopeLayout.overview.graphs)for(let j=0,jj=this.__scopeLayout.overview.graphs.length;j<jj;j++)this.__overviewChart.addLineGraph(this.__scopeLayout.overview.graphs[j],{dimensions:this.__scopeLayout.overview.gridSize.dimensions,position:this.__scopeLayout.overview.gridSize.position});if(this.__scopeGraphData&&this.__overviewChart&&this.__scopeGraphData.overview&&this.__scopeGraphData.overview.graphs)for(let key in this.__scopeGraphData.overview.graphs){let graph=this.__scopeGraphData.overview.graphs[key];if(graph){let overviewGraph=this.__overviewChart.getLineGraphWithName(key);overviewGraph&&overviewGraph.setPoints(graph.axesData)}}if(this.__scopeGraphData&&this.__overviewChart&&this.__scopeGraphData.overview&&this.__scopeGraphData.overview.trigger)for(let k=0,kk=this.__scopeGraphData.overview.trigger.length;k<kk;k++)this.__overviewChart.addTrigger(this.__scopeGraphData.overview.trigger[k]);if(this.__chartChartColorSource===ChartColorSource.ScopeConfig?this.__overviewChart.draw(this.__scopeLayout.overview,null):this.__overviewChart.draw(this.__scopeLayout.overview,this.__themeCanvasBackgroundColor),this.__scopeGraphWindow&&this.__scopeGraphWindow.overviewRect){const canvas=this.__overviewChart.getCanvasZooming();let context=canvas.getContext("2d");if(context){let canvasWidth=canvas.width/window.devicePixelRatio,canvasHeight=canvas.height/window.devicePixelRatio;context.clearRect(0,0,canvasWidth,canvasHeight),context.fillStyle="rgba(51,153,255,0.3)",context.fillRect(this.__scopeLayout.overview.canvas.position.x+this.__scopeGraphWindow.overviewRect.position.x,this.__scopeLayout.overview.canvas.position.y,this.__scopeGraphWindow.overviewRect.dimensions.width,this.__scopeGraphWindow.overviewRect.dimensions.height)}}}else if(this.__showOverview=!1,this.__elementOverview.css({display:"none"}),this.__overviewChart){let canvas=this.__overviewChart.getCanvasZooming();canvas&&(canvas.removeEventListener("mousedown",this.__onMouseDown,passiveEventOptions),canvas.removeEventListener("mousemove",this.__onMouseMoveOverview,passiveEventOptions),canvas.removeEventListener("mouseup",this.__onMouseUpOverview,passiveEventOptions),canvas.removeEventListener("touchstart",this.__onTouchStart,activeEventOptions)),this.__overviewChart.remove(),this.__overviewChart=null}}else{for(let i=0,ii=this.__iCharts.length;i<ii;i++){let canvas=this.__iCharts[i].getCanvasZooming();canvas&&(canvas.removeEventListener("mousedown",this.__onMouseDown,passiveEventOptions),canvas.removeEventListener("wheel",this.__onMouseWheel,activeEventOptions),canvas.removeEventListener("touchstart",this.__onTouchStart,activeEventOptions)),this.__iCharts[i].remove(),this.__chartingElements[i].remove()}if(this.__iCharts=[],this.__chartingElements=[],this.__overviewChart){let canvas=this.__overviewChart.getCanvasZooming();canvas&&(canvas.removeEventListener("mousedown",this.__onMouseDown,passiveEventOptions),canvas.removeEventListener("mousemove",this.__onMouseMoveOverview,passiveEventOptions),canvas.removeEventListener("mouseup",this.__onMouseUpOverview,passiveEventOptions),canvas.removeEventListener("touchstart",this.__onTouchStart,activeEventOptions)),this.__overviewChart.remove(),this.__overviewChart=null}this.__elementOverview.css({display:"none"}),this.__elementChartName.css("display","none"),this.__elementChartings.children(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-chart").remove();let contextBorderElem=canvasBorderElem.getContext("2d");contextBorderElem&&contextBorderElem.clearRect(0,0,canvasBorderElem.width,canvasBorderElem.height)}}__onPressed(evt){if(null!==this.__elementMenuBarDropdown[0].parentElement&&this.showOptions(),evt.name.includes("options"))this.showOptions();else if(evt.name.includes("Run"))null!==this.__subscriptionIds.dataLayoutAndWindow&&this.__serverSymbolsHelper.startDisplay();else if(evt.name.includes("Pause"))null!==this.__subscriptionIds.dataLayoutAndWindow&&this.__serverSymbolsHelper.stopDisplay();else if(evt.name.includes("Unzoom"))null!==this.__subscriptionIds.dataLayoutAndWindow&&this.__serverSymbolsHelper.zoomToDefault();else if(evt.name.includes("ZoomOutMax"))null!==this.__subscriptionIds.dataLayoutAndWindow&&this.__serverSymbolsHelper.zoomOutMax();else if(evt.name.includes("PanXY"))this.__mouseMode=MouseMode.PanXY;else if(evt.name.includes("PanY"))this.__mouseMode=MouseMode.PanY;else if(evt.name.includes("Pan"))this.__mouseMode=MouseMode.PanX;else if(evt.name.includes("ZoomXY"))this.__mouseMode=MouseMode.ZoomXY;else if(evt.name.includes("ZoomY"))this.__mouseMode=MouseMode.ZoomY;else if(evt.name.includes("Zoom"))this.__mouseMode=MouseMode.ZoomX;else if(evt.name.includes("ScrollBackBig"))this.__serverSymbolsHelper.scrollBig(Direction.Reverse);else if(evt.name.includes("ScrollBackSmall"))this.__serverSymbolsHelper.scroll(Direction.Reverse);else if(evt.name.includes("ScrollForwardBig"))this.__serverSymbolsHelper.scrollBig(Direction.Forward);else if(evt.name.includes("ScrollForwardSmall"))this.__serverSymbolsHelper.scroll(Direction.Forward);else if(evt.name.includes("Undo"))this.__serverSymbolsHelper.undo();else if(evt.name.includes("Redo"))this.__serverSymbolsHelper.redo();else if(evt.name.includes("Overview"))this.__serverSymbolsHelper.setOverviewMode();else if(evt.name.includes("StartRecord"))this.__serverSymbolsHelper.startRecord();else if(evt.name.includes("StopRecord"))this.__serverSymbolsHelper.stopRecord();else if(evt.name.includes("TriggerWindow")){"Active"===this.__toolBarControls.TriggerWindowButton.getToggleState()?this.setShowTriggerWindow(!0):this.setShowTriggerWindow(!1)}else evt.name.includes("Upload")?(this.__dialog??=new Dialog(this.__elementDialog[0],this),this.__dialog.setSrcDataOfRecordsDatagrid(this.__uploadedRecordsForActUser),this.__dialog.show()):evt.name.includes("Download")?this.__serverSymbolsHelper.__downloadScopeRecord():evt.name.includes("TimeRange")&&(this.__timeRangeDialog??=new TimeRangeDialog(this.__elementTimeRangeDialog[0],this),this.__timeRangeDialog.show())}__onTriggerDatagrid_DataChanged(evt,property){if("comment"===property.property&&this.__triggerWindow){let triggerWindowElem=this.__triggerWindow[property.index],request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".SetTriggerComment",writeValue:{controlName:this.__id,scopeConfig:this.__scopeConfig,triggerId:triggerWindowElem.id,newText:property.value}}]};this.__loadingSpinner&&this.__elementLoading[0].appendChild(this.__loadingSpinner),this.__enableOrDisableMenuControls("Disable",!1,!1,!1,ChartType.YT),TcHmi.Server.releaseRequest(this.__requestIds.setTriggerComment),this.__requestIds.setTriggerComment=TcHmi.Server.requestEx(request,{parallel:!0},this.__getDataCallback)}}__onUserInteractionFinished(evt){if(evt.name.includes("DisplaywidthTextBox")){if(null!==this.__subscriptionIds.dataLayoutAndWindow){let textboxElem=this.__toolBarControls.DisplaywidthTextBox;if(textboxElem){let textboxText=textboxElem.getText()??"";this.__serverSymbolsHelper.setDisplayWidth(textboxText)}}}else if(evt.name.includes("GotoTextBox")&&null!==this.__subscriptionIds.dataLayoutAndWindow){let textboxElem=this.__toolBarControls.GotoTextBox;if(textboxElem){let textboxText=textboxElem.getText()??"";this.__serverSymbolsHelper.goTo(textboxText)}}}__createLegend(legend){if(this.__elementLegend.children().remove(),legend){legend.length>0?TcHmi.StyleProvider.setSimpleElementStyle(this.__elementLegend,"display",""):TcHmi.StyleProvider.setSimpleElementStyle(this.__elementLegend,"display","none");for(let i=0,ii=legend.length;i<ii;i++){let label=document.createElement("label");label.classList.add("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-legend-checkbox-label"),label.innerText=legend[i].text;let checkbox=document.createElement("input");checkbox.setAttribute("type","checkbox"),checkbox.setAttribute("id",legend[i].id),checkbox.classList.add("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-legend-checkbox");let color=document.createElement("div");color.classList.add("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-legend-checkbox-color-element"),color.setAttribute("style","background-color: "+legend[i].color+";"),label.append(checkbox),label.append(color),this.__elementLegend.append(label);let active=TcHmi.ValueConverter.toBoolean(legend[i].enabled,!1);checkbox.checked=active}}else TcHmi.StyleProvider.setSimpleElementStyle(this.__elementLegend,"display","none")}__createMenuButtons(enableButtons,enableTimes){this.__elementMenuBarDropdown.find(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-time-bar-dropdown").children().detach().appendTo(this.__elementTimeBar);for(const labels of Object.keys(TimesEnabled))if(isNaN(Number(labels))){let enumName=labels,addedLabels=(enableTimes&TimesEnabled[enumName])===TimesEnabled[enumName],timesName=enumName.replace("Label","");if(addedLabels){if(enumName.includes("Label")){let textValue="";textValue=enumName.includes("Position")?"0,00:00:00,000:000":enumName.includes("Date")?"Label_Text_Date_Placeholder":"00:00:00,000:000";let textblock,existingTextblock=this.__elementTimeBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_"+enumName)||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_"+enumName);textblock=null!==existingTextblock?$(existingTextblock):$('<div class="TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-textblock"></div>').attr({id:`${this.__id}_`+enumName,title:`%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Tooltip_Text_${timesName}%/l%`}),this.__elementTimeBar.append(textblock),this.__timeBarControls[enumName]=textblock,this.__addOrUpdateLocalizedElement(textblock[0],`Label_Text_${timesName}`,textValue),this.__addOrUpdateLocalizedElement(textblock[0],`Tooltip_Text_${timesName}`)}else if(enumName.includes("Splitter")){let splitter,existingSplitter=this.__elementTimeBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_"+enumName)||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_"+enumName);splitter=null!==existingSplitter?$(existingSplitter):$('<div class="TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-splitter"></div>').attr("id",`${this.__id}_`+enumName),this.__elementTimeBar.append(splitter),this.__timeBarControls[enumName]=splitter}}else if(!addedLabels){this.__removeLocalizedElement(`Label_Text_${timesName}`),this.__removeLocalizedElement(`Tooltip_Text_${timesName}`);let existingControl=this.__elementTimeBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_"+enumName)||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_"+enumName);if(existingControl)$(existingControl).remove();else{let splitter=this.__elementTimeBar.find("#"+this.__id+"_"+enumName);splitter&&splitter.length>0&&splitter.remove()}delete this.__timeBarControls[enumName]}}if(this.__toolBarControlsArray=[],this.__elementMenuBarDropdown.find(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tool-bar-dropdown").children().detach().appendTo(this.__elementToolBar),0===enableButtons||this.__menubar&&!this.__menubar.visibleToolstrip){if(null!==(this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_StartRecordButton")||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_StartRecordButton"))){const elem=this.__toolBarControls.StartRecordButton;elem&&elem.destroy();const destroyEvent=this.__destroyEvents.StartRecordButton;destroyEvent&&(destroyEvent(),delete this.__destroyEvents.StartRecordButton),this.__toolBarControlsArray.splice(0,1),delete this.__toolBarControls.StartRecordButton}if(null!==(this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_StopRecordButton")||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_StopRecordButton"))){const elem=this.__toolBarControls.StopRecordButton;elem&&elem.destroy();const destroyEvent=this.__destroyEvents.StopRecordButton;destroyEvent&&(destroyEvent(),delete this.__destroyEvents.StopRecordButton),this.__toolBarControlsArray.splice(0,1),delete this.__toolBarControls.StopRecordButton}}else if(this.__enableRecordControls){let stopRecordButton=this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_StopRecordButton")||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_StopRecordButton");if(null===stopRecordButton){let buttonStopControl=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__id}_StopRecordButton`,{"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Tooltip_Text_Stop_Record%/l%","data-tchmi-virtual-control-right-mappings":this.__virtualMappingForControlRecord},this);if(!buttonStopControl)throw new Error("Needed Button could not be instantiated");buttonStopControl.getElement()[0].classList.add("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-button","TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-StopRecordButton"),buttonStopControl.getElement().prependTo(this.__elementToolBar),this.__toolBarControls.StopRecordButton=buttonStopControl,this.__toolBarControlsArray.unshift(buttonStopControl),this.__destroyEvents.StopRecordButton=TcHmi.EventProvider.register(this.__id+"_StopRecordButton.onPressed",this.__onPressed)}else this.__toolBarControlsArray.unshift($(stopRecordButton));let startRecordButton=this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_StartRecordButton")||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_StartRecordButton");if(null===startRecordButton){let buttonStartControl=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__id}_StartRecordButton`,{"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Tooltip_Text_Start_Record%/l%","data-tchmi-virtual-control-right-mappings":this.__virtualMappingForControlRecord},this);if(!buttonStartControl)throw new Error("Needed Button could not be instantiated");buttonStartControl.getElement()[0].classList.add("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-button","TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-StartRecordButton"),buttonStartControl.getElement().prependTo(this.__elementToolBar),this.__toolBarControls.StartRecordButton=buttonStartControl,this.__toolBarControlsArray.unshift(buttonStartControl),this.__destroyEvents.StartRecordButton=TcHmi.EventProvider.register(this.__id+"_StartRecordButton.onPressed",this.__onPressed)}else this.__toolBarControlsArray.unshift($(startRecordButton))}else{if(null!==(this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_StartRecordButton")||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_StartRecordButton"))){const elem=this.__toolBarControls.StartRecordButton;elem&&elem.destroy();const destroyEvent=this.__destroyEvents.StartRecordButton;destroyEvent&&(destroyEvent(),delete this.__destroyEvents.StartRecordButton),this.__toolBarControlsArray.splice(0,1),delete this.__toolBarControls.StartRecordButton}if(null!==(this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_StopRecordButton")||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_StopRecordButton"))){const elem=this.__toolBarControls.StopRecordButton;elem&&elem.destroy();const destroyEvent=this.__destroyEvents.StopRecordButton;destroyEvent&&(destroyEvent(),delete this.__destroyEvents.StopRecordButton),this.__toolBarControlsArray.splice(0,1),delete this.__toolBarControls.StopRecordButton}}for(const button of Object.keys(ButtonsEnabled))if(isNaN(Number(button))){let enumName=button,addedButton=(enableButtons&ButtonsEnabled[enumName])===ButtonsEnabled[enumName];if(addedButton){if(enumName.includes("ToggleButton")){let tooltipText=enumName.replace("ToggleButton","");if(null===(this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_"+enumName)||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_"+enumName))){let toggleButtonControl=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleButton",`${this.__id}_`+enumName,{"data-tchmi-toggle-group":this.__id+"MouseMode","data-tchmi-is-enabled":!1,"data-tchmi-tooltip":`%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Tooltip_Text_${tooltipText}%/l%`},this);if(!toggleButtonControl)throw new Error("Needed ToggleButton could not be instantiated");toggleButtonControl.getElement()[0].classList.add("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-toggle-button","TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-"+enumName),this.__elementToolBar.append(toggleButtonControl.getElement()),this.__toolBarControls[enumName]=toggleButtonControl,this.__toolBarControlsArray.push(toggleButtonControl),this.__destroyEvents[enumName]=TcHmi.EventProvider.register(this.__id+"_"+enumName+".onPressed",this.__onPressed)}else{let existingControlValue=this.__toolBarControls[enumName];existingControlValue&&this.__toolBarControlsArray.push(existingControlValue)}}else if(enumName.includes("Button")){let tooltipText=enumName.replace("Button","");if(null===(this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_"+enumName)||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_"+enumName))){let buttonControl=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__id}_`+enumName,{"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":`%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Tooltip_Text_${tooltipText}%/l%`},this);if(!buttonControl)throw new Error("Needed Button could not be instantiated");buttonControl.getElement()[0].classList.add("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-button","TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-"+enumName),this.__elementToolBar.append(buttonControl.getElement()),this.__toolBarControls[enumName]=buttonControl,this.__toolBarControlsArray.push(buttonControl),this.__destroyEvents[enumName]=TcHmi.EventProvider.register(this.__id+"_"+enumName+".onPressed",this.__onPressed)}else{let existingControlValue=this.__toolBarControls[enumName];existingControlValue&&this.__toolBarControlsArray.push(existingControlValue)}}else if(enumName.includes("Splitter")){let splitter,existingSplitter=this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_"+enumName)||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_"+enumName);null===existingSplitter?(splitter=$(`<div\n                                    class="TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-splitter TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-${enumName}"\n                                ></div>`).attr("id",`${this.__id}_`+enumName),this.__elementToolBar.append(splitter),this.__toolBarControls[enumName]=splitter):splitter=$(existingSplitter),this.__toolBarControlsArray.push(splitter)}else if(enumName.includes("TextBox")){let tooltipText=enumName.replace("TextBox","");if(null===(this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_"+enumName)||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_"+enumName))){let textboxControl=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",`${this.__id}_`+enumName,{"data-tchmi-text-horizontal-alignment":"Right","data-tchmi-is-enabled":!1,"data-tchmi-tooltip":`%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Tooltip_Text_${tooltipText}%/l%`,"data-tchmi-auto-focus-out":!0},this);if(!textboxControl)throw new Error("Needed Textbox could not be instantiated");textboxControl.getElement()[0].classList.add("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-textbox","TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-"+enumName),this.__elementToolBar.append(textboxControl.getElement()),this.__toolBarControls[enumName]=textboxControl,this.__toolBarControlsArray.push(textboxControl),this.__destroyEvents[enumName]=TcHmi.EventProvider.register(this.__id+"_"+enumName+".onUserInteractionFinished",this.__onUserInteractionFinished)}else{let existingControlValue=this.__toolBarControls[enumName];existingControlValue&&this.__toolBarControlsArray.push(existingControlValue)}}}else if(!addedButton){let existingControl=this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_"+enumName)||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_"+enumName);if(null===existingControl){let splitter=this.__elementToolBar.find("#"+this.__id+"_"+enumName);splitter&&splitter.length>0&&splitter.remove()}else $(existingControl).remove();if(enumName.includes("Button")||enumName.includes("TextBox")||enumName.includes("ToggleButton")){const elem=this.__toolBarControls[enumName];elem&&elem.destroy();const destroyEvent=this.__destroyEvents[enumName];destroyEvent&&(destroyEvent(),delete this.__destroyEvents[enumName])}delete this.__toolBarControls[enumName]}}if(0===enableButtons||this.__menubar&&!this.__menubar.visibleToolstrip){if(null!==(this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_TriggerWindowButton")||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_TriggerWindowButton"))){const elem=this.__toolBarControls.TriggerWindowButton;elem&&elem.destroy();const destroyEvent=this.__destroyEvents.TriggerWindowButton;destroyEvent&&(destroyEvent(),delete this.__destroyEvents.TriggerWindowButton),delete this.__toolBarControls.TriggerWindowButton}}else{let triggerWindowButton=this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_TriggerWindowButton")||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_TriggerWindowButton");if(null===triggerWindowButton){let buttonTriggerWindowControl=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleButton",`${this.__id}_TriggerWindowButton`,{"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Tooltip_Text_Trigger_Window%/l%","data-tchmi-toggle-state":this.__showTriggerWindow?"Active":"Normal"},this);if(!buttonTriggerWindowControl)throw new Error("Needed Button could not be instantiated");buttonTriggerWindowControl.getElement()[0].classList.add("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-toggle-button","TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-TriggerWindowButton"),this.__elementToolBar.append(buttonTriggerWindowControl.getElement()),this.__toolBarControls.TriggerWindowButton=buttonTriggerWindowControl,this.__toolBarControlsArray.push(buttonTriggerWindowControl),this.__destroyEvents.TriggerWindowButton=TcHmi.EventProvider.register(this.__id+"_TriggerWindowButton.onPressed",this.__onPressed)}else this.__toolBarControlsArray.push($(triggerWindowButton))}if(0===enableButtons||this.__menubar&&!this.__menubar.visibleToolstrip){if(null!==(this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_UploadButton")||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_UploadButton"))){const elem=this.__toolBarControls.UploadButton;elem&&elem.destroy();const destroyEvent=this.__destroyEvents.UploadButton;destroyEvent&&(destroyEvent(),delete this.__destroyEvents.UploadButton),delete this.__toolBarControls.UploadButton}}else{let uploadButton=this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_UploadButton")||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_UploadButton");if(null===uploadButton){const uploadMapping={controlRight:"operate",virtualControlRight:"upload"};let buttonUploadControl=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__id}_UploadButton`,{"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Tooltip_Text_Upload%/l%","data-tchmi-virtual-control-right-mappings":[uploadMapping]},this);if(!buttonUploadControl)throw new Error("Needed Button could not be instantiated");buttonUploadControl.getElement()[0].classList.add("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-button","TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-UploadButton"),this.__elementToolBar.append(buttonUploadControl.getElement()),this.__toolBarControls.UploadButton=buttonUploadControl,this.__toolBarControlsArray.push(buttonUploadControl),this.__destroyEvents.UploadButton=TcHmi.EventProvider.register(this.__id+"_UploadButton.onPressed",this.__onPressed)}else this.__toolBarControlsArray.push($(uploadButton))}if(0===enableButtons||this.__menubar&&!this.__menubar.visibleToolstrip){if(null!==(this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_DownloadButton")||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_DownloadButton"))){const elem=this.__toolBarControls.DownloadButton;elem&&elem.destroy();const destroyEvent=this.__destroyEvents.DownloadButton;destroyEvent&&(destroyEvent(),delete this.__destroyEvents.DownloadButton),delete this.__toolBarControls.DownloadButton}}else{let downloadButton=this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_DownloadButton")||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_DownloadButton");if(null===downloadButton){const downloadMapping={controlRight:"operate",virtualControlRight:"download"};let buttonDownloadControl=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__id}_DownloadButton`,{"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Tooltip_Text_Download%/l%","data-tchmi-virtual-control-right-mappings":[downloadMapping]},this);if(!buttonDownloadControl)throw new Error("Needed Button could not be instantiated");buttonDownloadControl.getElement()[0].classList.add("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-button","TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-DownloadButton"),this.__elementToolBar.append(buttonDownloadControl.getElement()),this.__toolBarControls.DownloadButton=buttonDownloadControl,this.__toolBarControlsArray.push(buttonDownloadControl),this.__destroyEvents.DownloadButton=TcHmi.EventProvider.register(this.__id+"_DownloadButton.onPressed",this.__onPressed)}else this.__toolBarControlsArray.push($(downloadButton))}if(0===enableButtons||this.__menubar&&!this.__menubar.visibleToolstrip||this.__menubar&&!this.__menubar.existsHistoricalAcquisition){if(null!==(this.__elementToolBar[0].querySelector("#"+this.__id+"_TimeRangeButton")||this.__elementMenuBarDropdown[0].querySelector("#"+this.__id+"_TimeRangeButton"))){const elem=this.__toolBarControls.TimeRangeButton;elem&&elem.destroy();const destroyEvent=this.__destroyEvents.TimeRangeButton;destroyEvent&&(destroyEvent(),delete this.__destroyEvents.TimeRangeButton),delete this.__toolBarControls.TimeRangeButton}}else{let timeRangeButton=this.__elementToolBar[0].querySelector("#"+this.__id+"_TimeRangeButton")||this.__elementMenuBarDropdown[0].querySelector("#"+this.__id+"_TimeRangeButton");if(null===timeRangeButton){let timeRangeControl=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__id}_TimeRangeButton`,{"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiScopeControl.TcHmiScopeControl::Tooltip_Text_TimeRange%/l%","data-tchmi-virtual-control-right-mappings":this.__virtualMappingForChangeHistoricalAquisitions},this);if(!timeRangeControl)throw new Error("Needed Button could not be instantiated");timeRangeControl.getElement()[0].classList.add("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-button","TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-TimeRangeButton"),this.__elementToolBar.append(timeRangeControl.getElement()),this.__toolBarControls.TimeRangeButton=timeRangeControl,this.__toolBarControlsArray.push(timeRangeControl),this.__destroyEvents.TimeRangeButton=TcHmi.EventProvider.register(this.__id+"_TimeRangeButton.onPressed",this.__onPressed)}else this.__toolBarControlsArray.push($(timeRangeButton))}if(void 0===this.__toolBarControls.OptionsButton){let optionsButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__id}_optionsButton`,{"data-tchmi-visibility":"Collapsed"},this);if(!optionsButton)throw new Error("Needed Button could not be instantiated");optionsButton.getElement()[0].classList.add("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-button","TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-options"),this.__elementToolBar.append(optionsButton.getElement()),this.__toolBarControls.OptionsButton=optionsButton,this.__toolBarControlsArray.push(optionsButton),this.__destroyEvents.OptionsButton=TcHmi.EventProvider.register(this.__id+"_optionsButton.onPressed",this.__onPressed)}else{let existingControlValue=this.__toolBarControls.OptionsButton;existingControlValue&&this.__toolBarControlsArray.push(existingControlValue)}}__calcMenuButtons(){if(this.__elementToolBar&&this.__elementMenuBarDropdown&&this.__toolBarControlsArray&&this.__timeBarControls){let timeBarDropDown=this.__elementMenuBarDropdown.find(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-time-bar-dropdown"),toolBarDropDown=this.__elementMenuBarDropdown.find(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tool-bar-dropdown"),optionsButtonWidth=0,optionsButton=this.__toolBarControls.OptionsButton;if(optionsButton){optionsButton.setVisibility("Visible");let width=optionsButton.getElement().outerWidth(!0);optionsButtonWidth=void 0===width?0:width}let menuBarWidth=this.__elementToolBar.width(),actualWidth=optionsButtonWidth;for(const control of this.__toolBarControlsArray){let width;control instanceof TcHmi.Controls.System.TcHmiControl?-1===control.getId().search("optionsButton")&&(width=control.getElement().outerWidth(!0)):width=control.outerWidth(!0),void 0===width&&(width=0),actualWidth+=width,actualWidth>=menuBarWidth&&(control instanceof TcHmi.Controls.System.TcHmiControl?-1===control.getId().search("optionsButton")&&toolBarDropDown.append(control.getElement()):toolBarDropDown.append(control[0]))}actualWidth=optionsButtonWidth;for(let controlName in this.__timeBarControls){let control=this.__timeBarControls[controlName];if(void 0!==control){let width=control.outerWidth(!0);void 0===width&&(width=0),actualWidth+=width,actualWidth>=menuBarWidth&&timeBarDropDown.append(control[0])}}timeBarDropDown.children().length>0||toolBarDropDown.children().length>0?optionsButton?.setVisibility("Visible"):optionsButton?.setVisibility("Collapsed")}}enableOrDisableMenuControls(){Object.values(this.__requestIds).every(x=>null===x)?this.__scopeGraphWindow&&this.__scopeLayout?this.__enableOrDisableMenuControls(this.__scopeGraphWindow.scopeState,this.__scopeGraphWindow.liveState,this.__scopeGraphWindow.undo,this.__scopeGraphWindow.redo,ChartType[this.__scopeLayout.chartType]):this.__enableOrDisableMenuControls("Unknown",!1,!1,!1,ChartType.YT):this.__enableOrDisableMenuControls("Disable",!1,!1,!1,ChartType.YT)}__enableOrDisableMenuControls(scopeState,live,undo,redo,chartType){switch(scopeState){case"Unknown":case"Config":case"Connected":for(let controlName in this.__toolBarControls){let control=this.__toolBarControls[controlName];control instanceof TcHmi.Controls.System.TcHmiControl&&control.setIsEnabled(!1)}this.__toolBarControls.StartRecordButton&&this.__toolBarControls.StartRecordButton.setIsEnabled(!0),this.__toolBarControls.StopRecordButton&&this.__toolBarControls.StopRecordButton.setIsEnabled(!1),this.__toolBarControls.TriggerWindowButton&&this.__toolBarControls.TriggerWindowButton.setIsEnabled(!0),this.__toolBarControls.UploadButton&&this.__toolBarControls.UploadButton.setIsEnabled(!0),this.__toolBarControls.DownloadButton&&this.__toolBarControls.DownloadButton.setIsEnabled(!1),this.__toolBarControls.TimeRangeButton&&this.__toolBarControls.TimeRangeButton.setIsEnabled(!1),this.__toolBarControls.OptionsButton&&this.__toolBarControls.OptionsButton.setIsEnabled(!0);break;case"Running":for(let controlName in this.__toolBarControls){let control=this.__toolBarControls[controlName];control instanceof TcHmi.Controls.System.TcHmiControl&&control.setIsEnabled(!1)}this.__toolBarControls.StartRecordButton&&this.__toolBarControls.StartRecordButton.setIsEnabled(!1),this.__toolBarControls.StopRecordButton&&this.__toolBarControls.StopRecordButton.setIsEnabled(!0),this.__toolBarControls.TriggerWindowButton&&this.__toolBarControls.TriggerWindowButton.setIsEnabled(!0),this.__toolBarControls.UploadButton&&this.__toolBarControls.UploadButton.setIsEnabled(!0),this.__toolBarControls.DownloadButton&&this.__toolBarControls.DownloadButton.setIsEnabled(!1),this.__toolBarControls.TimeRangeButton&&this.__toolBarControls.TimeRangeButton.setIsEnabled(!1),this.__toolBarControls.OptionsButton&&this.__toolBarControls.OptionsButton.setIsEnabled(!0);break;case"Record":this.__toolBarControls.StartRecordButton&&this.__toolBarControls.StartRecordButton.setIsEnabled(!1),this.__toolBarControls.StopRecordButton&&this.__toolBarControls.StopRecordButton.setIsEnabled(!0),this.__toolBarControls.TriggerWindowButton&&this.__toolBarControls.TriggerWindowButton.setIsEnabled(!0),this.__toolBarControls.UploadButton&&this.__toolBarControls.UploadButton.setIsEnabled(!0),this.__toolBarControls.DownloadButton&&this.__toolBarControls.DownloadButton.setIsEnabled(!1),this.__toolBarControls.TimeRangeButton&&this.__toolBarControls.TimeRangeButton.setIsEnabled(!0),this.__toolBarControls.RunButton&&this.__toolBarControls.RunButton.setIsEnabled(!live),this.__toolBarControls.PauseButton&&this.__toolBarControls.PauseButton.setIsEnabled(live),this.__toolBarControls.DisplaywidthTextBox&&this.__toolBarControls.DisplaywidthTextBox.setIsEnabled(!0),this.__toolBarControls.ScrollBackBigButton&&this.__toolBarControls.ScrollBackBigButton.setIsEnabled(!live),this.__toolBarControls.ScrollForwardBigButton&&this.__toolBarControls.ScrollForwardBigButton.setIsEnabled(!live),this.__toolBarControls.ScrollBackSmallButton&&this.__toolBarControls.ScrollBackSmallButton.setIsEnabled(!live),this.__toolBarControls.ScrollForwardSmallButton&&this.__toolBarControls.ScrollForwardSmallButton.setIsEnabled(!live),this.__toolBarControls.GotoTextBox&&this.__toolBarControls.GotoTextBox.setIsEnabled(!live),this.__toolBarControls.UndoButton&&this.__toolBarControls.UndoButton.setIsEnabled(!live&&undo),this.__toolBarControls.RedoButton&&this.__toolBarControls.RedoButton.setIsEnabled(!live&&redo),this.__toolBarControls.ZoomToggleButton&&this.__toolBarControls.ZoomToggleButton.setIsEnabled(!live||chartType===ChartType.ArrayBarChart),this.__toolBarControls.ZoomXYToggleButton&&this.__toolBarControls.ZoomXYToggleButton.setIsEnabled(!live||chartType===ChartType.ArrayBarChart),this.__toolBarControls.PanXYToggleButton&&this.__toolBarControls.PanXYToggleButton.setIsEnabled(!live||chartType===ChartType.ArrayBarChart||chartType===ChartType.XY),this.__toolBarControls.PanToggleButton&&this.__toolBarControls.PanToggleButton.setIsEnabled(!live||chartType===ChartType.ArrayBarChart),this.__toolBarControls.ZoomYToggleButton&&this.__toolBarControls.ZoomYToggleButton.setIsEnabled(!live||chartType===ChartType.ArrayBarChart),this.__toolBarControls.PanYToggleButton&&this.__toolBarControls.PanYToggleButton.setIsEnabled(!live||chartType===ChartType.ArrayBarChart),this.__toolBarControls.OverviewButton&&this.__toolBarControls.OverviewButton.setIsEnabled(!0),this.__toolBarControls.UnzoomButton&&this.__toolBarControls.UnzoomButton.setIsEnabled(!0),this.__toolBarControls.ZoomOutMaxButton&&this.__toolBarControls.ZoomOutMaxButton.setIsEnabled(!0),this.__toolBarControls.OptionsButton&&this.__toolBarControls.OptionsButton.setIsEnabled(!0);break;case"Reply":this.__toolBarControls.StartRecordButton&&this.__toolBarControls.StartRecordButton.setIsEnabled(!0),this.__toolBarControls.StopRecordButton&&this.__toolBarControls.StopRecordButton.setIsEnabled(!1),this.__toolBarControls.TriggerWindowButton&&this.__toolBarControls.TriggerWindowButton.setIsEnabled(!0),this.__toolBarControls.UploadButton&&this.__toolBarControls.UploadButton.setIsEnabled(!0),this.__toolBarControls.DownloadButton&&this.__toolBarControls.DownloadButton.setIsEnabled(TcHmi.Environment.getBrowserCapabilities().supportsDownload),this.__toolBarControls.TimeRangeButton&&this.__toolBarControls.TimeRangeButton.setIsEnabled(!0),this.__toolBarControls.RunButton&&this.__toolBarControls.RunButton.setIsEnabled(!1),this.__toolBarControls.PauseButton&&this.__toolBarControls.PauseButton.setIsEnabled(!1),this.__toolBarControls.DisplaywidthTextBox&&this.__toolBarControls.DisplaywidthTextBox.setIsEnabled(!0),this.__toolBarControls.ScrollBackBigButton&&this.__toolBarControls.ScrollBackBigButton.setIsEnabled(!live),this.__toolBarControls.ScrollForwardBigButton&&this.__toolBarControls.ScrollForwardBigButton.setIsEnabled(!live),this.__toolBarControls.ScrollBackSmallButton&&this.__toolBarControls.ScrollBackSmallButton.setIsEnabled(!live),this.__toolBarControls.ScrollForwardSmallButton&&this.__toolBarControls.ScrollForwardSmallButton.setIsEnabled(!live),this.__toolBarControls.GotoTextBox&&this.__toolBarControls.GotoTextBox.setIsEnabled(!live),this.__toolBarControls.UndoButton&&this.__toolBarControls.UndoButton.setIsEnabled(!live&&undo),this.__toolBarControls.RedoButton&&this.__toolBarControls.RedoButton.setIsEnabled(!live&&redo),this.__toolBarControls.ZoomToggleButton&&this.__toolBarControls.ZoomToggleButton.setIsEnabled(!live),this.__toolBarControls.ZoomXYToggleButton&&this.__toolBarControls.ZoomXYToggleButton.setIsEnabled(!live),this.__toolBarControls.PanToggleButton&&this.__toolBarControls.PanToggleButton.setIsEnabled(!live),this.__toolBarControls.PanXYToggleButton&&this.__toolBarControls.PanXYToggleButton.setIsEnabled(!live),this.__toolBarControls.ZoomYToggleButton&&this.__toolBarControls.ZoomYToggleButton.setIsEnabled(!live),this.__toolBarControls.PanYToggleButton&&this.__toolBarControls.PanYToggleButton.setIsEnabled(!live),this.__toolBarControls.UnzoomButton&&this.__toolBarControls.UnzoomButton.setIsEnabled(!0),this.__toolBarControls.ZoomOutMaxButton&&this.__toolBarControls.ZoomOutMaxButton.setIsEnabled(!0),this.__toolBarControls.OverviewButton&&this.__toolBarControls.OverviewButton.setIsEnabled(!0),this.__toolBarControls.OptionsButton&&this.__toolBarControls.OptionsButton.setIsEnabled(!0);break;case"Reply_SVDX":this.__toolBarControls.StartRecordButton&&this.__toolBarControls.StartRecordButton.setIsEnabled(!1),this.__toolBarControls.StopRecordButton&&this.__toolBarControls.StopRecordButton.setIsEnabled(!1),this.__toolBarControls.TriggerWindowButton&&this.__toolBarControls.TriggerWindowButton.setIsEnabled(!0),this.__toolBarControls.UploadButton&&this.__toolBarControls.UploadButton.setIsEnabled(!0),this.__toolBarControls.DownloadButton&&this.__toolBarControls.DownloadButton.setIsEnabled(!1),this.__toolBarControls.TimeRangeButton&&this.__toolBarControls.TimeRangeButton.setIsEnabled(!1),this.__toolBarControls.RunButton&&this.__toolBarControls.RunButton.setIsEnabled(!1),this.__toolBarControls.PauseButton&&this.__toolBarControls.PauseButton.setIsEnabled(!1),this.__toolBarControls.DisplaywidthTextBox&&this.__toolBarControls.DisplaywidthTextBox.setIsEnabled(!0),this.__toolBarControls.ScrollBackBigButton&&this.__toolBarControls.ScrollBackBigButton.setIsEnabled(!live),this.__toolBarControls.ScrollForwardBigButton&&this.__toolBarControls.ScrollForwardBigButton.setIsEnabled(!live),this.__toolBarControls.ScrollBackSmallButton&&this.__toolBarControls.ScrollBackSmallButton.setIsEnabled(!live),this.__toolBarControls.ScrollForwardSmallButton&&this.__toolBarControls.ScrollForwardSmallButton.setIsEnabled(!live),this.__toolBarControls.GotoTextBox&&this.__toolBarControls.GotoTextBox.setIsEnabled(!live),this.__toolBarControls.UndoButton&&this.__toolBarControls.UndoButton.setIsEnabled(!live&&undo),this.__toolBarControls.RedoButton&&this.__toolBarControls.RedoButton.setIsEnabled(!live&&redo),this.__toolBarControls.ZoomToggleButton&&this.__toolBarControls.ZoomToggleButton.setIsEnabled(!live),this.__toolBarControls.ZoomXYToggleButton&&this.__toolBarControls.ZoomXYToggleButton.setIsEnabled(!live),this.__toolBarControls.PanToggleButton&&this.__toolBarControls.PanToggleButton.setIsEnabled(!live),this.__toolBarControls.PanXYToggleButton&&this.__toolBarControls.PanXYToggleButton.setIsEnabled(!live),this.__toolBarControls.ZoomYToggleButton&&this.__toolBarControls.ZoomYToggleButton.setIsEnabled(!live),this.__toolBarControls.PanYToggleButton&&this.__toolBarControls.PanYToggleButton.setIsEnabled(!live),this.__toolBarControls.UnzoomButton&&this.__toolBarControls.UnzoomButton.setIsEnabled(!0),this.__toolBarControls.ZoomOutMaxButton&&this.__toolBarControls.ZoomOutMaxButton.setIsEnabled(!0),this.__toolBarControls.OverviewButton&&this.__toolBarControls.OverviewButton.setIsEnabled(!0),this.__toolBarControls.OptionsButton&&this.__toolBarControls.OptionsButton.setIsEnabled(!0);break;default:for(let controlName in this.__toolBarControls){let control=this.__toolBarControls[controlName];control instanceof TcHmi.Controls.System.TcHmiControl&&"OptionsButton"!==controlName&&control.setIsEnabled(!1)}this.__toolBarControls.OptionsButton&&this.__toolBarControls.OptionsButton.setIsEnabled(!0)}this.__dialog&&this.__dialog.getIsWaitingForServer()&&(this.__toolBarControls.StartRecordButton&&this.__toolBarControls.StartRecordButton.setIsEnabled(!1),this.__toolBarControls.StopRecordButton&&this.__toolBarControls.StopRecordButton.setIsEnabled(!1))}__updatedMenuValues(windowData){for(let controlName in this.__timeBarControls)if(!controlName.includes("Splitter")){let textblock=this.__timeBarControls[controlName];if(controlName.includes("StartTime")){let textValue="";if(windowData&&windowData.xAxisStart){const dateSplitted=TcHmi.Localization.parseDate(new Date(windowData.xAxisStart));textValue=("00"+dateSplitted.hour).slice(-2)+":"+("00"+dateSplitted.minute).slice(-2)+":"+("00"+dateSplitted.second).slice(-2)+","+("000"+dateSplitted.millisecond).slice(-3)}else textValue="00:00:00,000:000";this.__addOrUpdateLocalizedElement(textblock[0],"Label_Text_StartTime",textValue)}else if(controlName.includes("EndTime")){let textValue="";if(windowData&&windowData.xAxisEnd){const dateSplitted=TcHmi.Localization.parseDate(new Date(windowData.xAxisEnd));textValue=("00"+dateSplitted.hour).slice(-2)+":"+("00"+dateSplitted.minute).slice(-2)+":"+("00"+dateSplitted.second).slice(-2)+","+("000"+dateSplitted.millisecond).slice(-3)}else textValue="00:00:00,000:000";this.__addOrUpdateLocalizedElement(textblock[0],"Label_Text_EndTime",textValue)}else if(controlName.includes("Position")){let textValue="";if(windowData&&windowData.xAxisPosition){textValue=__isoToScopeString(windowData.xAxisPosition)}else textValue="0,00:00:00,000:000";this.__addOrUpdateLocalizedElement(textblock[0],"Label_Text_Position",textValue)}else if(controlName.includes("AbsTime")){let textValue="";if(windowData&&windowData.startDisplayTime){const dateSplitted=TcHmi.Localization.parseDate(new Date(windowData.startDisplayTime));textValue=("00"+dateSplitted.hour).slice(-2)+":"+("00"+dateSplitted.minute).slice(-2)+":"+("00"+dateSplitted.second).slice(-2)+","+("000"+dateSplitted.millisecond).slice(-3)}else textValue="00:00:00,000:000";this.__addOrUpdateLocalizedElement(textblock[0],"Label_Text_AbsTime",textValue)}else if(controlName.includes("Date")){let textValue="";if(windowData&&windowData.startDisplayTime){let date=new Date(windowData.startDisplayTime);const dateSplitted=TcHmi.Localization.parseDate(date);textValue=date.toLocaleString(TcHmi.Server.getCurrentUserConfig().timeFormatLocale,{weekday:"long"})+", "+dateSplitted.day+". "+date.toLocaleString(TcHmi.Server.getCurrentUserConfig().timeFormatLocale,{month:"long"})+" "+dateSplitted.year}else textValue="Label_Text_Date_Placeholder";this.__addOrUpdateLocalizedElement(textblock[0],"Label_Text_Date",textValue)}}for(let controlName in this.__toolBarControls)if(controlName.includes("DisplaywidthTextBox")){const textbox=this.__toolBarControls[controlName];if(windowData&&windowData.displayWidth){let scopeString=__isoToScopeString(windowData.displayWidth);textbox.setText(scopeString),this.__displayWidthText=scopeString}else textbox.setText("0,00:00:00,000:000")}else if(controlName.includes("GotoTextBox")){const textbox=this.__toolBarControls[controlName];if(windowData&&windowData.xAxisPosition){let scopeString=__isoToScopeString(windowData.xAxisPosition);textbox.setText(scopeString),this.__gotoText=scopeString}else textbox.setText("0,00:00:00,000:000")}}showOptions(){null===this.__elementMenuBarDropdown[0].parentElement?TcHmi.TopMostLayer.add(this,this.__elementMenuBarDropdown,{centerHorizontal:!0,centerVertical:!0}):TcHmi.TopMostLayer.remove(this,this.__elementMenuBarDropdown)}__transformEventCoords(clientX,clientY,targetElement){if(targetElement){let renderedWidth=this.getRenderedWidth(),renderedHeight=this.getRenderedHeight();if(null===renderedWidth||null===renderedHeight)return{x:0,y:0};let controlRect=this.__element[0].getBoundingClientRect();this.__scaling={x:renderedWidth/controlRect.width,y:renderedHeight/controlRect.height}}return{x:clientX*this.__scaling.x,y:clientY*this.__scaling.y}}__onCheckboxMouseDown(event){if(1!==event.which)return;let childElement=event.target,checkboxElem=null;if("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-legend-checkbox"===childElement.className)checkboxElem=childElement;else if("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-legend-checkbox-label"===childElement.className){let checkboxList=childElement.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-legend-checkbox");checkboxList&&checkboxList.length>0&&(checkboxElem=checkboxList[0])}else if("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-legend-checkbox-color-element"===childElement.className&&childElement&&childElement.parentElement){let checkboxList=childElement.parentElement.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-legend-checkbox");checkboxList&&checkboxList.length>0&&(checkboxElem=checkboxList[0])}if(checkboxElem){let id=checkboxElem.id,checked=!checkboxElem.checked;if(!TcHmi.Access.checkAccess(this,"operate"))return void(checkboxElem.checked=checked);let children=this.__elementLegend.children(),activeLegendElements=[];for(let i=0,ii=children.length;i<ii;i++){let checkboxChecked=children[i].childNodes[1].checked,checkboxName=children[i].childNodes[0].textContent;id===children[i].childNodes[1].id&&(checkboxChecked=!checkboxChecked),checkboxChecked&&checkboxName&&activeLegendElements.push(checkboxName)}this.__activeLegendElements=activeLegendElements,this.__storage?.set("activeLegendElements",activeLegendElements),this.__serverSymbolsHelper.changeChannelState(id,checked)}}__onCheckboxTouchStart(event){let childElement=event.target;if(childElement){let checkboxList=childElement.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-legend-checkbox");if(checkboxList&&checkboxList.length>0){let checkoboxElement=checkboxList[0],id=checkoboxElement.id,checked=!checkoboxElement.checked;if(!TcHmi.Access.checkAccess(this,"operate"))return void(checkoboxElement.checked=checked);let children=this.__elementLegend.children(),activeLegendElements=[];for(let i=0,ii=children.length;i<ii;i++){let checkboxChecked=children[i].childNodes[1].checked,checkboxName=children[i].childNodes[0].textContent;id===children[i].childNodes[1].id&&(checkboxChecked=!checkboxChecked),checkboxChecked&&checkboxName&&activeLegendElements.push(checkboxName)}this.__activeLegendElements=activeLegendElements,this.__storage?.set("activeLegendElements",activeLegendElements),this.__serverSymbolsHelper.changeChannelState(id,checked)}}}__onMouseDown(event){if(this.__tooltipTimeout&&(clearTimeout(this.__tooltipTimeout),this.__tooltipTimeout=null,this.__elementTooltip.css({visibility:"hidden",top:"0px",left:"0px"})),this.__manipulationInfo.isManipulating)return;this.__manipulationInfo={isManipulating:!1,start:{x:0,y:0},end:{x:0,y:0},offset:{left:0,top:0},transform:{x:0,y:0},click:!0,mousePosition:{x:0,y:0},elementIndex:-1,isOverviewSizeChanged:!1,beginOverviewRectChanging:!0,chartSizeChanged:!1,resizeLineIndex:0,touchIdentifier:0,resizeTriggerWindow:!1,trigger:{move:!1,id:0}};let boundingRect=event.target.getBoundingClientRect(),coords=this.__transformEventCoords(event.clientX,event.clientY,event.target),parentElement=event.currentTarget.parentElement;if(parentElement){let index=-1;if(parentElement!==this.__elementOverview[0]&&(index=Array.prototype.slice.call(this.__elementChartings.children(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-chart")).indexOf(parentElement)),this.__scopeLayout){let x=coords.x-boundingRect.left,y=coords.y-boundingRect.top,scopeLayout=this.__scopeLayout.charts[index];if(!isDigitalChartLayout(scopeLayout)){if(this.__scopeLayout.showTooltip&&index>-1&&this.__scopeGraphWindow&&!this.__scopeGraphWindow.liveState&&this.__scopeGraphData&&this.__scopeGraphData.charts&&x>=scopeLayout.canvas.position.x&&x<=scopeLayout.canvas.position.x+scopeLayout.canvas.dimensions.width&&y>=scopeLayout.canvas.position.y&&y<=scopeLayout.canvas.position.y+scopeLayout.canvas.dimensions.height){let scopeData=this.__scopeGraphData.charts[index];if(scopeData&&!isDigitalChartData(scopeData)&&scopeData.trigger){let triggerToMove=scopeData.trigger.find(t=>!t.locked&&x>=t.position.x-t.delta&&x<=t.position.x+t.delta);if(triggerToMove)return this.__manipulationInfo.trigger.move=!0,this.__manipulationInfo.trigger.id=triggerToMove.id,this.__manipulationInfo.offset.left=boundingRect.left,this.__manipulationInfo.offset.top=boundingRect.top,this.__manipulationInfo.mousePosition={x,y},void this.__userInteractionStart(x,y,index)}if(this.__scopeLayout.showTooltip&&this.__scopeGraphWindow&&!this.__scopeGraphWindow.liveState)for(let i=0,ii=this.__scopeGraphData.charts.length;i<ii;i++){let scopeData=this.__scopeGraphData.charts[i];if(i===index&&scopeData&&!isDigitalChartData(scopeData)&&scopeData.graphs)for(let key in scopeData.graphs){let graph=scopeData.graphs[key];if(graph){let tooltipDelta=graph.tooltipDelta;if(graph.axesData.filter(item=>x>=item.x-tooltipDelta&&x<=item.x+tooltipDelta&&y>=item.y-tooltipDelta&&y<=item.y+tooltipDelta).length>0){this.__manipulationInfo.isManipulating=!0,this.__manipulationInfo.offset.left=boundingRect.left,this.__manipulationInfo.offset.top=boundingRect.top,this.__manipulationInfo.mousePosition={x,y};let scopeConfig=this.__scopeConfig;this.__scopeConfigToFile&&(scopeConfig=this.__scopeConfigToFile);let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage","SendWriteValue"],symbol:this.__serverDomain+".GetTooltip",writeValue:{controlName:this.__id,scopeConfig,chartIndex:index,mousePosition:{x,y}}}]};return this.__loadingSpinner&&this.__elementLoading[0].appendChild(this.__loadingSpinner),this.__enableOrDisableMenuControls("Disable",!1,!1,!1,ChartType.YT),TcHmi.Server.releaseRequest(this.__requestIds.getTooltip),void(this.__requestIds.getTooltip=TcHmi.Server.requestEx(request,{timeout:1e4},this.__getDataCallback))}}}}}if(-1===index)this.__scopeLayout.overview&&x>=this.__scopeLayout.overview.canvas.position.x&&x<=this.__scopeLayout.overview.canvas.position.x+this.__scopeLayout.overview.canvas.dimensions.width&&y>=this.__scopeLayout.overview.canvas.position.y&&y<=this.__scopeLayout.overview.canvas.position.y+this.__scopeLayout.overview.canvas.dimensions.height&&(this.__manipulationInfo.isManipulating=!0,this.__manipulationInfo.offset.left=boundingRect.left,this.__manipulationInfo.offset.top=boundingRect.top,this.__manipulationInfo.mousePosition={x,y},this.__userInteractionStart(x,y,index));else{if(this.__scopeGraphWindow&&this.__scopeGraphWindow.liveState)return;x>=scopeLayout.canvas.position.x&&x<=scopeLayout.canvas.position.x+scopeLayout.canvas.dimensions.width&&y>=scopeLayout.canvas.position.y&&y<=scopeLayout.canvas.position.y+scopeLayout.canvas.dimensions.height&&(this.__manipulationInfo.isManipulating=!0,this.__manipulationInfo.offset.left=boundingRect.left,this.__manipulationInfo.offset.top=boundingRect.top,this.__manipulationInfo.mousePosition={x,y},this.__userInteractionStart(x,y,index))}}}}}__onMouseDownGlobal(event){if(!this.__manipulationInfo.isManipulating){if(this.__tooltipTimeout&&(clearTimeout(this.__tooltipTimeout),this.__tooltipTimeout=null,this.__elementTooltip.css({visibility:"hidden",top:"0px",left:"0px"})),this.__manipulationInfo={isManipulating:!1,start:{x:0,y:0},end:{x:0,y:0},offset:{left:0,top:0},transform:{x:0,y:0},click:!0,mousePosition:{x:0,y:0},elementIndex:-1,isOverviewSizeChanged:!1,beginOverviewRectChanging:!0,chartSizeChanged:!1,resizeLineIndex:0,touchIdentifier:0,resizeTriggerWindow:!1,trigger:{move:!1,id:0}},this.__resizeLines.length>0){let boundingRect=this.__elementBorder[0].getBoundingClientRect(),coords=this.__transformEventCoords(event.clientX,event.clientY,event.target),x=coords.x-boundingRect.left,y=coords.y-boundingRect.top;for(let i=0,ii=this.__resizeLines.length;i<ii;i++)if(this.__resizeLines[i].orientation===Orientation.Horizontal){if(y>=this.__resizeLines[i].startPoint.y-5&&y<=this.__resizeLines[i].endPoint.y+5)return void(this.__manipulationInfo={isManipulating:!0,start:{x,y},end:{x,y},offset:{left:boundingRect.left,top:boundingRect.top},transform:{x:0,y:0},click:!0,mousePosition:{x,y},elementIndex:this.__resizeLines[i].chartIndex,isOverviewSizeChanged:!1,beginOverviewRectChanging:!0,chartSizeChanged:!0,resizeLineIndex:i,touchIdentifier:0,resizeTriggerWindow:!1,trigger:{move:!1,id:0}})}else if(this.__resizeLines[i].orientation===Orientation.Vertical&&x>=this.__resizeLines[i].startPoint.x-5&&x<=this.__resizeLines[i].endPoint.x+5)return void(this.__manipulationInfo={isManipulating:!0,start:{x,y},end:{x,y},offset:{left:boundingRect.left,top:boundingRect.top},transform:{x:0,y:0},click:!0,mousePosition:{x,y},elementIndex:this.__resizeLines[i].chartIndex,isOverviewSizeChanged:!1,beginOverviewRectChanging:!0,chartSizeChanged:!0,resizeLineIndex:i,touchIdentifier:0,resizeTriggerWindow:!1,trigger:{move:!1,id:0}})}if(this.__showTriggerWindow){let boundingRect=event.target.getBoundingClientRect(),coords=this.__transformEventCoords(event.clientX,event.clientY,event.target),x=coords.x-boundingRect.left,y=coords.y-boundingRect.top;if(this.__triggerWindowPosition===TriggerWindowPosition.Left){let widthTriggerWindow=this.__elementTriggerWindow.outerWidth()+5;x>=widthTriggerWindow&&x<=widthTriggerWindow+5&&(this.__manipulationInfo={isManipulating:!0,start:{x,y},end:{x,y},offset:{left:boundingRect.left,top:boundingRect.top},transform:{x:0,y:0},click:!0,mousePosition:{x,y},elementIndex:-1,isOverviewSizeChanged:!1,beginOverviewRectChanging:!1,chartSizeChanged:!1,resizeLineIndex:0,touchIdentifier:0,resizeTriggerWindow:!0,trigger:{move:!1,id:0}})}else if(this.__triggerWindowPosition===TriggerWindowPosition.Right){let widthChartings=this.__elementChartings.outerWidth()+5;x>=widthChartings&&x<=widthChartings+5&&(this.__manipulationInfo={isManipulating:!0,start:{x,y},end:{x,y},offset:{left:boundingRect.left,top:boundingRect.top},transform:{x:0,y:0},click:!0,mousePosition:{x,y},elementIndex:-1,isOverviewSizeChanged:!1,beginOverviewRectChanging:!1,chartSizeChanged:!1,resizeLineIndex:0,touchIdentifier:0,resizeTriggerWindow:!0,trigger:{move:!1,id:0}})}else if(this.__triggerWindowPosition===TriggerWindowPosition.Top){let heightTriggerWindow=this.__elementTriggerWindow.outerHeight()+5;y>=heightTriggerWindow&&y<=heightTriggerWindow+5&&(this.__manipulationInfo={isManipulating:!0,start:{x,y},end:{x,y},offset:{left:boundingRect.left,top:boundingRect.top},transform:{x:0,y:0},click:!0,mousePosition:{x,y},elementIndex:-1,isOverviewSizeChanged:!1,beginOverviewRectChanging:!1,chartSizeChanged:!1,resizeLineIndex:0,touchIdentifier:0,resizeTriggerWindow:!0,trigger:{move:!1,id:0}})}else if(this.__triggerWindowPosition===TriggerWindowPosition.Bottom){let heightBeforeTriggerWindow=5+this.__elementMenuBar.outerHeight()+5+this.__elementChartings.outerHeight()+5+this.__elementLegend.outerHeight();y>=heightBeforeTriggerWindow&&y<=heightBeforeTriggerWindow+5&&(this.__manipulationInfo={isManipulating:!0,start:{x,y},end:{x,y},offset:{left:boundingRect.left,top:boundingRect.top},transform:{x:0,y:0},click:!0,mousePosition:{x,y},elementIndex:-1,isOverviewSizeChanged:!1,beginOverviewRectChanging:!1,chartSizeChanged:!1,resizeLineIndex:0,touchIdentifier:0,resizeTriggerWindow:!0,trigger:{move:!1,id:0}})}}}}__onMouseMove(event){if(!this.__manipulationInfo.isManipulating)return;let coords=this.__transformEventCoords(event.clientX,event.clientY),x=coords.x-this.__manipulationInfo.offset.left,y=coords.y-this.__manipulationInfo.offset.top;this.__userInteractionMove(x,y)}__onMouseMoveChangeCursor(event){if(this.__elementChartings.css("cursor","default"),!this.__manipulationInfo.isManipulating&&this.__scopeLayout){if(this.__resizeLines.length>0){let boundingRect=this.__elementBorder[0].getBoundingClientRect(),coords=this.__transformEventCoords(event.clientX,event.clientY),x=coords.x-boundingRect.left,y=coords.y-boundingRect.top;for(let i=0,ii=this.__resizeLines.length;i<ii;i++)if(this.__resizeLines[i].orientation===Orientation.Horizontal){if(y>=this.__resizeLines[i].startPoint.y-5&&y<=this.__resizeLines[i].endPoint.y+5)return void this.__elementChartings.css("cursor","ns-resize")}else if(this.__resizeLines[i].orientation===Orientation.Vertical&&x>=this.__resizeLines[i].startPoint.x-5&&x<=this.__resizeLines[i].endPoint.x+5)return void this.__elementChartings.css("cursor","ew-resize")}if(this.__showTriggerWindow){let boundingRect=event.target.getBoundingClientRect(),coords=this.__transformEventCoords(event.clientX,event.clientY,event.target),x=coords.x-boundingRect.left,y=coords.y-boundingRect.top;if(this.__triggerWindowPosition===TriggerWindowPosition.Left){let widthTriggerWindow=this.__elementTriggerWindow.outerWidth()+5;x>=widthTriggerWindow&&x<=widthTriggerWindow+5?this.__elementTemplateRoot.css("cursor","ew-resize"):this.__elementTemplateRoot.css("cursor","")}else if(this.__triggerWindowPosition===TriggerWindowPosition.Right){let widthChartings=this.__elementChartings.outerWidth()+5;x>=widthChartings&&x<=widthChartings+5?this.__elementTemplateRoot.css("cursor","ew-resize"):this.__elementTemplateRoot.css("cursor","")}else if(this.__triggerWindowPosition===TriggerWindowPosition.Top){let heightTriggerWindow=this.__elementTriggerWindow.outerHeight()+5;y>=heightTriggerWindow&&y<=heightTriggerWindow+5?this.__elementTemplateRoot.css("cursor","ns-resize"):this.__elementTemplateRoot.css("cursor","")}else if(this.__triggerWindowPosition===TriggerWindowPosition.Bottom){let heightBeforeTriggerWindow=5+this.__elementMenuBar.outerHeight()+5+this.__elementChartings.outerHeight()+5+this.__elementLegend.outerHeight();y>=heightBeforeTriggerWindow&&y<=heightBeforeTriggerWindow+5?this.__elementTemplateRoot.css("cursor","ns-resize"):this.__elementTemplateRoot.css("cursor","")}}else this.__elementTemplateRoot.css("cursor","");if(this.__scopeGraphWindow&&this.__scopeGraphWindow.liveState)return;let target=event.target;if(target.className.includes("tchmi-chart-canvas-zooming")){let parentElement=target.parentElement;if(parentElement){let boundingRect=parentElement.getBoundingClientRect(),coords=this.__transformEventCoords(event.clientX,event.clientY),x=coords.x-boundingRect.left,y=coords.y-boundingRect.top,index=-1;if(parentElement===this.__elementOverview[0])return;index=Array.prototype.slice.call(this.__elementChartings.children(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-chart")).indexOf(parentElement);let scopeLayout=this.__scopeLayout.charts[index];if(-1!==index&&!isDigitalChartLayout(scopeLayout)&&x>=scopeLayout.canvas.position.x&&x<=scopeLayout.canvas.position.x+scopeLayout.canvas.dimensions.width&&y>=scopeLayout.canvas.position.y&&y<=scopeLayout.canvas.position.y+scopeLayout.canvas.dimensions.height){if(this.__scopeGraphData&&this.__scopeGraphData.charts){let scopeData=this.__scopeGraphData.charts[index];if(scopeData&&!isDigitalChartData(scopeData)&&scopeData.trigger){if(scopeData.trigger.find(t=>!t.locked&&x>=t.position.x-t.delta&&x<=t.position.x+t.delta))return void this.__elementChartings.css("cursor","pointer")}if(this.__scopeLayout.showTooltip)for(let i=0,ii=this.__scopeGraphData.charts.length;i<ii;i++)if(i===index){let scopeData=this.__scopeGraphData.charts[i];if(scopeData&&!isDigitalChartData(scopeData)&&scopeData.graphs)for(let key in scopeData.graphs){let graph=scopeData.graphs[key];if(graph){let tooltipDelta=graph.tooltipDelta,axesData=graph.axesData;if(axesData){if(axesData.filter(item=>x>=item.x-tooltipDelta&&x<=item.x+tooltipDelta&&y>=item.y-tooltipDelta&&y<=item.y+tooltipDelta).length>0)return void this.__elementChartings.css("cursor","pointer")}}}}}if(this.__mouseMode===MouseMode.ZoomXY)return void this.__elementChartings.css("cursor","crosshair");if(this.__mouseMode===MouseMode.ZoomY)return void this.__elementChartings.css("cursor","crosshair");if(this.__mouseMode===MouseMode.ZoomX)return void this.__elementChartings.css("cursor","crosshair");if(this.__mouseMode===MouseMode.PanXY)return void this.__elementChartings.css("cursor","move");if(this.__mouseMode===MouseMode.PanY)return void this.__elementChartings.css("cursor","ns-resize");if(this.__mouseMode===MouseMode.PanX)return void this.__elementChartings.css("cursor","ew-resize")}}}}}__onMouseMoveOverview(event){if(!this.__overviewRectangle)return void this.__elementOverview.css("cursor","");let coords=this.__transformEventCoords(event.offsetX,event.offsetY);if(coords.x>=this.__overviewRectangle.position.x-3&&coords.x<=this.__overviewRectangle.position.x+3&&coords.y>=this.__overviewRectangle.position.y&&coords.y<=this.__overviewRectangle.position.y+this.__overviewRectangle.dimensions.height)this.__elementOverview.css("cursor","ew-resize");else if(coords.x>=this.__overviewRectangle.position.x+this.__overviewRectangle.dimensions.width-3&&coords.x<=this.__overviewRectangle.position.x+this.__overviewRectangle.dimensions.width+3&&coords.y>=this.__overviewRectangle.position.y&&coords.y<=this.__overviewRectangle.position.y+this.__overviewRectangle.dimensions.height)this.__elementOverview.css("cursor","ew-resize");else if(coords.x>=this.__overviewRectangle.position.x+3&&coords.x<=this.__overviewRectangle.position.x+this.__overviewRectangle.dimensions.width-3&&coords.y>=this.__overviewRectangle.position.y&&coords.y<=this.__overviewRectangle.position.y+this.__overviewRectangle.dimensions.height)this.__elementOverview.css("cursor","move");else{if(this.__scopeGraphData&&this.__scopeGraphData.overview&&this.__scopeGraphData.overview.trigger)for(let i=0,ii=this.__scopeGraphData.overview.trigger.length;i<ii;i++)if(0===this.__scopeGraphData.overview.trigger[i].dimensions.width&&coords.x>=this.__scopeGraphData.overview.trigger[i].position.x-5&&coords.x<=this.__scopeGraphData.overview.trigger[i].position.x+5)return void this.__elementOverview.css("cursor","pointer");this.__elementOverview.css("cursor","")}}__onMouseUpOverview(event){if(!this.__manipulationInfo.isManipulating&&this.__scopeGraphWindow&&!this.__scopeGraphWindow.liveState&&this.__scopeGraphData&&this.__scopeGraphData.overview&&this.__scopeGraphData.overview.trigger){let coords=this.__transformEventCoords(event.offsetX,event.offsetY);for(let i=0,ii=this.__scopeGraphData.overview.trigger.length;i<ii;i++)if(0===this.__scopeGraphData.overview.trigger[i].dimensions.width&&coords.x>=this.__scopeGraphData.overview.trigger[i].position.x-5&&coords.x<=this.__scopeGraphData.overview.trigger[i].position.x+5){let scopeConfig=this.__scopeConfig;this.__scopeConfigToFile&&(scopeConfig=this.__scopeConfigToFile);let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".ClickOverviewElement",writeValue:{controlName:this.__id,scopeConfig,clickPoint:{x:coords.x,y:coords.y}}}]};this.__loadingSpinner&&this.__elementLoading[0].appendChild(this.__loadingSpinner),this.__enableOrDisableMenuControls("Disable",!1,!1,!1,ChartType.YT),TcHmi.Server.releaseRequest(this.__requestIds.clickOverviewElement),this.__requestIds.clickOverviewElement=TcHmi.Server.requestEx(request,{parallel:!0},this.__getDataCallback)}}}__onMouseUp(_event){this.__manipulationInfo.isManipulating&&this.__userInteractionEnd()}__onMouseWheel(event){if(this.__manipulationInfo.isManipulating||this.__multitouchInfo.multitouchMode)return;if(null!==this.__requestIds.wheel)return;event.preventDefault();let boundingRect=event.target.getBoundingClientRect(),coords=this.__transformEventCoords(event.clientX,event.clientY,event.target),parentElement=event.currentTarget.parentElement;if(parentElement){let index=-1;if(parentElement!==this.__elementOverview[0]&&(index=Array.prototype.slice.call(this.__elementChartings.children(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-chart")).indexOf(parentElement)),this.__scopeLayout&&index>-1){let x=coords.x-boundingRect.left,y=coords.y-boundingRect.top,scopeLayout=this.__scopeLayout.charts[index];if(!isDigitalChartLayout(scopeLayout)&&x>=scopeLayout.canvas.position.x&&x<=scopeLayout.canvas.position.x+scopeLayout.canvas.dimensions.width&&y>=scopeLayout.canvas.position.y&&y<=scopeLayout.canvas.position.y+scopeLayout.canvas.dimensions.height){let delta;switch(this.__wheelInfo.isWheeling=!0,this.__wheelInfo.mousePosition={x,y},event.deltaMode){case WheelEvent.DOM_DELTA_PAGE:delta=800*-event.deltaY;break;case WheelEvent.DOM_DELTA_LINE:delta=40*-event.deltaY;break;case WheelEvent.DOM_DELTA_PIXEL:default:delta=-event.deltaY}if(delta=Math.max(-1,Math.min(1,delta)),this.__wheelInfo.wheelSteps=this.__wheelInfo.wheelSteps+delta,this.__wheelInfo.timeout)return;this.__wheelInfo.timeout=setTimeout(()=>{if((null!==this.__subscriptionIds.dataLayoutAndWindow||this.__scopeConfigToFile)&&this.__mouseMode){let scopeConfig=this.__scopeConfig;this.__scopeConfigToFile&&(scopeConfig=this.__scopeConfigToFile);let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".Wheel",writeValue:{controlName:this.__id,scopeConfig,wheel:{chartIndex:index,delta:this.__wheelInfo.wheelSteps,mouseMode:MouseMode[this.__mouseMode],mousePosition:{x,y}}}}]};this.__loadingSpinner&&this.__elementLoading[0].appendChild(this.__loadingSpinner),this.__enableOrDisableMenuControls("Disable",!1,!1,!1,ChartType.YT),TcHmi.Server.releaseRequest(this.__requestIds.wheel),this.__requestIds.wheel=TcHmi.Server.requestEx(request,{parallel:!0},this.__getDataCallback)}this.__wheelInfo.timeout&&(clearTimeout(this.__wheelInfo.timeout),this.__wheelInfo.timeout=0),this.__wheelInfo={isWheeling:!1,wheelSteps:0,mousePosition:{x:0,y:0},timeout:0}},300)}}}}__onTouchStart(event){this.__tooltipTimeout&&(clearTimeout(this.__tooltipTimeout),this.__tooltipTimeout=null,this.__elementTooltip.css({visibility:"hidden",top:"0px",left:"0px"})),event.preventDefault(),this.__manipulationInfo={isManipulating:!1,start:{x:0,y:0},end:{x:0,y:0},offset:{left:0,top:0},transform:{x:0,y:0},click:!0,mousePosition:{x:0,y:0},elementIndex:-1,isOverviewSizeChanged:!1,beginOverviewRectChanging:!0,chartSizeChanged:!1,resizeLineIndex:0,touchIdentifier:0,resizeTriggerWindow:!1,trigger:{move:!1,id:0}};let boundingRect=event.target.getBoundingClientRect(),touch=event.touches[0],coords=this.__transformEventCoords(touch.clientX,touch.clientY,event.target);if(this.__manipulationInfo.isManipulating)return;let parentElement=event.currentTarget.parentElement;if(parentElement){let index=-1;if(parentElement!==this.__elementOverview[0]&&(index=Array.prototype.slice.call(this.__elementChartings.children(".TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-chart")).indexOf(parentElement)),this.__scopeLayout){let x=coords.x-boundingRect.left,y=coords.y-boundingRect.top,scopeLayout=this.__scopeLayout.charts[index];if(!isDigitalChartLayout(scopeLayout)){if(this.__scopeLayout.showTooltip&&index>-1&&this.__scopeGraphWindow&&!this.__scopeGraphWindow.liveState&&this.__scopeGraphData&&this.__scopeGraphData.charts&&x>=scopeLayout.canvas.position.x&&x<=scopeLayout.canvas.position.x+scopeLayout.canvas.dimensions.width&&y>=scopeLayout.canvas.position.y&&y<=scopeLayout.canvas.position.y+scopeLayout.canvas.dimensions.height){let scopeData=this.__scopeGraphData.charts[index];if(scopeData&&!isDigitalChartData(scopeData)&&scopeData.trigger){let triggerToMove=scopeData.trigger.find(t=>!t.locked&&x>=t.position.x-t.delta&&x<=t.position.x+t.delta);if(triggerToMove)return this.__manipulationInfo.trigger.move=!0,this.__manipulationInfo.trigger.id=triggerToMove.id,this.__manipulationInfo.offset.left=boundingRect.left,this.__manipulationInfo.offset.top=boundingRect.top,this.__manipulationInfo.mousePosition={x,y},void this.__userInteractionStart(x,y,index)}for(let i=0,ii=this.__scopeGraphData.charts.length;i<ii;i++)if(i===index){let scopeData=this.__scopeGraphData.charts[i];if(scopeData&&!isDigitalChartData(scopeData)&&scopeData.graphs)for(let key in scopeData.graphs){let graph=scopeData.graphs[key];if(graph){let tooltipDelta=graph.tooltipDelta;if(graph.axesData.filter(item=>x>=item.x-tooltipDelta&&x<=item.x+tooltipDelta&&y>=item.y-tooltipDelta&&y<=item.y+tooltipDelta).length>0){this.__manipulationInfo.isManipulating=!0,this.__manipulationInfo.offset.left=boundingRect.left,this.__manipulationInfo.offset.top=boundingRect.top,this.__manipulationInfo.mousePosition={x,y};let scopeConfig=this.__scopeConfig;this.__scopeConfigToFile&&(scopeConfig=this.__scopeConfigToFile);let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage","SendWriteValue"],symbol:this.__serverDomain+".GetTooltip",writeValue:{controlName:this.__id,scopeConfig,chartIndex:index,mousePosition:{x,y}}}]};return this.__loadingSpinner&&this.__elementLoading[0].appendChild(this.__loadingSpinner),this.__enableOrDisableMenuControls("Disable",!1,!1,!1,ChartType.YT),TcHmi.Server.releaseRequest(this.__requestIds.getTooltip),void(this.__requestIds.getTooltip=TcHmi.Server.requestEx(request,{timeout:1e4},this.__getDataCallback))}}}}}if(-1===index)this.__scopeLayout.overview&&x>=this.__scopeLayout.overview.canvas.position.x&&x<=this.__scopeLayout.overview.canvas.position.x+this.__scopeLayout.overview.canvas.dimensions.width&&y>=this.__scopeLayout.overview.canvas.position.y&&y<=this.__scopeLayout.overview.canvas.position.y+this.__scopeLayout.overview.canvas.dimensions.height&&(this.__manipulationInfo.isManipulating=!0,this.__manipulationInfo.offset.left=boundingRect.left,this.__manipulationInfo.offset.top=boundingRect.top,this.__manipulationInfo.mousePosition={x,y},this.__userInteractionStart(x,y,index));else{if(this.__scopeGraphWindow&&this.__scopeGraphWindow.liveState)return;x>=scopeLayout.canvas.position.x&&x<=scopeLayout.canvas.position.x+scopeLayout.canvas.dimensions.width&&y>=scopeLayout.canvas.position.y&&y<=scopeLayout.canvas.position.y+scopeLayout.canvas.dimensions.height&&(this.__manipulationInfo.isManipulating=!0,this.__manipulationInfo.offset.left=boundingRect.left,this.__manipulationInfo.offset.top=boundingRect.top,this.__manipulationInfo.mousePosition={x,y},this.__userInteractionStart(x,y,index))}}}}}__onTouchMove(event){if(!this.__manipulationInfo.isManipulating)return;let touch=event.touches[0],coords=this.__transformEventCoords(touch.clientX,touch.clientY),x=coords.x-this.__manipulationInfo.offset.left,y=coords.y-this.__manipulationInfo.offset.top;Math.sqrt(Math.pow(this.__manipulationInfo.mousePosition.x-x,2)+Math.pow(this.__manipulationInfo.mousePosition.y-y,2))>5&&this.__userInteractionMove(x,y)}__onTouchEnd(event){if(!this.__manipulationInfo.isManipulating)return;let touch=event.changedTouches[0],coords=this.__transformEventCoords(touch.clientX,touch.clientY),x=coords.x-this.__manipulationInfo.offset.left,y=coords.y-this.__manipulationInfo.offset.top;Math.sqrt(Math.pow(this.__manipulationInfo.mousePosition.x-x,2)+Math.pow(this.__manipulationInfo.mousePosition.y-y,2))>5?this.__userInteractionEnd():this.__manipulationInfo={isManipulating:!1,start:{x:0,y:0},end:{x:0,y:0},offset:{left:0,top:0},transform:{x:0,y:0},click:!0,mousePosition:{x:0,y:0},elementIndex:-1,isOverviewSizeChanged:!1,beginOverviewRectChanging:!0,chartSizeChanged:!1,resizeLineIndex:0,touchIdentifier:0,resizeTriggerWindow:!1,trigger:{move:!1,id:0}}}__userInteractionStart(x,y,position){if(this.__scopeLayout)if(-1===position){if(this.__scopeLayout.overview&&this.__scopeGraphWindow&&this.__scopeGraphWindow.overviewRect){if(x<this.__scopeLayout.overview.canvas.position.x+this.__scopeGraphWindow.overviewRect.position.x-3||x>this.__scopeLayout.overview.canvas.position.x+this.__scopeGraphWindow.overviewRect.position.x+this.__scopeGraphWindow.overviewRect.dimensions.width+3||y<this.__scopeLayout.overview.canvas.position.y||y>this.__scopeLayout.overview.canvas.position.y+this.__scopeGraphWindow.overviewRect.dimensions.height)return void(this.__manipulationInfo={isManipulating:!1,start:{x:0,y:0},end:{x:0,y:0},offset:{left:0,top:0},transform:{x:0,y:0},click:!0,mousePosition:{x:0,y:0},elementIndex:-1,isOverviewSizeChanged:!1,beginOverviewRectChanging:!0,chartSizeChanged:!1,resizeLineIndex:0,touchIdentifier:0,resizeTriggerWindow:!1,trigger:{move:!1,id:0}});x>=this.__scopeLayout.overview.canvas.position.x+this.__scopeGraphWindow.overviewRect.position.x-3&&x<=this.__scopeLayout.overview.canvas.position.x+this.__scopeGraphWindow.overviewRect.position.x+3?(this.__manipulationInfo.isOverviewSizeChanged=!0,this.__manipulationInfo.beginOverviewRectChanging=!0):x>=this.__scopeLayout.overview.canvas.position.x+this.__scopeGraphWindow.overviewRect.position.x+this.__scopeGraphWindow.overviewRect.dimensions.width-3&&x<=this.__scopeLayout.overview.canvas.position.x+this.__scopeGraphWindow.overviewRect.position.x+this.__scopeGraphWindow.overviewRect.dimensions.width+3&&(this.__manipulationInfo.isOverviewSizeChanged=!0,this.__manipulationInfo.beginOverviewRectChanging=!1),this.__manipulationInfo.start.x=x,this.__manipulationInfo.start.y=y,this.__manipulationInfo.end.x=x,this.__manipulationInfo.end.y=y,this.__manipulationInfo.isManipulating=!0,this.__manipulationInfo.transform={x:0,y:0},this.__manipulationInfo.elementIndex=position}}else{let scopeLayout=this.__scopeLayout.charts[position];if(!isDigitalChartLayout(scopeLayout)){let offsetTop=scopeLayout.canvas.position.y,offsetLeft=scopeLayout.canvas.position.x,xLineWidth=scopeLayout.canvas.dimensions.width,yLineHeight=scopeLayout.canvas.dimensions.height;if(x<offsetLeft||x>offsetLeft+xLineWidth||y<offsetTop||y>offsetTop+yLineHeight)return;this.__mouseMode!==MouseMode.ZoomX&&this.__mouseMode!==MouseMode.ZoomXY&&this.__mouseMode!==MouseMode.ZoomY||(this.__manipulationInfo.start.x=x,this.__manipulationInfo.start.y=y,this.__manipulationInfo.end.x=x,this.__manipulationInfo.end.y=y,this.__mouseMode===MouseMode.ZoomX?(this.__manipulationInfo.start.y=offsetTop,this.__manipulationInfo.end.y=offsetTop):this.__mouseMode===MouseMode.ZoomY&&(this.__manipulationInfo.start.x=offsetLeft,this.__manipulationInfo.end.x=offsetLeft)),this.__mouseMode!==MouseMode.PanX&&this.__mouseMode!==MouseMode.PanXY&&this.__mouseMode!==MouseMode.PanY||(this.__manipulationInfo.start.x=x,this.__manipulationInfo.start.y=y,this.__manipulationInfo.end.x=x,this.__manipulationInfo.end.y=y),this.__manipulationInfo.isManipulating=!0,this.__manipulationInfo.transform={x:0,y:0},this.__manipulationInfo.elementIndex=position}}}__userInteractionMove(x,y){if(this.__manipulationInfo.chartSizeChanged){let dX=this.__manipulationInfo.end.x-this.__manipulationInfo.start.x,dY=this.__manipulationInfo.end.y-this.__manipulationInfo.start.y;const canvasBorderElem=this.__elementBorder[0];let contextBorderElem=canvasBorderElem.getContext("2d");if(contextBorderElem&&this.__scopeLayout){if(contextBorderElem.clearRect(0,0,canvasBorderElem.width,canvasBorderElem.height),-1===this.__resizeLines[this.__manipulationInfo.resizeLineIndex].chartIndex){this.__themeChartForegroundColor&&this.__chartChartColorSource===ChartColorSource.Theme?contextBorderElem.strokeStyle=this.__themeChartForegroundColor:contextBorderElem.strokeStyle=this.__scopeLayout.foregroundColor,contextBorderElem.lineWidth=2,contextBorderElem.beginPath();let i=this.__manipulationInfo.resizeLineIndex;if(this.__scopeLayout.overview){let overviewElemHeight=this.__scopeLayout.overview.dimensions.height+dY,overviewMinHeight=this.__scopeLayout.overview.preferredSize.height,positionFromFirstChart=(this.__chartingElements.length,this.__chartingElements[0].position().top),chartsElemHeight=canvasBorderElem.height-positionFromFirstChart-dY,chartsMinHeight=10,newdY=overviewElemHeight>=overviewMinHeight?dY:overviewMinHeight-this.__scopeLayout.overview.dimensions.height;newdY=chartsElemHeight>=chartsMinHeight?newdY:canvasBorderElem.height-chartsMinHeight-positionFromFirstChart,contextBorderElem.moveTo(this.__resizeLines[i].startPoint.x,this.__resizeLines[i].startPoint.y+newdY),contextBorderElem.lineTo(this.__resizeLines[i].endPoint.x,this.__resizeLines[i].endPoint.y+newdY),contextBorderElem.stroke()}}this.__themeChartForegroundColor&&this.__chartChartColorSource===ChartColorSource.Theme?contextBorderElem.strokeStyle=this.__themeChartForegroundColor:contextBorderElem.strokeStyle=this.__scopeLayout.foregroundColor,contextBorderElem.lineWidth=1,contextBorderElem.beginPath();for(let i=0,ii=this.__resizeLines.length;i<ii;i++)if(-1!==this.__resizeLines[i].chartIndex)if(i===this.__manipulationInfo.resizeLineIndex)if(ChartType[this.__scopeLayout.chartType]===ChartType.SingleBarChart)if(this.__resizeLines[i].orientation===Orientation.Horizontal){let resizeLineUnderIndex=this.__resizeLines.slice(0,this.__manipulationInfo.resizeLineIndex),searchedOrientation=this.__resizeLines[this.__manipulationInfo.resizeLineIndex].orientation,allFoundedOrientation=resizeLineUnderIndex.filter(elem=>elem.orientation===searchedOrientation),indexOfFirstElem=this.__manipulationInfo.elementIndex;0===allFoundedOrientation.length?indexOfFirstElem-=1:indexOfFirstElem=allFoundedOrientation[allFoundedOrientation.length-1].chartIndex;let firstElems=this.__scopeLayout.charts.filter(elem=>elem.position.y===this.__scopeLayout.charts[this.__manipulationInfo.elementIndex].position.y-this.__scopeLayout.charts[indexOfFirstElem].dimensions.height),secondElems=this.__scopeLayout.charts.filter(elem=>elem.position.y===this.__scopeLayout.charts[this.__manipulationInfo.elementIndex].position.y),firstElemMinHeight=null;for(let j=0,jj=firstElems.length;j<jj;j++){let firstElem=firstElems[j];isDigitalChartLayout(firstElem)||(null!==firstElemMinHeight?firstElem.preferredSize.height>firstElemMinHeight&&(firstElemMinHeight=firstElem.preferredSize.height):firstElemMinHeight=firstElem.preferredSize.height)}null===firstElemMinHeight&&(firstElemMinHeight=0);let secondElemMinHeight=null;for(let k=0,kk=secondElems.length;k<kk;k++){let secondElem=secondElems[k];isDigitalChartLayout(secondElem)||(null!==secondElemMinHeight?secondElem.preferredSize.height>secondElemMinHeight&&(secondElemMinHeight=secondElem.preferredSize.height):secondElemMinHeight=secondElem.preferredSize.height)}null===secondElemMinHeight&&(secondElemMinHeight=0);let newDY=firstElems[0].dimensions.height+dY>=firstElemMinHeight?dY:firstElemMinHeight-firstElems[0].dimensions.height;secondElems.length>0&&(newDY=secondElems[0].dimensions.height-dY>=secondElemMinHeight?newDY:secondElems[0].dimensions.height-secondElemMinHeight),contextBorderElem.moveTo(this.__resizeLines[i].startPoint.x,this.__resizeLines[i].startPoint.y+newDY),contextBorderElem.lineTo(this.__resizeLines[i].endPoint.x,this.__resizeLines[i].endPoint.y+newDY)}else{let firstElems=this.__scopeLayout.charts.filter(elem=>elem.position.x===this.__scopeLayout.charts[this.__manipulationInfo.elementIndex].position.x),secondElems=this.__scopeLayout.charts.filter(elem=>elem.position.x===this.__scopeLayout.charts[this.__manipulationInfo.elementIndex].position.x+this.__scopeLayout.charts[this.__manipulationInfo.elementIndex].dimensions.width),firstElemMinWidth=null;for(let j=0,jj=firstElems.length;j<jj;j++){let firstElem=secondElems[j];isDigitalChartLayout(firstElem)||(null!==firstElemMinWidth?firstElem.preferredSize.width>firstElemMinWidth&&(firstElemMinWidth=firstElem.preferredSize.width):firstElemMinWidth=firstElem.preferredSize.width)}null===firstElemMinWidth&&(firstElemMinWidth=0);let secondElemMinWidth=null;for(let k=0,kk=secondElems.length;k<kk;k++){let secondElem=secondElems[k];isDigitalChartLayout(secondElem)||(null!==secondElemMinWidth?secondElem.preferredSize.width>secondElemMinWidth&&(secondElemMinWidth=secondElem.preferredSize.width):secondElemMinWidth=secondElem.preferredSize.width)}null===secondElemMinWidth&&(secondElemMinWidth=0);let newDX=firstElems[0].dimensions.width+dX>=firstElemMinWidth?dX:firstElemMinWidth-firstElems[0].dimensions.width;if(secondElems.length>0)newDX=secondElems[0].dimensions.width-dX>=secondElemMinWidth?newDX:secondElems[0].dimensions.width-secondElemMinWidth;else{let elemEndPosition=firstElems[0].position.x+firstElems[0].dimensions.width;elemEndPosition+newDX>this.__scopeLayout.dimensions.width&&(newDX=this.__scopeLayout.dimensions.width-elemEndPosition)}contextBorderElem.moveTo(this.__resizeLines[i].startPoint.x+newDX,this.__resizeLines[i].startPoint.y),contextBorderElem.lineTo(this.__resizeLines[i].endPoint.x+newDX,this.__resizeLines[i].endPoint.y)}else{let scopeLayoutFirst=this.__scopeLayout.charts[this.__manipulationInfo.elementIndex-1],scopeLayoutSecond=this.__scopeLayout.charts[this.__manipulationInfo.elementIndex];if(!isDigitalChartLayout(scopeLayoutFirst)&&!isDigitalChartLayout(scopeLayoutSecond)){let firstElemHeight=scopeLayoutFirst.dimensions.height+dY,secondElemHeight=scopeLayoutSecond.dimensions.height-dY;if(this.__resizeLines[i].orientation===Orientation.Horizontal){let firstElemMinHeight=scopeLayoutFirst.preferredSize.height,secondElemMinHeight=scopeLayoutSecond.preferredSize.height,newDY=firstElemHeight>=firstElemMinHeight?dY:firstElemMinHeight-scopeLayoutFirst.dimensions.height;newDY=secondElemHeight>=secondElemMinHeight?newDY:scopeLayoutSecond.dimensions.height-secondElemMinHeight,contextBorderElem.moveTo(this.__resizeLines[i].startPoint.x,this.__resizeLines[i].startPoint.y+newDY),contextBorderElem.lineTo(this.__resizeLines[i].endPoint.x,this.__resizeLines[i].endPoint.y+newDY)}}}else contextBorderElem.moveTo(this.__resizeLines[i].startPoint.x,this.__resizeLines[i].startPoint.y),contextBorderElem.lineTo(this.__resizeLines[i].endPoint.x,this.__resizeLines[i].endPoint.y);contextBorderElem.stroke()}}else if(this.__manipulationInfo.resizeTriggerWindow){if(this.__triggerWindowPosition===TriggerWindowPosition.Left){let diff=x-this.__manipulationInfo.start.x,triggerWindowWidth=this.__elementTriggerWindow.outerWidth();this.__elementTemplateRoot.css({"grid-template-columns":triggerWindowWidth+diff+"px auto"}),this.__manipulationInfo.start={x,y}}else if(this.__triggerWindowPosition===TriggerWindowPosition.Right){let diff=x-this.__manipulationInfo.start.x,triggerWindowWidth=this.__elementTriggerWindow.outerWidth();this.__elementTemplateRoot.css({"grid-template-columns":"auto "+(triggerWindowWidth-diff)+"px"}),this.__manipulationInfo.start={x,y}}else if(this.__triggerWindowPosition===TriggerWindowPosition.Top){let diff=y-this.__manipulationInfo.start.y,triggerWindowHeight=this.__elementTriggerWindow.outerHeight();this.__elementTemplateRoot.css({"grid-template-rows":triggerWindowHeight+diff+"px min-content auto min-content"}),this.__manipulationInfo.start={x,y}}else if(this.__triggerWindowPosition===TriggerWindowPosition.Bottom){let diff=y-this.__manipulationInfo.start.y,triggerWindowHeight=this.__elementTriggerWindow.outerHeight();this.__elementTemplateRoot.css({"grid-template-rows":"min-content auto min-content "+(triggerWindowHeight-diff)+"px"}),this.__manipulationInfo.start={x,y}}}else if(-1===this.__manipulationInfo.elementIndex){if(!(this.__scopeGraphWindow&&this.__scopeGraphWindow.overviewRect&&this.__scopeLayout&&this.__scopeLayout.overview&&this.__overviewChart))return;let canvas=this.__overviewChart.getCanvasZooming(),context=canvas.getContext("2d");if(null===context)return;let canvasWidth=canvas.width/window.devicePixelRatio,canvasHeight=canvas.height/window.devicePixelRatio,width=x-this.__manipulationInfo.start.x;if(this.__manipulationInfo.isOverviewSizeChanged)if(this.__manipulationInfo.beginOverviewRectChanging){let newWidth=this.__scopeGraphWindow.overviewRect.dimensions.width-width;newWidth<5&&(newWidth=5),context.clearRect(0,0,canvasWidth,canvasHeight),context.fillStyle="rgba(51,153,255,0.3)",context.fillRect(this.__scopeLayout.overview.canvas.position.x+this.__scopeGraphWindow.overviewRect.position.x+width,this.__scopeLayout.overview.canvas.position.y,newWidth,this.__scopeGraphWindow.overviewRect.dimensions.height)}else{let newWidth=this.__scopeGraphWindow.overviewRect.dimensions.width+width;newWidth<5&&(newWidth=5),context.clearRect(0,0,canvasWidth,canvasHeight),context.fillStyle="rgba(51,153,255,0.3)",context.fillRect(this.__scopeLayout.overview.canvas.position.x+this.__scopeGraphWindow.overviewRect.position.x,this.__scopeLayout.overview.canvas.position.y,newWidth,this.__scopeGraphWindow.overviewRect.dimensions.height)}else context.clearRect(0,0,canvasWidth,canvasHeight),context.fillStyle="rgba(51,153,255,0.3)",context.fillRect(this.__scopeLayout.overview.canvas.position.x+this.__scopeGraphWindow.overviewRect.position.x+width,this.__scopeLayout.overview.canvas.position.y,this.__scopeGraphWindow.overviewRect.dimensions.width,this.__scopeGraphWindow.overviewRect.dimensions.height)}else if(this.__manipulationInfo.trigger.move){let dX=x-this.__manipulationInfo.end.x,position=this.__manipulationInfo.elementIndex;if(this.__scopeGraphData&&this.__scopeLayout){let scopeData=this.__scopeGraphData.charts[position];if(scopeData&&!isDigitalChartData(scopeData)&&scopeData.trigger){let dataTrigger=scopeData.trigger.find(t=>t.id===this.__manipulationInfo.trigger.id);if(void 0===dataTrigger)return;for(let i=0,ii=this.__scopeGraphData.charts.length;i<ii;i++){let lineChart=this.__iCharts[i],scopeLayout=this.__scopeLayout.charts[i],canvas=lineChart.getCanvasMarker(),context=canvas.getContext("2d");if(!lineChart||null===context||isDigitalChartLayout(scopeLayout))return;let canvasWidth=canvas.width/window.devicePixelRatio,canvasHeight=canvas.height/window.devicePixelRatio,offsetLeft=scopeLayout.gridSize.position.x,xLineWidth=scopeLayout.gridSize.dimensions.width;context.clearRect(0,0,canvasWidth,canvasHeight);let chart=this.__scopeGraphData.charts[i];if(!isDigitalChartData(chart)){let findT=chart.trigger.find(t=>t.group===dataTrigger.group);if(findT){let indexTrigger=chart.trigger.indexOf(findT);if(-1===indexTrigger)return;let newValue=findT.position.x+dX,newX=newValue<offsetLeft?offsetLeft:newValue>offsetLeft+xLineWidth?offsetLeft+xLineWidth:newValue,newDiff=findT.position.x-newX;findT.position.x=newX,findT.icon&&(findT.icon.position.x-=newDiff),findT.text&&(findT.text.position.x-=newDiff),lineChart.getTriggerAtPosition(indexTrigger).setTriggerData(findT),lineChart.drawTrigger()}}}this.__manipulationInfo.transform.x=this.__manipulationInfo.transform.x+dX}}}else if(this.__scopeLayout&&this.__iCharts){let position=this.__manipulationInfo.elementIndex,lineChart=this.__iCharts[position],scopeLayout=this.__scopeLayout.charts[position];if(lineChart&&!isDigitalChartLayout(scopeLayout)&&lineChart instanceof ScopeChart){let canvas=lineChart.getCanvasZooming(),context=canvas.getContext("2d"),canvasWidth=canvas.width/window.devicePixelRatio,canvasHeight=canvas.height/window.devicePixelRatio,offsetTop=scopeLayout.canvas.position.y,offsetLeft=scopeLayout.canvas.position.x,xLineWidth=scopeLayout.canvas.dimensions.width,yLineHeight=scopeLayout.canvas.dimensions.height;if(this.__mouseMode===MouseMode.ZoomX||this.__mouseMode===MouseMode.ZoomXY||this.__mouseMode===MouseMode.ZoomY){if(null===context)return;let width=x-this.__manipulationInfo.start.x,height=0;this.__mouseMode===MouseMode.ZoomX?height=yLineHeight:this.__mouseMode===MouseMode.ZoomY?(width=xLineWidth,height=y-this.__manipulationInfo.start.y):height=y-this.__manipulationInfo.start.y,context.clearRect(0,0,canvasWidth,canvasHeight),context.beginPath(),context.rect(this.__manipulationInfo.start.x,this.__manipulationInfo.start.y,width,height),context.fillStyle="rgba(51,153,255,0.3)",context.fill(),context.clearRect(0,0,canvasWidth,offsetTop),context.clearRect(0,0,offsetLeft,canvasHeight),context.clearRect(0,canvasHeight,canvasWidth,-(canvasHeight-yLineHeight-offsetTop)),context.clearRect(canvasWidth,0,-(canvasWidth-offsetLeft-xLineWidth),canvasHeight)}if(this.__mouseMode===MouseMode.PanX||this.__mouseMode===MouseMode.PanXY||this.__mouseMode===MouseMode.PanY){let dX=x-this.__manipulationInfo.end.x,dY=y-this.__manipulationInfo.end.y,drawingCanvas=lineChart.getCanvasDrawing();if(drawingCanvas){let drawingContext=drawingCanvas.getContext("2d");if(null===context||null===drawingContext)return;let canvasWidth=drawingCanvas.width/window.devicePixelRatio,canvasHeight=drawingCanvas.height/window.devicePixelRatio;drawingContext.clearRect(0,0,canvasWidth,canvasHeight),drawingContext.setTransform(1,0,0,1,0,0);let deviceDPI=window.devicePixelRatio;drawingContext.scale(deviceDPI,deviceDPI),this.__mouseMode===MouseMode.PanXY?(drawingContext.translate(this.__manipulationInfo.transform.x+dX,this.__manipulationInfo.transform.y+dY),this.__manipulationInfo.transform={x:this.__manipulationInfo.transform.x+dX,y:this.__manipulationInfo.transform.y+dY}):this.__mouseMode===MouseMode.PanY?(drawingContext.translate(0,this.__manipulationInfo.transform.y+dY),this.__manipulationInfo.transform.y=this.__manipulationInfo.transform.y+dY):(drawingContext.translate(this.__manipulationInfo.transform.x+dX,0),this.__manipulationInfo.transform.x=this.__manipulationInfo.transform.x+dX),lineChart.setLineChanged(!0),this.__chartChartColorSource===ChartColorSource.ScopeConfig?lineChart.draw(scopeLayout,null):lineChart.draw(scopeLayout,this.__themeCanvasBackgroundColor)}}}}this.__manipulationInfo.end.x=x,this.__manipulationInfo.end.y=y}__userInteractionEnd(){if(this.__manipulationInfo.chartSizeChanged){if(this.__scopeLayout)if(-1===this.__manipulationInfo.elementIndex){const canvasBorderElem=this.__elementBorder[0];if(this.__scopeLayout.overview&&canvasBorderElem){let diff=this.__manipulationInfo.end.y-this.__manipulationInfo.start.y,overviewElemHeight=this.__scopeLayout.overview.dimensions.height+diff,overviewMinHeight=this.__scopeLayout.overview.preferredSize.height,positionFromFirstChart=(this.__chartingElements.length,this.__chartingElements[0].position().top),chartsElemHeight=canvasBorderElem.height-positionFromFirstChart-diff,chartsMinHeight=10,newDiff=overviewElemHeight>=overviewMinHeight?diff:overviewMinHeight-this.__scopeLayout.overview.dimensions.height;if(newDiff=chartsElemHeight>=chartsMinHeight?newDiff:canvasBorderElem.height-chartsMinHeight-positionFromFirstChart,null!==this.__subscriptionIds.dataLayoutAndWindow||this.__scopeConfigToFile){let scopeConfig=this.__scopeConfig;this.__scopeConfigToFile&&(scopeConfig=this.__scopeConfigToFile);let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".ResizeCharts",writeValue:{controlName:this.__id,scopeConfig,resizeOverview:!0,charts:[{chartIndex:-1,width:this.__scopeLayout.overview.dimensions.width,height:this.__scopeLayout.overview.dimensions.height+newDiff}]}}]};this.__loadingSpinner&&this.__elementLoading[0].appendChild(this.__loadingSpinner),this.__enableOrDisableMenuControls("Disable",!1,!1,!1,ChartType.YT),TcHmi.Server.releaseRequest(this.__requestIds.resizeCharts),this.__requestIds.resizeCharts=TcHmi.Server.requestEx(request,{parallel:!0},this.__getDataCallback)}}}else if(ChartType[this.__scopeLayout.chartType]===ChartType.SingleBarChart)if(this.__resizeLines[this.__manipulationInfo.resizeLineIndex].orientation===Orientation.Horizontal){let diff=this.__manipulationInfo.end.y-this.__manipulationInfo.start.y,resizeLineUnderIndex=this.__resizeLines.slice(0,this.__manipulationInfo.resizeLineIndex),searchedOrientation=this.__resizeLines[this.__manipulationInfo.resizeLineIndex].orientation,allFoundedOrientation=resizeLineUnderIndex.filter(elem=>elem.orientation===searchedOrientation),indexOfFirstElem=this.__manipulationInfo.elementIndex;0===allFoundedOrientation.length?indexOfFirstElem-=1:indexOfFirstElem=allFoundedOrientation[allFoundedOrientation.length-1].chartIndex;let firstElemsWithIndex=[],firstElems=this.__scopeLayout.charts.filter((elem,index)=>elem.position.y===this.__scopeLayout.charts[this.__manipulationInfo.elementIndex].position.y-this.__scopeLayout.charts[indexOfFirstElem].dimensions.height&&!isDigitalChartLayout(elem)&&(firstElemsWithIndex.push({elem,index}),!0)),secondElemsWithIndex=[],secondElems=this.__scopeLayout.charts.filter((elem,index)=>elem.position.y===this.__scopeLayout.charts[this.__manipulationInfo.elementIndex].position.y&&!isDigitalChartLayout(elem)&&(secondElemsWithIndex.push({elem,index}),!0)),firstElemMinHeight=null;for(let j=0,jj=firstElems.length;j<jj;j++)null!==firstElemMinHeight?firstElems[j].preferredSize.height>firstElemMinHeight&&(firstElemMinHeight=firstElems[j].preferredSize.height):firstElemMinHeight=firstElems[j].preferredSize.height;null===firstElemMinHeight&&(firstElemMinHeight=0);let secondElemMinHeight=null;for(let k=0,kk=secondElems.length;k<kk;k++)null!==secondElemMinHeight?secondElems[k].preferredSize.height>secondElemMinHeight&&(secondElemMinHeight=secondElems[k].preferredSize.height):secondElemMinHeight=secondElems[k].preferredSize.height;null===secondElemMinHeight&&(secondElemMinHeight=0);let newDiff=firstElems[0].dimensions.height+diff>=firstElemMinHeight?diff:firstElemMinHeight-firstElems[0].dimensions.height;if(secondElems.length>0&&(newDiff=secondElems[0].dimensions.height-diff>=secondElemMinHeight?newDiff:secondElems[0].dimensions.height-secondElemMinHeight),0!==newDiff){let charts=[];for(let i=0,ii=firstElemsWithIndex.length;i<ii;i++){let index=firstElemsWithIndex[i].index;charts.push({chartIndex:index,width:this.__scopeLayout.charts[index].dimensions.width,height:this.__scopeLayout.charts[index].dimensions.height+newDiff})}for(let l=0,ll=secondElems.length;l<ll;l++){let index=secondElemsWithIndex[l].index;charts.push({chartIndex:index,width:this.__scopeLayout.charts[index].dimensions.width,height:this.__scopeLayout.charts[index].dimensions.height-newDiff})}if(null!==this.__subscriptionIds.dataLayoutAndWindow||this.__scopeConfigToFile){let scopeConfig=this.__scopeConfig;this.__scopeConfigToFile&&(scopeConfig=this.__scopeConfigToFile);let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".ResizeCharts",writeValue:{controlName:this.__id,scopeConfig,resizeOverview:!1,charts}}]};this.__loadingSpinner&&this.__elementLoading[0].appendChild(this.__loadingSpinner),this.__enableOrDisableMenuControls("Disable",!1,!1,!1,ChartType.YT),TcHmi.Server.releaseRequest(this.__requestIds.resizeCharts),this.__requestIds.resizeCharts=TcHmi.Server.requestEx(request,{parallel:!0},this.__getDataCallback)}}}else{let diff=this.__manipulationInfo.end.x-this.__manipulationInfo.start.x,firstElemsWithIndex=[],firstElems=this.__scopeLayout.charts.filter((elem,index)=>elem.position.x===this.__scopeLayout.charts[this.__manipulationInfo.elementIndex].position.x&&!isDigitalChartLayout(elem)&&(firstElemsWithIndex.push({elem,index}),!0)),secondElemsWithIndex=[],secondElems=this.__scopeLayout.charts.filter((elem,index)=>elem.position.x===this.__scopeLayout.charts[this.__manipulationInfo.elementIndex].position.x+this.__scopeLayout.charts[this.__manipulationInfo.elementIndex].dimensions.width&&!isDigitalChartLayout(elem)&&(secondElemsWithIndex.push({elem,index}),!0)),firstElemMinWidth=null;for(let j=0,jj=firstElems.length;j<jj;j++)null!==firstElemMinWidth?firstElems[j].preferredSize.width>firstElemMinWidth&&(firstElemMinWidth=firstElems[j].preferredSize.width):firstElemMinWidth=firstElems[j].preferredSize.width;null===firstElemMinWidth&&(firstElemMinWidth=0);let secondElemMinWidth=null;for(let k=0,kk=secondElems.length;k<kk;k++)null!==secondElemMinWidth?secondElems[k].preferredSize.width>secondElemMinWidth&&(secondElemMinWidth=secondElems[k].preferredSize.width):secondElemMinWidth=secondElems[k].preferredSize.width;null===secondElemMinWidth&&(secondElemMinWidth=0);let newDiff=firstElems[0].dimensions.width+diff>=firstElemMinWidth?diff:firstElemMinWidth-firstElems[0].dimensions.width;if(secondElems.length>0)newDiff=secondElems[0].dimensions.width-diff>=secondElemMinWidth?newDiff:secondElems[0].dimensions.width-secondElemMinWidth;else{let elemEndPosition=firstElems[0].position.x+firstElems[0].dimensions.width;elemEndPosition+newDiff>this.__scopeLayout.dimensions.width&&(newDiff=this.__scopeLayout.dimensions.width-elemEndPosition)}if(0!==newDiff){let charts=[];for(let i=0,ii=firstElemsWithIndex.length;i<ii;i++){let index=firstElemsWithIndex[i].index;charts.push({chartIndex:index,width:this.__scopeLayout.charts[index].dimensions.width+newDiff,height:this.__scopeLayout.charts[index].dimensions.height})}for(let l=0,ll=secondElemsWithIndex.length;l<ll;l++){let index=secondElemsWithIndex[l].index;charts.push({chartIndex:index,width:this.__scopeLayout.charts[index].dimensions.width-newDiff,height:this.__scopeLayout.charts[index].dimensions.height})}1===charts.length&&0===secondElems.length&&charts.push({chartIndex:0,width:this.__scopeLayout.charts[0].dimensions.width-newDiff,height:this.__scopeLayout.charts[0].dimensions.height});let scopeConfig=this.__scopeConfig;if(this.__scopeConfigToFile&&(scopeConfig=this.__scopeConfigToFile),null!==this.__subscriptionIds.dataLayoutAndWindow){let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".ResizeCharts",writeValue:{controlName:this.__id,scopeConfig,resizeOverview:!1,charts}}]};this.__loadingSpinner&&this.__elementLoading[0].appendChild(this.__loadingSpinner),this.__enableOrDisableMenuControls("Disable",!1,!1,!1,ChartType.YT),TcHmi.Server.releaseRequest(this.__requestIds.resizeCharts),this.__requestIds.resizeCharts=TcHmi.Server.requestEx(request,{parallel:!0},this.__getDataCallback)}}}else{let diff=this.__manipulationInfo.end.y-this.__manipulationInfo.start.y,firstElemHeight=this.__scopeLayout.charts[this.__manipulationInfo.elementIndex-1].dimensions.height+diff,secondElemHeight=this.__scopeLayout.charts[this.__manipulationInfo.elementIndex].dimensions.height-diff,firstElemMinHeight=isDigitalChartLayout(this.__scopeLayout.charts[this.__manipulationInfo.elementIndex-1])?this.__scopeLayout.charts[this.__manipulationInfo.elementIndex-1].preferredSize.height:0,secondElemMinHeight=isDigitalChartLayout(this.__scopeLayout.charts[this.__manipulationInfo.elementIndex])?this.__scopeLayout.charts[this.__manipulationInfo.elementIndex].preferredSize.height:0,newDiff=firstElemHeight>=firstElemMinHeight?diff:(isDigitalChartLayout(this.__scopeLayout.charts[this.__manipulationInfo.elementIndex-1])?this.__scopeLayout.charts[this.__manipulationInfo.elementIndex-1].preferredSize.height:0)-this.__scopeLayout.charts[this.__manipulationInfo.elementIndex-1].dimensions.height;if(newDiff=secondElemHeight>=secondElemMinHeight?newDiff:this.__scopeLayout.charts[this.__manipulationInfo.elementIndex].dimensions.height-(isDigitalChartLayout(this.__scopeLayout.charts[this.__manipulationInfo.elementIndex])?this.__scopeLayout.charts[this.__manipulationInfo.elementIndex].preferredSize.height:0),0!==newDiff&&(null!==this.__subscriptionIds.dataLayoutAndWindow||this.__scopeConfigToFile)){let scopeConfig=this.__scopeConfig;this.__scopeConfigToFile&&(scopeConfig=this.__scopeConfigToFile);let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".ResizeCharts",writeValue:{controlName:this.__id,scopeConfig,resizeOverview:!1,charts:[{chartIndex:this.__manipulationInfo.elementIndex-1,width:this.__scopeLayout.charts[this.__manipulationInfo.elementIndex-1].dimensions.width,height:this.__scopeLayout.charts[this.__manipulationInfo.elementIndex-1].dimensions.height+newDiff},{chartIndex:this.__manipulationInfo.elementIndex,width:this.__scopeLayout.charts[this.__manipulationInfo.elementIndex-1].dimensions.width,height:this.__scopeLayout.charts[this.__manipulationInfo.elementIndex].dimensions.height-newDiff}]}}]};this.__loadingSpinner&&this.__elementLoading[0].appendChild(this.__loadingSpinner),this.__enableOrDisableMenuControls("Disable",!1,!1,!1,ChartType.YT),TcHmi.Server.releaseRequest(this.__requestIds.resizeCharts),this.__requestIds.resizeCharts=TcHmi.Server.requestEx(request,{parallel:!0},this.__getDataCallback)}}}else if(this.__manipulationInfo.resizeTriggerWindow)this.__serverSymbolsHelper.setChartSize(!0);else if(-1===this.__manipulationInfo.elementIndex){if(this.__overviewChart){let width=this.__manipulationInfo.end.x-this.__manipulationInfo.start.x;if(this.__manipulationInfo.isOverviewSizeChanged){if((null!==this.__subscriptionIds.dataLayoutAndWindow||this.__scopeConfigToFile)&&this.__scopeGraphWindow&&this.__scopeGraphWindow.overviewRect)if(this.__manipulationInfo.beginOverviewRectChanging){let newWidth=this.__scopeGraphWindow.overviewRect.dimensions.width-width,xDirection=0;newWidth<5&&(newWidth=5,xDirection=width-this.__scopeGraphWindow.overviewRect.dimensions.width+5);let scopeConfig=this.__scopeConfig;this.__scopeConfigToFile&&(scopeConfig=this.__scopeConfigToFile);let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".SetOverviewRect",writeValue:{controlName:this.__id,scopeConfig,sizeChanged:{width:newWidth,changedAtBeginning:this.__manipulationInfo.beginOverviewRectChanging},xDirection}}]};this.__loadingSpinner&&this.__elementLoading[0].appendChild(this.__loadingSpinner),this.__enableOrDisableMenuControls("Disable",!1,!1,!1,ChartType.YT),TcHmi.Server.releaseRequest(this.__requestIds.setOverviewRect),this.__requestIds.setOverviewRect=TcHmi.Server.requestEx(request,{parallel:!0},this.__getDataCallback)}else{let newWidth=this.__scopeGraphWindow.overviewRect.dimensions.width+width;newWidth<5&&(newWidth=5);let scopeConfig=this.__scopeConfig;this.__scopeConfigToFile&&(scopeConfig=this.__scopeConfigToFile);let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".SetOverviewRect",writeValue:{controlName:this.__id,scopeConfig,sizeChanged:{width:newWidth,changedAtBeginning:this.__manipulationInfo.beginOverviewRectChanging}}}]};this.__loadingSpinner&&this.__elementLoading[0].appendChild(this.__loadingSpinner),this.__enableOrDisableMenuControls("Disable",!1,!1,!1,ChartType.YT),TcHmi.Server.releaseRequest(this.__requestIds.setOverviewRect),this.__requestIds.setOverviewRect=TcHmi.Server.requestEx(request,{parallel:!0},this.__getDataCallback)}}else if(null!==this.__subscriptionIds.dataLayoutAndWindow||this.__scopeConfigToFile){let scopeConfig=this.__scopeConfig;this.__scopeConfigToFile&&(scopeConfig=this.__scopeConfigToFile);let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".SetOverviewRect",writeValue:{controlName:this.__id,scopeConfig,xDirection:width}}]};this.__loadingSpinner&&this.__elementLoading[0].appendChild(this.__loadingSpinner),this.__enableOrDisableMenuControls("Disable",!1,!1,!1,ChartType.YT),TcHmi.Server.releaseRequest(this.__requestIds.setOverviewRect),this.__requestIds.setOverviewRect=TcHmi.Server.requestEx(request,{parallel:!0},this.__getDataCallback)}}}else if(this.__manipulationInfo.trigger.move){let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".MoveTrigger",writeValue:{controlName:this.__id,scopeConfig:null!==this.__scopeConfigToFile?this.__scopeConfigToFile:this.__scopeConfig,chartIndex:this.__manipulationInfo.elementIndex,startPoint:{x:this.__manipulationInfo.start.x,y:this.__manipulationInfo.start.y},endPoint:{x:this.__manipulationInfo.end.x,y:this.__manipulationInfo.end.y}}}]};this.__loadingSpinner&&this.__elementLoading[0].appendChild(this.__loadingSpinner),this.__enableOrDisableMenuControls("Disable",!1,!1,!1,ChartType.YT),TcHmi.Server.releaseRequest(this.__requestIds.zoom),this.__requestIds.moveTrigger=TcHmi.Server.requestEx(request,{parallel:!0},this.__getDataCallback)}else if(this.__scopeLayout&&this.__iCharts){let position=this.__manipulationInfo.elementIndex,lineChart=this.__iCharts[position];if(lineChart){if(this.__mouseMode===MouseMode.ZoomX||this.__mouseMode===MouseMode.ZoomXY||this.__mouseMode===MouseMode.ZoomY){let canvas=lineChart.getCanvasZooming(),context=canvas.getContext("2d"),canvasWidth=canvas.width/window.devicePixelRatio,canvasHeight=canvas.height/window.devicePixelRatio;if(context&&context.clearRect(0,0,canvasWidth,canvasHeight),null!==this.__subscriptionIds.dataLayoutAndWindow||this.__scopeConfigToFile){let scopeConfig=this.__scopeConfig;this.__scopeConfigToFile&&(scopeConfig=this.__scopeConfigToFile);let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".Zoom",writeValue:{controlName:this.__id,scopeConfig,zoom:{chartIndex:position,mouseMode:MouseMode[this.__mouseMode],startPoint:{x:this.__manipulationInfo.start.x,y:this.__manipulationInfo.start.y},endPoint:{x:this.__manipulationInfo.end.x,y:this.__manipulationInfo.end.y}}}}]};this.__loadingSpinner&&this.__elementLoading[0].appendChild(this.__loadingSpinner),this.__enableOrDisableMenuControls("Disable",!1,!1,!1,ChartType.YT),TcHmi.Server.releaseRequest(this.__requestIds.zoom),this.__requestIds.zoom=TcHmi.Server.requestEx(request,{parallel:!0},this.__getDataCallback)}}if(this.__mouseMode===MouseMode.PanX||this.__mouseMode===MouseMode.PanXY||this.__mouseMode===MouseMode.PanY){let canvas=lineChart.getCanvasDrawing();if(canvas){let context=canvas.getContext("2d");if(null!==context){context.setTransform(1,0,0,1,0,0);let deviceDPI=window.devicePixelRatio;context.scale(deviceDPI,deviceDPI)}}if(null!==this.__subscriptionIds.dataLayoutAndWindow||this.__scopeConfigToFile){let scopeConfig=this.__scopeConfig;this.__scopeConfigToFile&&(scopeConfig=this.__scopeConfigToFile);let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".Pan",writeValue:{controlName:this.__id,scopeConfig,pan:{chartIndex:position,mouseMode:MouseMode[this.__mouseMode],startPoint:{x:this.__manipulationInfo.start.x,y:this.__manipulationInfo.start.y},endPoint:{x:this.__manipulationInfo.end.x,y:this.__manipulationInfo.end.y}}}}]};this.__loadingSpinner&&this.__elementLoading[0].appendChild(this.__loadingSpinner),this.__enableOrDisableMenuControls("Disable",!1,!1,!1,ChartType.YT),TcHmi.Server.releaseRequest(this.__requestIds.pan),this.__requestIds.pan=TcHmi.Server.requestEx(request,{parallel:!0},this.__getDataCallback)}}}}this.__manipulationInfo={isManipulating:!1,start:{x:0,y:0},end:{x:0,y:0},offset:{left:0,top:0},transform:{x:0,y:0},click:!0,mousePosition:{x:0,y:0},elementIndex:-1,isOverviewSizeChanged:!1,beginOverviewRectChanging:!0,chartSizeChanged:!1,resizeLineIndex:0,touchIdentifier:0,resizeTriggerWindow:!1,trigger:{move:!1,id:0}}}__showTooltip(tooltipObj){if(!this.__scopeLayout||!this.__elementTooltip||!this.__elementMenuBar)return;this.__elementTooltip.css("visibility","visible"),this.__elementTooltipText[0].textContent=tooltipObj.displayText;let widthTooltip=this.__elementTooltip.outerWidth(),heightTooltip=this.__elementTooltip.outerHeight(),menubarHeight=this.__elementMenuBar.outerHeight()+5,chartPosition=this.__scopeLayout.charts[tooltipObj.chartIndex].position,overviewHeight=0;this.__showOverview&&this.__overviewChart&&(overviewHeight=this.__elementOverview.outerHeight());let triggerWindowHeight=0,triggerWindowWidth=0;if(this.__showTriggerWindow)if(this.__triggerWindowPosition===TriggerWindowPosition.Top){triggerWindowHeight=this.__elementTriggerWindow.outerHeight()+5}else if(this.__triggerWindowPosition===TriggerWindowPosition.Left){triggerWindowWidth=this.__elementTriggerWindow.outerWidth()+5}let middlePoint=chartPosition.x+tooltipObj.position.x-widthTooltip/2+5;tooltipObj.position.y+menubarHeight+triggerWindowHeight-heightTooltip+chartPosition.y-4>0?middlePoint>=0&&triggerWindowWidth+middlePoint+widthTooltip<=this.getRenderedWidth()?(this.__elementTooltipArrow.removeClass("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-top TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-bottom TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-left TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-right").addClass("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-bottom"),this.__elementTooltip.css({top:tooltipObj.position.y+menubarHeight+triggerWindowHeight-heightTooltip+chartPosition.y+overviewHeight-4,left:triggerWindowWidth+chartPosition.x+tooltipObj.position.x-widthTooltip/2+5})):triggerWindowWidth+tooltipObj.position.x+5+widthTooltip<=this.getRenderedWidth()?(this.__elementTooltipArrow.removeClass("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-top TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-bottom TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-left TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-right").addClass("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-left"),this.__elementTooltip.css({top:tooltipObj.position.y-heightTooltip/2+chartPosition.y+overviewHeight+menubarHeight+triggerWindowHeight+4,left:triggerWindowWidth+chartPosition.x+tooltipObj.position.x+4})):(this.__elementTooltipArrow.removeClass("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-top TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-bottom TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-left TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-right").addClass("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-right"),this.__elementTooltip.css({top:tooltipObj.position.y-heightTooltip/2+chartPosition.y+overviewHeight+menubarHeight+triggerWindowHeight+4,left:triggerWindowWidth+chartPosition.x+tooltipObj.position.x-widthTooltip-4})):middlePoint>=0&&triggerWindowWidth+middlePoint+widthTooltip<=this.getRenderedWidth()?(this.__elementTooltipArrow.removeClass("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-top TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-bottom TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-left TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-right").addClass("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-top"),this.__elementTooltip.css({top:tooltipObj.position.y+12+chartPosition.y+overviewHeight+menubarHeight+triggerWindowHeight,left:triggerWindowWidth+chartPosition.x+middlePoint})):triggerWindowWidth+tooltipObj.position.x+4+widthTooltip<=this.getRenderedWidth()?(this.__elementTooltipArrow.removeClass("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-top TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-bottom TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-left TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-right").addClass("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-left"),this.__elementTooltip.css({top:tooltipObj.position.y-heightTooltip/2+chartPosition.y+overviewHeight+menubarHeight+triggerWindowHeight+4,left:triggerWindowWidth+chartPosition.x+tooltipObj.position.x+4})):(this.__elementTooltipArrow.removeClass("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-top TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-bottom TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-left TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-right").addClass("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-tooltip-arrow-right"),this.__elementTooltip.css({top:tooltipObj.position.y-heightTooltip/2+chartPosition.y+overviewHeight+menubarHeight+triggerWindowHeight+4,left:chartPosition.x+tooltipObj.position.x-widthTooltip-4})),this.__tooltipTimeout=setTimeout(()=>{this.__elementTooltip.css({visibility:"hidden",top:"0px",left:"0px"})},__isoToMilliSec(tooltipObj.timeoutMS))}startRecord(recordTime){this.__serverSymbolsHelper.startRecord(recordTime)}stopRecord(){this.__serverSymbolsHelper.stopRecord()}startDisplay(){this.__serverSymbolsHelper.startDisplay()}stopDisplay(){this.__serverSymbolsHelper.stopDisplay()}zoomToDefault(){this.__serverSymbolsHelper.zoomToDefault()}zoomOutMax(){this.__serverSymbolsHelper.zoomOutMax()}goTo(goTo){this.__serverSymbolsHelper.goTo(goTo)}setDisplayWidth(displayWidth){this.__serverSymbolsHelper.setDisplayWidth(displayWidth)}scroll(direction){this.__serverSymbolsHelper.scroll(direction)}scrollBig(direction){this.__serverSymbolsHelper.scrollBig(direction)}undo(){this.__serverSymbolsHelper.undo()}redo(){this.__serverSymbolsHelper.redo()}setOverviewMode(){this.__serverSymbolsHelper.setOverviewMode()}setMouseMode(valueNew){this.__serverSymbolsHelper.setMouseMode(valueNew)}getMouseMode(){return this.__mouseMode===MouseMode.None?null:MouseMode[this.__mouseMode]}setScopeConfig(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ScopeConfig"));let resolverInfo=this.__objectResolvers.get("scopeConfig");resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy());let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue,{parentControl:this,type:this.getAttributeDescription("ScopeConfig")?.type});this.__objectResolvers.set("scopeConfig",{resolver,watchCallback:this.__onResolverForScopeConfigWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForScopeConfigWatchCallback)})}__onResolverForScopeConfigWatchCallback(data){!this.__isAttached&&data.destroy&&this.__suspendObjectResolver("scopeConfig"),data.error===TcHmi.Errors.NONE?tchmi_equal(data.value,this.__scopeConfig)||(this.__oldScopeConfig=this.__scopeConfig,this.__scopeConfig=data.value,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ScopeConfig"}),this.__processScopeConfig()):TcHmi.Log.Controls.error(this,TcHmiScopeControl.#tchmiFQN,{Attribute:"ScopeConfig"},`Resolving symbols from object failed with error: ${TcHmi.Log.buildMessage(data.details)}`)}getScopeConfig(){return this.__scopeConfig}__processScopeConfig(){if(TCHMI_DESIGNER){const designerMessage=this.__element.find(".tchmi-designer-control-message")[0]??document.createElement("div");return designerMessage.classList.add("tchmi-designer-control-message"),this.__scopeConfig?(this.__localizedEngineeringElements.delete("Engineering_Not_Configured"),designerMessage.textContent=this.__scopeConfig.name+"::"+this.__scopeConfig.chart):(designerMessage.textContent="Engineering_Not_Configured",this.__localizedEngineeringElements.set("Engineering_Not_Configured",designerMessage),this.__localizationReader&&(designerMessage.textContent=this.__localizationReader.get("Engineering_Not_Configured"))),void this.__element[0].appendChild(designerMessage)}this.__isAttached&&(this.__activeLegendElements=void 0,this.__serverSymbolsHelper.closeConnection(this.__oldScopeConfig),this.__openWebsocket())}setServerInterval(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ServerInterval")),convertedValue!==this.__serverInterval&&(this.__serverInterval=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ServerInterval"}),this.__processServerInterval())}getServerInterval(){return this.__serverInterval}__processServerInterval(){this.__isAttached&&null!==this.__subscriptionIds.dataLayoutAndWindow&&this.__resubscribe(!0)}setServerDomain(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ServerDomain")),tchmi_equal(convertedValue,this.__serverDomain)||(this.__serverDomain=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ServerDomain"}),this.__processServerDomain())}getServerDomain(){return this.__serverDomain}__processServerDomain(){if(this.__isAttached){if(this.__clearFullControl(),this.__scopeLayout=void 0,this.__scopeGraphData=void 0,this.__menubar=void 0,this.__legend=void 0,this.__scopeGraphWindow=null,this.__enabledButtons=ButtonsEnabled.None,this.__enabledTimes=TimesEnabled.None,this.__configEventsDestroyEvent?.(),this.__configEventsDestroyEvent=null,null!==this.__subscriptionIds.onExtensionStateChanged&&(TcHmi.Server.unsubscribe(this.__subscriptionIds.onExtensionStateChanged,null),this.__subscriptionIds.onExtensionStateChanged=null),this.__serverDomain&&(this.__configEventsDestroyEvent=TcHmi.Server.Events.registerConsumer([{path:"domain",comparator:"==",value:this.__serverDomain},{logic:"AND"},{path:"payload",comparator:"contains",value:"configType"},{logic:"OR"},{path:"payload::type",comparator:"==",value:"general"}],{subscription:this.__configEventCallback})),this.__scopeEventsDestroyEvent?.(),this.__scopeEventsDestroyEvent=null,this.__serverDomain){let symbol="ListDomains";this.__subscriptionIds.onExtensionStateChanged=TcHmi.Server.subscribe([{commandOptions:["SendErrorMessage","UniqueHash"],symbol}],300,this.__onExtensionStateChanged),this.__sessionId&&this.__socketId&&(this.__scopeIsInitialized=!1,this.__scopeEventsDestroyEvent=TcHmi.Server.Events.registerConsumer([{path:"domain",comparator:"==",value:this.__serverDomain},{logic:"AND"},{path:"payload::sessionId",comparator:"==",value:this.__sessionId},{logic:"AND"},{path:"payload::socketId",comparator:"==",value:this.__socketId}],{subscription:this.__scopeEventCallback},this.__eventRegisterDoneCallback))}let request={requestType:"ReadWrite",commands:[{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".Init",writeValue:{controlName:this.__id}},{commandOptions:["SendErrorMessage"],symbol:"GetSymbolAccess",writeValue:this.__serverDomain+".GetAllUploadedRecords"}]};TcHmi.Server.releaseRequest(this.__requestIds.init),this.__requestIds.init=TcHmi.Server.requestEx(request,null,this.__initCallback),this.__openWebsocket()}}setEnableRecordControls(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("EnableRecordControls")),convertedValue!==this.__enableRecordControls&&(this.__enableRecordControls=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"EnableRecordControls"}),this.__processEnableRecordControls())}getEnableRecordControls(){return this.__enableRecordControls}__processEnableRecordControls(){if(this.__isAttached){if(this.__enableRecordControls){if(null===(this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_StopRecordButton")||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_StopRecordButton"))){let buttonStopControl=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__id}_StopRecordButton`,{"data-tchmi-is-enabled":!1,"data-tchmi-virtual-control-right-mappings":this.__virtualMappingForControlRecord},this);if(!buttonStopControl)throw new Error("Needed Button could not be instantiated");buttonStopControl.getElement()[0].classList.add("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-button","TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-StopRecordButton"),buttonStopControl.getElement().prependTo(this.__elementToolBar),this.__toolBarControls.StopRecordButton=buttonStopControl,this.__toolBarControlsArray.unshift(buttonStopControl),this.__destroyEvents.StopRecordButton=TcHmi.EventProvider.register(this.__id+"_StopRecordButton.onPressed",this.__onPressed)}if(null===(this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_StartRecordButton")||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_StartRecordButton"))){let buttonStartControl=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__id}_StartRecordButton`,{"data-tchmi-is-enabled":!1,"data-tchmi-virtual-control-right-mappings":this.__virtualMappingForControlRecord},this);if(!buttonStartControl)throw new Error("Needed Button could not be instantiated");buttonStartControl.getElement()[0].classList.add("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-button","TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-menu-bar-StartRecordButton"),buttonStartControl.getElement().prependTo(this.__elementToolBar),this.__toolBarControls.StartRecordButton=buttonStartControl,this.__toolBarControlsArray.unshift(buttonStartControl),this.__destroyEvents.StartRecordButton=TcHmi.EventProvider.register(this.__id+"_StartRecordButton.onPressed",this.__onPressed)}}else{if(null!==(this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_StartRecordButton")||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_StartRecordButton"))){const elem=this.__toolBarControls.StartRecordButton;elem&&elem.destroy();const destroyEvent=this.__destroyEvents.StartRecordButton;destroyEvent&&(destroyEvent(),delete this.__destroyEvents.StartRecordButton),this.__toolBarControlsArray.splice(0,1),delete this.__toolBarControls.StartRecordButton}if(null!==(this.__elementToolBar[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_StopRecordButton")||this.__elementMenuBarDropdown[0].querySelector("#"+tchmi_css_escape_selector(this.__id)+"_StopRecordButton"))){const elem=this.__toolBarControls.StopRecordButton;elem&&elem.destroy();const destroyEvent=this.__destroyEvents.StopRecordButton;destroyEvent&&(destroyEvent(),delete this.__destroyEvents.StopRecordButton),this.__toolBarControlsArray.splice(0,1),delete this.__toolBarControls.StopRecordButton}}this.__calcMenuButtons(),this.__scopeGraphWindow&&this.__scopeLayout?this.__enableOrDisableMenuControls(this.__scopeGraphWindow.scopeState,this.__scopeGraphWindow.liveState,this.__scopeGraphWindow.undo,this.__scopeGraphWindow.redo,ChartType[this.__scopeLayout.chartType]):this.__enableOrDisableMenuControls("Unknown",!1,!1,!1,ChartType.YT)}}setChartColorSource(valueNew){let convertedValue=TcHmi.ValueConverter.toEnum(valueNew,ChartColorSource)??TcHmi.ValueConverter.toEnum(this.getAttributeDefaultValueInternal("ChartColorSource"),ChartColorSource,ChartColorSource.ScopeConfig);convertedValue!==this.__chartChartColorSource&&(this.__chartChartColorSource=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ChartColorSource"}),this.__processChartColorSource())}getChartColorSource(){if(void 0!==this.__chartChartColorSource)return ChartColorSource[this.__chartChartColorSource]}__processChartColorSource(){this.__isAttached&&this.__drawLineChart()}setTriggerWindowPosition(valueNew){let convertedValue=TcHmi.ValueConverter.toEnum(valueNew,TriggerWindowPosition);null===convertedValue&&(convertedValue=TcHmi.ValueConverter.toEnum(this.getAttributeDefaultValueInternal("TriggerWindowPosition"),TriggerWindowPosition,TriggerWindowPosition.Left)),convertedValue!==this.__triggerWindowPosition&&(this.__triggerWindowPosition=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"TriggerWindowPosition"}),this.__processTriggerWindowPosition())}getTriggerWindowPosition(){return this.__triggerWindowPosition}__processTriggerWindowPosition(){this.__elementTemplateRoot.css({"grid-template-columns":"","grid-template-rows":""}),this.__elementTriggerWindow[0].classList.toggle("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-trigger-window-right",this.__triggerWindowPosition===TriggerWindowPosition.Right),this.__elementTriggerWindow[0].classList.toggle("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-trigger-window-left",this.__triggerWindowPosition===TriggerWindowPosition.Left),this.__elementTriggerWindow[0].classList.toggle("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-trigger-window-bottom",this.__triggerWindowPosition===TriggerWindowPosition.Bottom),this.__elementTriggerWindow[0].classList.toggle("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-trigger-window-top",this.__triggerWindowPosition===TriggerWindowPosition.Top),this.__elementTemplateRoot[0].classList.toggle("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-trigger-none",!this.__showTriggerWindow),this.__elementTemplateRoot[0].classList.toggle("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-trigger-right",this.__triggerWindowPosition===TriggerWindowPosition.Right&&this.__showTriggerWindow),this.__elementTemplateRoot[0].classList.toggle("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-trigger-left",this.__triggerWindowPosition===TriggerWindowPosition.Left&&this.__showTriggerWindow),this.__elementTemplateRoot[0].classList.toggle("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-trigger-bottom",this.__triggerWindowPosition===TriggerWindowPosition.Bottom&&this.__showTriggerWindow),this.__elementTemplateRoot[0].classList.toggle("TcHmi_Controls_Beckhoff_TcHmiScopeControl_TcHmiScopeControl-template-trigger-top",this.__triggerWindowPosition===TriggerWindowPosition.Top&&this.__showTriggerWindow),this.__isAttached&&this.__serverSymbolsHelper.setChartSize(!0)}setShowTriggerWindow(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ShowTriggerWindow")),convertedValue!==this.__showTriggerWindow&&(this.__showTriggerWindow=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ShowTriggerWindow"}),this.__processShowTriggerWindow())}getShowTriggerWindow(){return this.__showTriggerWindow}__processShowTriggerWindow(){this.__elementTemplateRoot.css({"grid-template-columns":"","grid-template-rows":""}),this.__showTriggerWindow?(this.__elementTriggerWindow.css({display:""}),this.__toolBarControls.TriggerWindowButton&&this.__toolBarControls.TriggerWindowButton.setToggleState("Active")):(this.__elementTriggerWindow.css({display:"none"}),this.__toolBarControls.TriggerWindowButton&&this.__toolBarControls.TriggerWindowButton.setToggleState("Normal"),null!==this.__subscriptionIds.triggerWindow&&(TcHmi.Server.unsubscribe(this.__subscriptionIds.triggerWindow,null),this.__subscriptionIds.triggerWindow=null)),this.__isAttached&&(this.__processTriggerWindowPosition(),this.__showTriggerWindow&&this.__unsubscribeTriggerWindow())}setAutostartRecord(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("AutostartRecord")),convertedValue!==this.__autostartRecord&&(this.__autostartRecord=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"AutostartRecord"}))}getAutostartRecord(){return this.__autostartRecord}}})();export{TcHmiScopeControl as Control};TcHmi.Controls.registerEx("TcHmiScopeControl","TcHmi.Controls.Beckhoff.TcHmiScopeControl",TcHmiScopeControl,{injectInGlobalObject:!0});